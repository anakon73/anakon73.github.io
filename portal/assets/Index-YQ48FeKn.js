import{e as P,j as D,w as q,o as i,A as R,B as A,l as t,b as c,u as a,D as u,k as O,F as $,H as G,x as j,G as k,J as F,P as T,T as H}from"./vue.esm-bundler-CYPfFjdk.js";import{s as C,u as L}from"./schemas-74JEr9Jm.js";import{u as J,a as N,M as W,A as M}from"./preview-D0Pi-YKn.js";import{_ as Y}from"./VDataFilters-2mcnRfw0.js";import{_ as S}from"./FeedbackWarning-iVsjxw1W.js";import{I as z}from"./IconTickMarkCircle-2_sKm8Jk.js";import{_ as K}from"./VActionButton-W6KHmnSu.js";import{I as Q,a as X}from"./IconCreditCard-JAdiU-bP.js";import{_ as Z}from"./_plugin-vue_export-helper-x3n3nnut.js";import"./index-LmGWO5sK.js";import"./vue-router-E7v71uM3.js";import"./routes-WhYxSpGG.js";import"./models-qWR1FMGP.js";import"./chunk-UXHY756F-iEg6Hh0Y.js";import"./index-C1vJkiWb.js";import"./_commonjsHelpers-4gQjN7DL.js";import"./preview-errors-7FWlPnjy.js";import"./index-PPLHz8o0.js";import"./PDays-npMhi6Nw.js";import"./index-baqd9Qr3.js";import"./index-TCXC35p5.js";import"./index-05uTbNHo.js";import"./PPopoverPanel-RNuJphX8.js";import"./headlessui-float-sqR0azf2.js";import"./transition-qpXhaAaU.js";import"./keyboard-64MH3N5t.js";import"./open-closed-nhb_Ydho.js";import"./use-root-containers-gEPBKDr2.js";import"./use-resolve-button-type-49aRxFpo.js";import"./iframe-ufxlS10p.js";import"../sb-preview/runtime.js";import"./query-G1AwWss6.js";import"./ChevronDownIcon-AgxEjrtE.js";import"./listbox-3RN1mHPV.js";import"./form-TGXPuq_M.js";import"./DepartureList-w5NrqMJ9.js";import"./DepartureAssignStaffAndVehicles-8AoBdfT8.js";import"./api-B2HcjM2j.js";import"./api-cJzoLyfI.js";import"./PButton-h9_xezBg.js";import"./index-VqpYtbVe.js";import"./PInput-iZb_REtl.js";import"./POverlay-3jPNvx4x.js";import"./PSpinner-cF72MsvC.js";import"./IconBus-0QPjtZ9u.js";import"./IconPerson-i3ljUCnk.js";import"./SuggestedUser-4kWsZiWj.js";import"./PAvatar-wq6oK0Zr.js";import"./PlusCircleIcon-aSiXn_Mr.js";import"./SuggestedVehicle-r1TyKt-D.js";import"./ScheduledUser-esbe3tjU.js";import"./VehicleTitle-0pOySBND.js";import"./XMarkIcon-_tXc_TyD.js";import"./PPhoneLink-wKLYRG_F.js";import"./PAlert-quHLeqTA.js";import"./CheckCircleIcon-akbq8cGf.js";import"./XMarkIcon-t43a1P5Z.js";import"./PDialogTitle-rfxNVwSR.js";import"./description-LPuBJoU_.js";import"./DepartureListItem-I88AIHqM.js";import"./DepartureUpdateComment-2rt04tFb.js";import"./PTextarea-Wrr33MR5.js";import"./DepartureUpdateCommentPopover-euFlcGix.js";import"./DepartureUpdateStatus-zdhd3wV8.js";import"./PListboxLabel-U39qo3cm.js";import"./CheckIcon-WRJIoum8.js";import"./lib-Fy6oBlQ3.js";import"./PToggle-mLVcOzrp.js";import"./PRadio-sGATo2dT.js";import"./index-bhXQ3okY.js";import"./isNativeReflectConstruct-ubdnbphT.js";import"./mock-vjhcKIQW.js";import"./index-1aVAeLWL.js";import"./mock-UR5nntqf.js";import"./mock-CzN7Q16W.js";import"./mock-YoOI-P8k.js";import"./mock-psFphV_9.js";import"./mock-OgPWcINV.js";import"./useDepartment-RZahlhen.js";import"./useOperationalBase-kvvO22e1.js";import"./useRole-JNprELZd.js";import"./ProgressSpinner-lCLkagxy.js";import"./useAuth-8d_1_S6I.js";import"./IconAlert-B2oaG4cc.js";function ee(){const{apiClient:E}=J(),{addToActionsInProgress:d,removeFromActionsInProgress:_,processActionError:f,processActionSuccess:b,resetActionsInError:v,resetActionsInSuccess:g}=N(),{user:n}=C(L()),s={sendEODReport:{id:"sendEODReport",successMessage:"EOD Report sent successfully.",errorMessage:"There was a problem sending the EOD Report."},getEODReportByDate:{id:"getEODReportByDate",successMessage:"EOD Report retrieved successfully.",errorMessage:"There was a problem retrieving the EOD Report."}};return{user:n,eodReportActions:s,apiGetEODReportByOpBaseAndDate:async(e,p)=>{v(),d(s.getEODReportByDate);try{const m=await E.get("/api/eod-report",{params:{selectedOperationalBaseId:e.id,selectedDate:p}});return _(s.getEODReportByDate),m.data}catch(m){f(s.getEODReportByDate,m)}},sendEODReport:async e=>{v(),g(),d(s.sendEODReport);try{await E.post("/api/eod-report",e),_(s.sendEODReport),b(s.sendEODReport),setTimeout(()=>{g()},3e3)}catch(p){console.log(p),f(s.sendEODReport,p)}}}}const te={class:"space-y-8 divide-y divide-gray-200 sm:space-y-5"},oe={class:"space-y-6 sm:space-y-5"},re={key:2,class:"max-w-[625px] space-y-6 sm:space-y-5"},se={for:"departures",class:"block text-sm font-medium text-gray-700 sm:mt-px sm:pt-2"},ae={class:"text-xs font-normal"},ie={class:"relative mt-1 lg:mt-0"},pe={class:"absolute inset-y-0 left-0 m-[1px] flex w-10 items-center justify-center rounded-l border-r border-gray-300 bg-gray-200"},ne=["onUpdate:modelValue"],de={class:"relative mt-1 lg:mt-0"},me={class:"absolute inset-y-0 left-0 m-[1px] flex w-10 items-center justify-center rounded-l border-r border-gray-300 bg-gray-200"},le=["onUpdate:modelValue"],ce={key:0,class:"fixed inset-x-0 top-0 flex justify-center p-2"},ue={class:"w-64 rounded-md border border-green-100 bg-green-50 p-3 md:p-4"},_e={class:"flex"},fe={class:"shrink-0"},ve={class:"ml-3"},ge=["innerHTML"],V=P({__name:"Index",setup(E){const{actionIsInProgress:d,getActionSuccessMessage:_,actionIsInSuccess:f,validateForm:b}=N(),{sendEODReport:v,apiGetEODReportByOpBaseAndDate:g,eodReportActions:n}=ee(),{user:s}=C(L()),h=D(null),o=D({selectedDepartment:null,selectedOperationalBase:null,selectedRole:null,selectedMonth:"",selectedDate:""}),e=D(null),p=D(!0),m=async y=>{o.value=y},U=async()=>{await b(h.value,async()=>{e.value&&(e.value.user=s.value,await v(e.value))})};return q(()=>o.value,async(y,x)=>{if(y!==x&&o.value.selectedDepartment&&o.value.selectedOperationalBase&&o.value.selectedDate){const r=await g(o.value.selectedOperationalBase,o.value.selectedDate);r?e.value={id:r.id,departmentId:r.departmentId,eodReportFormId:r.eodReportFormId,user:r.user?r.user:null,date:r.date,eodReportFormItems:r.eodReportFormItems,eodReportLogItems:r.eodReportLogItems}:e.value=null,p.value=!1}}),(y,x)=>(i(),R(W,{"main-content-title":"EOD Report"},{default:A(()=>{var r,w;return[t("form",{ref_key:"eodReportFormElement",ref:h,class:"space-y-8 divide-y divide-gray-200"},[t("div",null,[c(Y,{"department-permissions-required":[a(M).VIEW_END_OF_DAY_REPORTS],"filter-by-operational-bases":"","filter-by-date":"","filter-state":o.value,onFilterStateUpdated:m},null,8,["department-permissions-required","filter-state"])]),t("div",te,[t("div",oe,[!p.value&&!e.value&&!a(d)(a(n).getEODReportByDate)?(i(),R(S,{key:0,title:"No EOD Report form found",message:"We couldn't find an EOD Report form for the selected department and operational base!"})):u("",!0),e.value&&e.value.id?(i(),R(S,{key:1,title:"Just so you know...",message:`An EOD Report for ${o.value.selectedDate} was already submitted by ${(r=e.value.user)==null?void 0:r.fullName} for ${(w=o.value.selectedOperationalBase)==null?void 0:w.name}.`},null,8,["message"])):u("",!0),e.value?(i(),O("div",re,[(i(!0),O($,null,G(e.value.eodReportFormItems,(B,l)=>(i(),O("div",{key:l,class:"sm:grid sm:grid-cols-3 sm:items-start sm:gap-4 sm:border-t sm:border-gray-200 sm:pt-5"},[t("label",se,[j(k(B.label)+" ",1),t("span",ae,"("+k(B.category)+")",1)]),t("div",ie,[t("div",pe,[c(Q,{class:"h-4 w-4 fill-gray-500"})]),F(t("input",{"onUpdate:modelValue":I=>e.value.eodReportLogItems[l].card=I,type:"number",min:"0",required:"",class:"block w-40 rounded-md border-gray-300 pl-14 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"},null,8,ne),[[T,e.value.eodReportLogItems[l].card,void 0,{number:!0}]])]),t("div",de,[t("div",me,[c(X,{class:"h-4 w-4 fill-gray-500"})]),F(t("input",{"onUpdate:modelValue":I=>e.value.eodReportLogItems[l].cash=I,type:"number",min:"0",required:"",class:"block w-40 rounded-md border-gray-300 pl-14 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"},null,8,le),[[T,e.value.eodReportLogItems[l].cash,void 0,{number:!0}]])])]))),128))])):u("",!0)])]),e.value&&o.value.selectedDepartment?(i(),R(K,{key:0,action:U,"permission-required":{permission:a(M).MANAGE_EOD_REPORTS,department:o.value.selectedDepartment},loading:a(d)(a(n).sendEODReport),label:"Save EOD Report"},null,8,["permission-required","loading"])):u("",!0),c(H,{name:"save"},{default:A(()=>[a(f)(a(n).sendEODReport)?(i(),O("div",ce,[t("div",ue,[t("div",_e,[t("div",fe,[c(z,{class:"h-5 w-5 fill-green-400"})]),t("div",ve,[t("p",{class:"text-sm text-green-700",innerHTML:a(_)(a(n).sendEODReport)},null,8,ge)])])])])):u("",!0)]),_:1})],512)]}),_:1}))}}),Yt=Z(V,[["__scopeId","data-v-136d4926"]]);V.__docgenInfo={exportName:"default",displayName:"eod-report",description:"",tags:{},sourceFiles:["D:/work/server/htdocs/aa-portal.is/src/pages/eod-report/Index.vue"]};export{Yt as default};
