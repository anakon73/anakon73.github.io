import{o as i,k as a,l as e,e as K,z as Q,j as _,q as W,w as X,A as u,B as h,E as Y,u as n,b as m,J as w,P as C,N as v,$ as ee,D as y,T as E,F as p,H as x,G as f,C as V,x as se,S as te}from"./vue.esm-bundler-CYPfFjdk.js";import{s as oe,q as ie}from"./schemas-74JEr9Jm.js";import{R as re}from"./RightDrawer-Lpr6admO.js";import{a as ne,e as ae,f as le,A as de}from"./preview-D0Pi-YKn.js";import{I as me}from"./IconClose-tbzieUCA.js";import{P as D}from"./ProgressSpinner-lCLkagxy.js";import{_ as ce,a as ue}from"./ActionErrorAlert--bGVRXV4.js";import{u as pe,a as fe}from"./useAssessment-iBONDyw0.js";import{I as _e}from"./IconAlert-B2oaG4cc.js";import{I as F}from"./IconPlus-R6BbPohN.js";import{_ as he}from"./_plugin-vue_export-helper-x3n3nnut.js";import{_ as ve}from"./VDepartmentSelect-fFgtBnGn.js";import"./index-LmGWO5sK.js";import"./vue-router-E7v71uM3.js";import"./routes-WhYxSpGG.js";import"./models-qWR1FMGP.js";import"./chunk-UXHY756F-iEg6Hh0Y.js";import"./index-C1vJkiWb.js";import"./_commonjsHelpers-4gQjN7DL.js";import"./preview-errors-7FWlPnjy.js";import"./index-PPLHz8o0.js";import"./PDays-npMhi6Nw.js";import"./index-baqd9Qr3.js";import"./index-TCXC35p5.js";import"./index-05uTbNHo.js";import"./PPopoverPanel-RNuJphX8.js";import"./headlessui-float-sqR0azf2.js";import"./transition-qpXhaAaU.js";import"./keyboard-64MH3N5t.js";import"./open-closed-nhb_Ydho.js";import"./use-root-containers-gEPBKDr2.js";import"./use-resolve-button-type-49aRxFpo.js";import"./iframe-ufxlS10p.js";import"../sb-preview/runtime.js";import"./query-G1AwWss6.js";import"./ChevronDownIcon-AgxEjrtE.js";import"./listbox-3RN1mHPV.js";import"./form-TGXPuq_M.js";import"./DepartureList-w5NrqMJ9.js";import"./DepartureAssignStaffAndVehicles-8AoBdfT8.js";import"./api-B2HcjM2j.js";import"./api-cJzoLyfI.js";import"./PButton-h9_xezBg.js";import"./index-VqpYtbVe.js";import"./PInput-iZb_REtl.js";import"./POverlay-3jPNvx4x.js";import"./PSpinner-cF72MsvC.js";import"./IconBus-0QPjtZ9u.js";import"./IconPerson-i3ljUCnk.js";import"./SuggestedUser-4kWsZiWj.js";import"./PAvatar-wq6oK0Zr.js";import"./PlusCircleIcon-aSiXn_Mr.js";import"./SuggestedVehicle-r1TyKt-D.js";import"./ScheduledUser-esbe3tjU.js";import"./VehicleTitle-0pOySBND.js";import"./XMarkIcon-_tXc_TyD.js";import"./PPhoneLink-wKLYRG_F.js";import"./PAlert-quHLeqTA.js";import"./CheckCircleIcon-akbq8cGf.js";import"./XMarkIcon-t43a1P5Z.js";import"./PDialogTitle-rfxNVwSR.js";import"./description-LPuBJoU_.js";import"./DepartureListItem-I88AIHqM.js";import"./DepartureUpdateComment-2rt04tFb.js";import"./PTextarea-Wrr33MR5.js";import"./DepartureUpdateCommentPopover-euFlcGix.js";import"./DepartureUpdateStatus-zdhd3wV8.js";import"./PListboxLabel-U39qo3cm.js";import"./CheckIcon-WRJIoum8.js";import"./lib-Fy6oBlQ3.js";import"./PToggle-mLVcOzrp.js";import"./PRadio-sGATo2dT.js";import"./index-bhXQ3okY.js";import"./isNativeReflectConstruct-ubdnbphT.js";import"./mock-vjhcKIQW.js";import"./index-1aVAeLWL.js";import"./mock-UR5nntqf.js";import"./mock-CzN7Q16W.js";import"./mock-YoOI-P8k.js";import"./mock-psFphV_9.js";import"./mock-OgPWcINV.js";import"./IconTickMarkCircle-2_sKm8Jk.js";import"./useDepartment-RZahlhen.js";import"./useAuth-8d_1_S6I.js";const N={},xe={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},ge=e("path",{d:"M17,13H7V11H17M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z"},null,-1),be=[ge];function we(R,$){return i(),a("svg",xe,be)}const ye=he(N,[["render",we]]);N.__docgenInfo={displayName:"IconMinus",description:"",tags:{},sourceFiles:["D:/work/server/htdocs/aa-portal.is/src/shared/ui/icons/IconMinus.vue"]};const ke={class:"isolate flex flex-col items-center justify-center border-l bg-white pb-6"},Ae={class:"sticky top-0 z-10 flex w-full items-center justify-end bg-white p-6"},Ie=e("div",{class:"mb-6"},[e("h3",{class:"text-base font-semibold leading-6 text-gray-900"}," View/Edit Assessment. "),e("p",{class:"mt-1 text-sm text-gray-500"}," Use the form below to update this assessment. ")],-1),Ce={class:"grid grid-cols-1 gap-x-4 gap-y-6 pt-6"},Ee=e("p",{class:"mb-1 block text-sm font-medium text-gray-700"}," Department ",-1),Re=e("label",{for:"assessment_name",class:"block text-sm font-medium text-gray-700"}," Assessment Name ",-1),$e={class:"mt-1"},qe=e("label",{for:"criteria",class:"block text-sm font-medium text-gray-700"}," Criteria ",-1),Se={class:"my-2 rounded-md bg-yellow-50 p-4 shadow"},Ue={class:"flex items-center"},Ve={class:"shrink-0"},De={class:"ml-3"},Fe={class:"text-sm text-yellow-700"},Ne=e("p",null," Be mindful when making changes to criteria. ",-1),Be=e("span",{class:"text-xs italic hover:underline"}," Learn more ",-1),je=[Be],Te=e("ul",{class:"max-w-[500px] text-sm"},[e("li",{class:"mb-3"},[e("span",{class:"block font-semibold text-blue-700"}," Updates to existing criteria: "),e("p",{class:"mb-2"},' Tweaks to any criteria affect all recordsâ€” past and future. So, if you rename a knot from "Bowline" to "Half Hitch," it will show up as "Half Hitch" in all logs, even if the original pass was for the "Bowline." '),e("p",null,' To properly update a criterion without disrupting past records, create a new one (like "Half Hitch") and then remove the outdated one (like "Bowline"). This keeps past records intact while updating the criteria for future assessments. ')]),e("li",null,[e("span",{class:"block font-semibold text-blue-700"}," Deleting criteria: "),e("p",null,` Removing criteria is safe. Past assessments stay valid even if their criteria no longer exist. For instance, deleting the "Bowline" knot won't impact past logs that feature it. However, expect it to vanish from upcoming assessments. `)])],-1),Me=[Te],He={class:"flex w-8 cursor-help items-center justify-center rounded-l-md border border-gray-300 bg-gray-50 text-xs font-bold text-gray-400 shadow-sm",title:"The database ID for this criteria."},Pe={class:"pointer-events-none"},Le=["onUpdate:modelValue"],ze={class:"flex w-8 items-center justify-center rounded-r-md border border-gray-300 bg-gray-50 text-xs shadow-sm",title:"Remove this criteria from the database."},Ge=["onClick"],Je={class:"flex w-8 cursor-help items-center justify-center rounded-l-md border border-gray-300 bg-gray-50 text-xs font-bold text-gray-400 shadow-sm",title:"New criteria will be added to the database when you save this assessment."},Oe=["onUpdate:modelValue"],Ze={class:"flex justify-end"},Ke={class:"pt-8"},Qe=e("label",{for:"departure_date_and_time",class:"block text-sm font-medium text-gray-700"}," Required Abilities ",-1),We=e("p",{class:"mt-1 text-sm text-gray-500"}," In order to create logs for this assessment, staff must have the abilities listed below. Logs for this assessment are also visible only to users with any of these abilities (or the staff to whom the log belongs). ",-1),Xe={class:"mt-6"},Ye={class:"space-y-4"},es={class:"grid grid-cols-1 gap-3 md:grid-cols-2"},ss={class:"flex h-5 items-center"},ts=["id","checked","onChange"],os={class:"ml-3 flex items-center space-x-1 text-sm"},is={class:"flex h-5 w-5 items-center justify-center"},rs=["src"],ns=["for"],as={class:"text-gray-500"},ls={class:"pt-8"},ds=e("label",{for:"departure_date_and_time",class:"block text-sm font-medium text-gray-700"}," Renewal and Alert Exemption Rules ",-1),ms=e("p",{class:"mt-1 text-sm text-gray-500"}," Users with any of these abilities will not receive renewal alerts for this assessment. ",-1),cs={class:"mt-6"},us={class:"space-y-4"},ps={class:"grid grid-cols-1 gap-3 md:grid-cols-2"},fs={class:"flex h-5 items-center"},_s=["id","checked","onChange"],hs={class:"ml-3 flex items-center space-x-1 text-sm"},vs={class:"flex h-5 w-5 items-center justify-center"},xs=["src"],gs=["for"],bs={class:"text-gray-500"},ws={class:"mt-6"},ys=e("label",{for:"expiry_in_days",class:"block text-sm font-medium text-gray-700"}," Days between renewals ",-1),ks={class:"mt-1"},As=e("option",{value:null}," No expiry ",-1),Is={class:"relative pt-5"},Cs={class:"flex items-center justify-end"},Es={class:"flex items-center"},Rs={key:0},$s=K({__name:"Edit",props:{assessmentId:{}},setup(R){const $=R,{assessmentId:q}=Q($),{validateForm:B,actionIsInProgress:k,actionIsInError:j,actionIsInSuccess:T}=ne(),S=_(null),{getAssessmentById:U,assessmentActions:c,editAssessment:M}=pe(),{getAllAbilities:H}=ae(),{storeFilterState:P}=oe(le()),{storeUpdateAssessment:L,storeRemoveAssessment:z}=fe(),A=_(!1),g=_([]),I=_([]),o=_(null);W(async()=>{const[r,t]=await Promise.all([H(),U(q.value.toString())]);if(t){const l=t.criteria.map(s=>({criteria:s.criteria,id:s.id,remove:!1}));o.value={...t,criteria:l}}I.value=r}),X(q,async r=>{if(r){const t=await U(r.toString());if(t){const l=t.criteria.map(s=>({criteria:s.criteria,id:s.id,remove:!1}));o.value={...t,criteria:l}}}});const G=()=>{g.value.push({id:o.value.criteria.length+1,criteria:""})},J=async()=>{var t;const r=await B(S.value,()=>M(o.value,g.value));r&&(o.value=r,g.value=[],r.department.id===((t=P.value.selectedDepartment)==null?void 0:t.id)?L(r):z(r))},O=r=>{const t=o.value.requiredAbilities.findIndex(l=>l.id===r.id);t===-1?o.value.requiredAbilities.push(r):o.value.requiredAbilities.splice(t,1)},Z=r=>{const t=o.value.abilitiesExemptFromRenewalAlerts.findIndex(l=>l.id===r.id);t===-1?o.value.abilitiesExemptFromRenewalAlerts.push(r):o.value.abilitiesExemptFromRenewalAlerts.splice(t,1)};return(r,t)=>{const l=Y("RouterLink");return i(),u(re,null,{default:h(()=>[e("div",ke,[e("div",Ae,[n(k)(n(c).getAssessmentById)||n(k)(n(c).editAssessment)?(i(),u(D,{key:0,class:"h-5 w-5 text-blue-500"})):(i(),u(l,{key:1,to:{name:r.$Routes.Assessments}},{default:h(()=>[m(me,{class:"h-5 w-5 fill-red-400"})]),_:1},8,["to"]))]),e("form",{id:"edit_assessment_form",ref_key:"editAssessmentFormElement",ref:S,class:"w-full space-y-8 divide-y divide-gray-200 px-6 md:px-12"},[Ie,o.value?(i(),a(p,{key:0},[e("div",Ce,[e("div",null,[Ee,m(ve,{modelValue:o.value.department,"onUpdate:modelValue":t[0]||(t[0]=s=>o.value.department=s),"department-permissions-required":[n(de).MANAGE_ASSESSMENTS]},null,8,["modelValue","department-permissions-required"])]),e("div",null,[Re,e("div",$e,[w(e("input",{id:"assessment_name","onUpdate:modelValue":t[1]||(t[1]=s=>o.value.name=s),type:"text",class:"block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm",required:""},null,512),[[C,o.value.name]])])]),e("div",null,[qe,e("div",Se,[e("div",Ue,[e("div",Ve,[m(_e,{class:"h-5 w-5 fill-yellow-400","aria-hidden":"true"})]),e("div",De,[e("div",Fe,[Ne,e("button",{onClick:t[2]||(t[2]=v(s=>A.value=!0,["prevent"]))},je),(i(),u(ee,{to:"#modal"},[m(E,null,{default:h(()=>[A.value?(i(),a("div",{key:0,class:"pointer-events-auto fixed inset-0 isolate flex items-center justify-center overflow-x-auto bg-black/50",onClick:t[4]||(t[4]=s=>A.value=!1)},[e("div",{class:"max-h-[80%] max-w-[95%] overflow-y-auto rounded-md bg-white p-6 lg:max-w-[80%]",onClick:t[3]||(t[3]=v(()=>{},["stop"]))},Me)])):y("",!0)]),_:1})]))])])])]),(i(!0),a(p,null,x(o.value.criteria,(s,d)=>(i(),a("div",{key:d,class:"mt-1 flex"},[e("span",He,[e("span",Pe,f(s.id),1)]),w(e("input",{id:"name","onUpdate:modelValue":b=>s.criteria=b,type:"text",class:V(["block flex-1 rounded-md shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm",[s.remove?"border-red-200 bg-red-50":"border-gray-300 bg-white"]]),required:""},null,10,Le),[[C,s.criteria]]),e("span",ze,[e("button",{onClick:v(b=>s.remove=!s.remove,["prevent"])},[m(ye,{class:V(["h-4 w-4",[s.remove?"fill-red-500":"fill-red-300"]])},null,8,["class"])],8,Ge)])]))),128)),(i(!0),a(p,null,x(g.value,(s,d)=>(i(),a("div",{key:d,class:"mt-1 flex"},[e("span",Je,[m(F,{class:"h-4 w-4 fill-green-500"})]),w(e("input",{id:"name","onUpdate:modelValue":b=>s.criteria=b,type:"text",class:"block flex-1 rounded-r-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm",required:""},null,8,Oe),[[C,s.criteria]])]))),128))]),e("div",Ze,[e("button",{class:"flex items-center text-sm font-semibold text-blue-600",onClick:v(G,["prevent"])},[m(F,{class:"mr-1 h-4 w-4 fill-blue-600"}),se(" Add new Criteria ")])])]),e("div",Ke,[Qe,We,e("div",Xe,[e("fieldset",null,[e("div",Ye,[e("div",es,[(i(!0),a(p,null,x(I.value,s=>(i(),a("div",{key:s.id,class:"relative flex items-start"},[e("div",ss,[e("input",{id:`required_${s.slug}`,checked:o.value.requiredAbilities.find(d=>d.slug===s.slug)!==void 0,type:"checkbox",class:"h-4 w-4 cursor-pointer rounded border-gray-300 text-blue-600 focus:ring-blue-500",onChange:d=>O(s)},null,40,ts)]),e("div",os,[e("div",is,[e("img",{src:s.iconUrl,alt:"Ability icon."},null,8,rs)]),e("label",{for:`required_${s.slug}`,class:"cursor-pointer font-medium text-gray-700"},f(s.name),9,ns),e("p",as,f(s.description),1)])]))),128))])])])])]),e("div",ls,[ds,ms,e("div",cs,[e("fieldset",null,[e("div",us,[e("div",ps,[(i(!0),a(p,null,x(I.value,s=>(i(),a("div",{key:s.id,class:"relative flex items-start"},[e("div",fs,[e("input",{id:`renewal_${s.slug}`,checked:o.value.abilitiesExemptFromRenewalAlerts.find(d=>d.slug===s.slug)!==void 0,type:"checkbox",class:"h-4 w-4 cursor-pointer rounded border-gray-300 text-blue-600 focus:ring-blue-500",onChange:d=>Z(s)},null,40,_s)]),e("div",hs,[e("div",vs,[e("img",{src:s.iconUrl,alt:"Ability icon."},null,8,xs)]),e("label",{for:`renewal_${s.slug}`,class:"cursor-pointer font-medium text-gray-700"},f(s.name),9,gs),e("p",bs,f(s.description),1)])]))),128))])])])]),e("div",ws,[ys,e("div",ks,[w(e("select",{id:"expiry_in_days","onUpdate:modelValue":t[5]||(t[5]=s=>o.value.expiryInDays=s),class:"block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"},[As,(i(!0),a(p,null,x(n(ie),s=>(i(),a("option",{key:s},f(s),1))),128))],512),[[te,o.value.expiryInDays]])])])]),e("div",Is,[e("div",Cs,[m(E,{name:"alert"},{default:h(()=>[n(T)(n(c).editAssessment)?(i(),u(ce,{key:0,action:n(c).editAssessment},null,8,["action"])):y("",!0)]),_:1}),m(E,{name:"alert"},{default:h(()=>[n(j)(n(c).editAssessment)?(i(),u(ue,{key:0,action:n(c).editAssessment},null,8,["action"])):y("",!0)]),_:1}),e("div",Es,[e("button",{class:"ml-3 inline-flex h-9 items-center justify-center rounded-md border border-transparent bg-blue-600 px-4 py-2 text-sm font-medium text-white shadow-sm focus:outline-none hover:bg-blue-700",onClick:v(J,["prevent"])},[n(k)(n(c).editAssessment)?(i(),u(D,{key:1,class:"h-3 w-3 text-white"})):(i(),a("span",Rs," Apply Changes "))])])])])],64)):y("",!0)],512)])]),_:1})}}});$s.__docgenInfo={exportName:"default",displayName:"Edit",description:"",tags:{},props:[{name:"assessmentId",required:!0,type:{name:"number"}}],sourceFiles:["D:/work/server/htdocs/aa-portal.is/src/pages/assessments/Edit.vue"]};export{$s as default};
