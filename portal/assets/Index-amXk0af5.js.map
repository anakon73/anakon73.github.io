{"version":3,"file":"Index-amXk0af5.js","sources":["../../src/shared/ui/inputs/VToggleFilter.vue","../../src/pages/staff/Index.vue"],"sourcesContent":["<script setup lang=\"ts\">\nconst modelValue = defineModel<boolean>()\n\ninterface Props {\n  label: string\n}\n\ndefineProps<Props>()\n</script>\n\n<template>\n  <div class=\"flex items-center\">\n    <span\n      class=\"mr-3 text-sm font-medium leading-6 text-gray-900\"\n      v-text=\"label\"\n    />\n    <button\n      class=\"relative inline-flex h-6 w-11 shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-blue-300 focus:ring-offset-2\"\n      :class=\"[modelValue ? 'bg-blue-600' : 'bg-gray-200']\"\n      @click=\"modelValue = !modelValue\"\n    >\n      <span\n        class=\"pointer-events-none relative inline-block h-5 w-5 rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out\"\n        :class=\"[modelValue ? 'translate-x-5' : 'translate-x-0']\"\n      >\n        <span\n          class=\"absolute inset-0 flex h-full w-full items-center justify-center transition-opacity\"\n          :class=\"[modelValue ? 'opacity-0 duration-100 ease-out' : 'opacity-100 duration-200 ease-in']\"\n        >\n          <svg class=\"h-3 w-3 text-gray-400\" fill=\"none\" viewBox=\"0 0 12 12\">\n            <path\n              d=\"M4 8l2-2m0 0l2-2M6 6L4 4m2 2l2 2\"\n              stroke=\"currentColor\"\n              stroke-width=\"2\"\n              stroke-linecap=\"round\"\n              stroke-linejoin=\"round\"\n            />\n          </svg>\n        </span>\n        <span\n          class=\"absolute inset-0 flex h-full w-full items-center justify-center transition-opacity\"\n          :class=\"[modelValue ? 'opacity-100 duration-200 ease-in' : 'opacity-0 duration-100 ease-out']\"\n        >\n          <svg class=\"h-3 w-3 text-blue-600\" fill=\"currentColor\" viewBox=\"0 0 12 12\">\n            <path d=\"M3.707 5.293a1 1 0 00-1.414 1.414l1.414-1.414zM5 8l-.707.707a1 1 0 001.414 0L5 8zm4.707-3.293a1 1 0 00-1.414-1.414l1.414 1.414zm-7.414 2l2 2 1.414-1.414-2-2-1.414 1.414zm3.414 2l4-4-1.414-1.414-4 4 1.414 1.414z\" />\n          </svg>\n        </span>\n      </span>\n    </button>\n  </div>\n</template>\n","<script setup lang=\"ts\">\nimport { onUnmounted, ref, watch } from 'vue'\nimport { storeToRefs } from 'pinia'\nimport MainContent from '@/shared/ui/layout/MainContent.vue'\nimport { useUser } from '@/shared/api/useUser'\nimport IconAccount from '@/shared/ui/icons/IconAccount.vue'\nimport ProgressSpinner from '@/shared/ui/ProgressSpinner.vue'\nimport { useUi } from '@/shared/lib/composables/useUi'\nimport IconPhone from '@/shared/ui/icons/IconPhone.vue'\nimport { useAuth } from '@/shared/api/useAuth'\nimport VToggleFilter from '@/shared/ui/inputs/VToggleFilter.vue'\nimport VDataFilters from '@/shared/ui/inputs/VDataFilters.vue'\nimport type { IDataFilters } from '@/shared/types/inputs/IDataFilters'\nimport { useUiStore } from '@/shared/lib/composables/ui'\nimport { useUserStore } from '@/shared/api/stores/user'\nimport { AppPermissions } from '@/shared/types/enums/permissions/permissions'\n\nconst { fetchAndStoreUsersIndex, storeResetUsers, userActions } = useUser()\nconst { storeUsers } = storeToRefs(useUserStore())\nconst { actionIsInProgress } = useUi()\n\nconst showCurrentlyEmployedStaffOnly = ref(false)\n\nconst { storeSetFilterState } = useUiStore()\nconst { storeFilterState } = storeToRefs(useUiStore())\nconst { userHasPermissionInDepartment } = useAuth()\n\nconst handleFilterStateUpdate = async (newFilterState: IDataFilters) => {\n  storeSetFilterState(newFilterState)\n\n  if (storeFilterState.value.selectedDepartment === null) {\n    return\n  }\n\n  await fetchAndStoreUsersIndex(\n    storeFilterState.value.selectedDepartment.id,\n    showCurrentlyEmployedStaffOnly.value,\n  )\n}\n\nonUnmounted(() => {\n  storeResetUsers()\n})\n\nwatch (showCurrentlyEmployedStaffOnly, async () => {\n  if (storeFilterState.value.selectedDepartment === null) {\n    return\n  }\n\n  await fetchAndStoreUsersIndex(\n    storeFilterState.value.selectedDepartment.id,\n    showCurrentlyEmployedStaffOnly.value,\n  )\n})\n</script>\n\n<template>\n  <MainContent main-content-title=\"Manage Staff\">\n    <div\n      v-if=\"storeFilterState.selectedDepartment && userHasPermissionInDepartment(AppPermissions.MANAGE_STAFF, storeFilterState.selectedDepartment)\"\n      class=\"flex w-full justify-end py-6\"\n    >\n      <RouterLink\n        :to=\"{ name: $Routes.StaffCreate }\"\n        class=\"block w-full whitespace-nowrap rounded-md bg-blue-600 px-3 py-1.5 text-center text-sm font-semibold leading-6 text-white shadow-sm focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-600 hover:bg-blue-500 md:w-48\"\n      >\n        Add User\n      </RouterLink>\n    </div>\n\n    <div\n      v-if=\"storeFilterState.selectedDepartment && userHasPermissionInDepartment(\n        AppPermissions.MANAGE_STAFF,\n        storeFilterState.selectedDepartment,\n      )\"\n      class=\"flex w-full justify-end\"\n    >\n      <VToggleFilter\n        v-model=\"showCurrentlyEmployedStaffOnly\"\n        label=\"Include inactive staff and guest users.\"\n      />\n    </div>\n\n    <VDataFilters\n      :department-permissions-required=\"[\n        AppPermissions.VIEW_STAFF_MANAGEMENT,\n      ]\"\n      filter-by-departments\n      @filter-state-updated=\"handleFilterStateUpdate\"\n    />\n\n    <div class=\"flex flex-col pb-4\">\n      <div class=\"flow-root md:mt-8\">\n        <div class=\"overflow-x-auto scrollbar-thin scrollbar-track-gray-100 scrollbar-thumb-blue-500/25\">\n          <div class=\"inline-block min-w-full py-2 align-middle\">\n            <div\n              v-if=\"storeFilterState.selectedDepartment === null || actionIsInProgress(userActions.getAllUsers)\"\n              class=\"flex h-[50px] items-center justify-center rounded border border-gray-100 bg-gray-50 shadow\"\n            >\n              <ProgressSpinner class=\"h-5 w-5 text-blue-600\" />\n            </div>\n\n            <table\n              v-else\n              class=\"min-w-full divide-y divide-gray-300 rounded border border-gray-100 bg-white shadow\"\n            >\n              <thead>\n                <tr>\n                  <th\n                    v-if=\"storeFilterState.selectedDepartment\n                      &&\n                      (userHasPermissionInDepartment(\n                        AppPermissions.VIEW_ASSESSMENTS,\n                        storeFilterState.selectedDepartment,\n                      )\n                        || userHasPermissionInDepartment(\n                          AppPermissions.VIEW_TRAINING,\n                          storeFilterState.selectedDepartment,\n                        )\n                      )\"\n                    scope=\"col\"\n                    colspan=\"3\"\n                    class=\"bg-gray-50 px-3 py-3.5\"\n                  />\n                  <th scope=\"col\" class=\"bg-gray-50 px-3 py-3.5 text-left text-sm font-semibold text-gray-900\">\n                    Name\n                  </th>\n                  <th scope=\"col\" class=\"bg-gray-50 px-3 py-3.5 text-left text-sm font-semibold text-gray-900\">\n                    Email\n                  </th>\n                  <th scope=\"col\" class=\"bg-gray-50 px-3 py-3.5 text-left text-sm font-semibold text-gray-900\">\n                    Operational Bases\n                  </th>\n                  <th scope=\"col\" class=\"bg-gray-50 px-3 py-3.5 text-left text-sm font-semibold text-gray-900\">\n                    Roles\n                  </th>\n                  <th scope=\"col\" class=\"bg-gray-50 px-3 py-3.5 text-left text-sm font-semibold text-gray-900\">\n                    Abilities\n                  </th>\n                </tr>\n              </thead>\n              <tbody class=\"divide-y divide-gray-200\">\n                <template v-if=\"storeUsers.length === 0\">\n                  <tr>\n                    <td colspan=\"8\" class=\"px-3 py-3.5 text-center text-sm text-gray-500\">\n                      No users found.\n                    </td>\n                  </tr>\n                </template>\n\n                <template v-else>\n                  <tr\n                    v-for=\"user in storeUsers\"\n                    :key=\"user.id\"\n                  >\n                    <td\n                      v-if=\"storeFilterState.selectedDepartment && userHasPermissionInDepartment(\n                        AppPermissions.VIEW_ASSESSMENTS,\n                        storeFilterState.selectedDepartment,\n                      )\"\n                      class=\"relative whitespace-nowrap p-3 text-right text-sm font-medium\"\n                    >\n                      <RouterLink\n                        :to=\"{\n                          name: $Routes.StaffAssess,\n                          params: { userId: user.id },\n                        }\"\n                        class=\"text-blue-600 hover:text-blue-900\"\n                      >\n                        Assessment\n                      </RouterLink>\n                    </td>\n                    <td\n                      v-if=\"storeFilterState.selectedDepartment && userHasPermissionInDepartment(\n                        AppPermissions.VIEW_TRAINING,\n                        storeFilterState.selectedDepartment,\n                      )\"\n                      class=\"relative whitespace-nowrap p-3 text-right text-sm font-medium\"\n                    >\n                      <RouterLink\n                        :to=\"{\n                          name: $Routes.StaffTrain,\n                          params: { userId: user.id },\n                        }\"\n                        class=\"text-blue-600 hover:text-blue-900\"\n                      >\n                        Training\n                      </RouterLink>\n                    </td>\n                    <td\n                      v-if=\"storeFilterState.selectedDepartment && userHasPermissionInDepartment(AppPermissions.MANAGE_STAFF, storeFilterState.selectedDepartment)\"\n                      class=\"relative whitespace-nowrap p-3 text-right text-sm font-medium\"\n                    >\n                      <RouterLink\n                        :to=\"{\n                          name: $Routes.StaffEdit,\n                          params: { userId: user.id },\n                        }\"\n                        class=\"text-blue-600 hover:text-blue-900\"\n                      >\n                        Edit\n                      </RouterLink>\n                    </td>\n                    <td class=\"flex items-center whitespace-nowrap p-3 text-sm font-medium text-gray-900\">\n                      <div class=\"relative mr-3 flex h-8 w-8 items-center justify-center rounded-full bg-gray-200\">\n                        <div\n                          v-if=\"user.contactNumber\"\n                          class=\"absolute bottom-[-2px] left-[-5px] flex h-5 w-4 items-center justify-center rounded bg-white shadow\"\n                        >\n                          <a\n                            class=\"block\"\n                            :href=\"`tel:${user.contactNumber}`\"\n                            :title=\"user.contactNumber\"\n                          >\n                            <IconPhone class=\"h-5 w-5 fill-black\" />\n                          </a>\n                        </div>\n                        <img\n                          v-if=\"user.profilePhotoSrc\"\n                          :src=\"user.profilePhotoSrc\"\n                          class=\"h-8 w-8 rounded-full object-cover\"\n                          loading=\"lazy\"\n                          alt=\"Profile photo.\"\n                        >\n                        <IconAccount v-else class=\"h-5 w-5 fill-gray-400\" />\n                      </div>\n                      {{ user.fullName }}\n                    </td>\n                    <td class=\"whitespace-nowrap p-3 text-sm text-gray-500\">\n                      {{ user.email }}\n                    </td>\n                    <td class=\"whitespace-nowrap p-3 text-sm text-gray-500\">\n                      {{ user.operationalBases.length > 0 ? user.operationalBases.map(base => base.name).join(', ') : 'N/A' }}\n                    </td>\n                    <td class=\"whitespace-nowrap p-3 text-sm text-gray-500\">\n                      {{ user.roles.length > 0 ? user.roles.map(role => role.name).join(', ') : 'N/A' }}\n                    </td>\n                    <td class=\"whitespace-nowrap p-3 text-sm text-gray-500\">\n                      <div class=\"flex items-center space-x-0.5\">\n                        <div\n                          v-for=\"ability in user.abilities\"\n                          :key=\"ability.id\"\n                          class=\"flex h-5 w-5 items-center justify-center\"\n                        >\n                          <img\n                            :src=\"ability.iconUrl\"\n                            :title=\"ability.name\"\n                            class=\"cursor-help\"\n                            alt=\"Icon image.\"\n                          >\n                        </div>\n                      </div>\n                    </td>\n                  </tr>\n                </template>\n              </tbody>\n            </table>\n          </div>\n        </div>\n      </div>\n    </div>\n  </MainContent>\n</template>\n"],"names":["modelValue","_useModel","fetchAndStoreUsersIndex","storeResetUsers","userActions","useUser","storeUsers","storeToRefs","useUserStore","actionIsInProgress","useUi","showCurrentlyEmployedStaffOnly","ref","storeSetFilterState","useUiStore","storeFilterState","userHasPermissionInDepartment","useAuth","handleFilterStateUpdate","newFilterState","onUnmounted","watch"],"mappings":"inHACM,MAAAA,EAAaC,gBAAqB,66GCgBxC,KAAM,CAAE,wBAAAC,EAAyB,gBAAAC,EAAiB,YAAAC,GAAgBC,EAAQ,EACpE,CAAE,WAAAC,CAAe,EAAAC,EAAYC,EAAc,CAAA,EAC3C,CAAE,mBAAAC,GAAuBC,IAEzBC,EAAiCC,EAAI,EAAK,EAE1C,CAAE,oBAAAC,GAAwBC,IAC1B,CAAE,iBAAAC,CAAqB,EAAAR,EAAYO,EAAY,CAAA,EAC/C,CAAE,8BAAAE,GAAkCC,IAEpCC,EAA0B,MAAOC,GAAiC,CACtEN,EAAoBM,CAAc,EAE9BJ,EAAiB,MAAM,qBAAuB,MAI5C,MAAAb,EACJa,EAAiB,MAAM,mBAAmB,GAC1CJ,EAA+B,KAAA,CACjC,EAGF,OAAAS,EAAY,IAAM,CACAjB,GAAA,CACjB,EAEDkB,EAAOV,EAAgC,SAAY,CAC7CI,EAAiB,MAAM,qBAAuB,MAI5C,MAAAb,EACJa,EAAiB,MAAM,mBAAmB,GAC1CJ,EAA+B,KAAA,CACjC,CACD"}