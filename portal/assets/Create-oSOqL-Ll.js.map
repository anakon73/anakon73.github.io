{"version":3,"file":"Create-oSOqL-Ll.js","sources":["../../src/pages/staff-bases/Create.vue"],"sourcesContent":["<script setup lang=\"ts\">\nimport { nextTick, onBeforeUnmount, onMounted, ref } from 'vue'\nimport L from 'leaflet'\nimport RightDrawer from '@/shared/ui/layout/RightDrawer.vue'\nimport { useUi } from '@/shared/lib/composables/useUi'\nimport IconClose from '@/shared/ui/icons/IconClose.vue'\nimport ProgressSpinner from '@/shared/ui/ProgressSpinner.vue'\nimport ActionSuccessAlert from '@/shared/ui/forms/ActionSuccessAlert.vue'\nimport ActionErrorAlert from '@/shared/ui/forms/ActionErrorAlert.vue'\nimport { useStaffBases } from '@/shared/api/useStaffBases'\nimport type { ICreateStaffBaseFormData } from '@/shared/types/staff-bases/ICreateStaffBaseFormData'\n\nconst { validateForm, actionIsInProgress, actionIsInError, actionIsInSuccess } = useUi()\nconst { staffBaseActions, createStaffBase } = useStaffBases()\n\nconst createStaffBaseFormElement = ref<HTMLFormElement | null>(null)\n\nconst createStaffBaseFormData = ref<ICreateStaffBaseFormData>({\n  name: '',\n  longitude: '-16.978723',\n  latitude: '64.025125',\n})\n\nconst handleCreateStaffBase = async () => {\n  await validateForm(createStaffBaseFormElement.value, () => createStaffBase(createStaffBaseFormData.value))\n}\n\nlet map: L.Map | null = null\nconst handleUpdateMap = () => {\n  map = L.map('map', {\n    center: [\n      64.025125,\n      -16.978723,\n    ],\n    zoom: 7,\n  })\n\n  L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}').addTo(map)\n\n  // Place the initial marker at the center of the map\n  let StaffBaseLocationMarker = L.marker(\n    [\n      64.025125,\n      -16.978723,\n    ],\n  ).addTo(map)\n\n  if (map) {\n    map.on('click', (e) => {\n      createStaffBaseFormData.value!.latitude = e.latlng.lat.toString()\n      createStaffBaseFormData.value!.longitude = e.latlng.lng.toString()\n\n      // Remove the previous marker\n      if (StaffBaseLocationMarker) {\n        map!.removeLayer(StaffBaseLocationMarker)\n      }\n\n      // Add a new marker where the map was clicked\n      StaffBaseLocationMarker = L.marker([e.latlng.lat, e.latlng.lng]).addTo(map!)\n    })\n\n    map.setView(new L.LatLng(\n      +createStaffBaseFormData.value!.latitude,\n      +createStaffBaseFormData.value!.longitude,\n    ), 7)\n  }\n  else {\n    console.error('Map is not defined')\n  }\n}\n\nonMounted(async () => {\n  await nextTick(() => {\n    setTimeout(() => handleUpdateMap(), 400)\n  })\n})\n\nonBeforeUnmount(() => {\n  if (map) {\n    map.off()\n    map.remove()\n  }\n})\n</script>\n\n<template>\n  <RightDrawer>\n    <div class=\"isolate flex flex-col items-center justify-center border-l bg-white pb-6\">\n      <!-- important to increase z index to sit on top of map -->\n      <div class=\"sticky top-0 z-[9999999] flex w-full items-center justify-end bg-white p-6\">\n        <ProgressSpinner\n          v-if=\"actionIsInProgress(staffBaseActions.createStaffBase)\"\n          class=\"h-5 w-5 text-blue-500\"\n        />\n        <RouterLink\n          v-else\n          :to=\"{ name: $Routes.StaffBases }\"\n        >\n          <IconClose class=\"h-5 w-5 fill-red-400\" />\n        </RouterLink>\n      </div>\n      <form\n        id=\"create_staff_base_form\"\n        ref=\"createStaffBaseFormElement\"\n        class=\"w-full space-y-8 divide-y divide-gray-200 px-6 md:px-12\"\n      >\n        <div class=\"mb-6\">\n          <h3 class=\"text-base font-semibold leading-6 text-gray-900\">\n            Create Staff Base.\n          </h3>\n          <p class=\"mt-1 text-sm text-gray-500\">\n            Use the form below to create a new Staff Base.\n          </p>\n        </div>\n\n        <template v-if=\"createStaffBaseFormData\">\n          <div class=\"grid grid-cols-1 gap-x-4 gap-y-6 pt-6\">\n            <div>\n              <label for=\"staff_base_name\" class=\"block text-sm font-medium text-gray-700\">\n                Staff Base Name\n              </label>\n              <div class=\"mt-1\">\n                <input\n                  id=\"staff_base_name\"\n                  v-model=\"createStaffBaseFormData.name\"\n                  type=\"text\"\n                  class=\"block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm\"\n                  required\n                >\n              </div>\n            </div>\n\n            <div\n              id=\"map\"\n              class=\"h-[400px] w-full bg-gray-100\"\n            />\n            <p class=\"text-xs italic text-gray-500\">\n              {{ createStaffBaseFormData.latitude }}, {{ createStaffBaseFormData.longitude }}\n            </p>\n          </div>\n\n          <div class=\"relative pt-5\">\n            <div class=\"flex items-center justify-end\">\n              <Transition name=\"alert\">\n                <ActionSuccessAlert\n                  v-if=\"actionIsInSuccess(staffBaseActions.createStaffBase)\"\n                  :action=\"staffBaseActions.createStaffBase\"\n                />\n              </Transition>\n              <Transition name=\"alert\">\n                <ActionErrorAlert\n                  v-if=\"actionIsInError(staffBaseActions.createStaffBase)\"\n                  :action=\"staffBaseActions.createStaffBase\"\n                />\n              </Transition>\n              <div class=\"flex items-center\">\n                <button\n                  class=\"ml-3 inline-flex h-9 items-center justify-center rounded-md border border-transparent bg-blue-600 px-4 py-2 text-sm font-medium text-white shadow-sm focus:outline-none hover:bg-blue-700\"\n                  @click.prevent=\"handleCreateStaffBase\"\n                >\n                  <span v-if=\"!actionIsInProgress(staffBaseActions.createStaffBase)\">\n                    Save Staff Base\n                  </span>\n                  <ProgressSpinner\n                    v-else\n                    class=\"h-3 w-3 text-white\"\n                  />\n                </button>\n              </div>\n            </div>\n          </div>\n        </template>\n      </form>\n    </div>\n  </RightDrawer>\n</template>\n"],"names":["validateForm","actionIsInProgress","actionIsInError","actionIsInSuccess","useUi","staffBaseActions","createStaffBase","useStaffBases","createStaffBaseFormElement","ref","createStaffBaseFormData","handleCreateStaffBase","map","handleUpdateMap","L","StaffBaseLocationMarker","e","onMounted","nextTick","onBeforeUnmount"],"mappings":"6oHAYA,KAAM,CAAE,aAAAA,EAAc,mBAAAC,EAAoB,gBAAAC,EAAiB,kBAAAC,CAAA,EAAsBC,IAC3E,CAAE,iBAAAC,EAAkB,gBAAAC,CAAgB,EAAIC,EAAc,EAEtDC,EAA6BC,EAA4B,IAAI,EAE7DC,EAA0BD,EAA8B,CAC5D,KAAM,GACN,UAAW,aACX,SAAU,WAAA,CACX,EAEKE,EAAwB,SAAY,CACxC,MAAMX,EAAaQ,EAA2B,MAAO,IAAMF,EAAgBI,EAAwB,KAAK,CAAC,CAAA,EAG3G,IAAIE,EAAoB,KACxB,MAAMC,EAAkB,IAAM,CACtBD,EAAAE,EAAE,IAAI,MAAO,CACjB,OAAQ,CACN,UACA,UACF,EACA,KAAM,CAAA,CACP,EAEDA,EAAE,UAAU,+FAA+F,EAAE,MAAMF,CAAG,EAGtH,IAAIG,EAA0BD,EAAE,OAC9B,CACE,UACA,UACF,CAAA,EACA,MAAMF,CAAG,EAEPA,GACEA,EAAA,GAAG,QAAUI,GAAM,CACrBN,EAAwB,MAAO,SAAWM,EAAE,OAAO,IAAI,WACvDN,EAAwB,MAAO,UAAYM,EAAE,OAAO,IAAI,WAGpDD,GACFH,EAAK,YAAYG,CAAuB,EAI1CA,EAA0BD,EAAE,OAAO,CAACE,EAAE,OAAO,IAAKA,EAAE,OAAO,GAAG,CAAC,EAAE,MAAMJ,CAAI,CAAA,CAC5E,EAEGA,EAAA,QAAQ,IAAIE,EAAE,OAChB,CAACJ,EAAwB,MAAO,SAChC,CAACA,EAAwB,MAAO,WAC/B,CAAC,GAGJ,QAAQ,MAAM,oBAAoB,CACpC,EAGF,OAAAO,EAAU,SAAY,CACpB,MAAMC,EAAS,IAAM,CACR,WAAA,IAAML,IAAmB,GAAG,CAAA,CACxC,CAAA,CACF,EAEDM,EAAgB,IAAM,CAChBP,IACFA,EAAI,IAAI,EACRA,EAAI,OAAO,EACb,CACD"}