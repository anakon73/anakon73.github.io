{"version":3,"file":"index-rJCjxSgT.js","sources":["../../src/pages/departure/show/DepartureShowPage.vue"],"sourcesContent":["<script setup lang=\"ts\">\nimport { computed, ref, toRefs } from 'vue'\nimport { useCloned } from '@vueuse/core'\n\nimport { BookingList } from '@/widgets/booking-list'\nimport { DepartureUpdateComment } from '@/features/departure/update-comment'\nimport { calculateDepartureArrivedPassengers } from '@/entities/departure'\n\nimport { BookingListStep, type ScheduledDeparture } from '@/shared/types'\nimport { useDeparture } from '@/shared/api/scheduled-departure'\nimport MainContent from '@/shared/ui/layout/MainContent.vue'\nimport { POverlay } from '@/shared/ui/POverlay'\nimport IconPerson from '@/shared/ui/icons/IconPerson.vue'\nimport { Stepper } from '@/features/Stepper'\nimport { PickupsBookingList } from '@/widgets/pickups-booking-list'\n\nexport interface Props {\n  departureId: ScheduledDeparture['id']\n}\n\nconst props = defineProps<Props>()\nconst { departureId } = toRefs(props)\n\nconst { data, isLoading, isFetched } = useDeparture({\n  scheduledDepartureId: departureId,\n})\n\nconst { cloned: isCommentFormVisible } = useCloned(\n  computed(() => !!data.value?.comment),\n)\n\nconst totalPassengers = computed(\n  () => calculateDepartureArrivedPassengers(data.value?.tourBookings ?? []),\n)\n\nconst finishedBookings = computed(() => data.value?.tourBookings?.filter(\n  (b) => b.status === 'arrived' || b.status === 'noshow' || b.status === 'droppedoff') || [],\n)\n\nconst bookingsProgress = computed(() => {\n  const totalBookings = data.value?.tourBookings?.length || 0\n  return totalBookings > 0 ? finishedBookings.value.length / totalBookings * 100 : 0\n})\nconst currentStep = ref<BookingListStep>(BookingListStep.Passengers)\n\nconst steps = computed(() => [\n  {\n    title: 'Pickup',\n    progress: bookingsProgress.value,\n    action: () => currentStep.value = BookingListStep.Pickup,\n    active: currentStep.value === BookingListStep.Pickup,\n  },\n  {\n    title: 'Passengers',\n    progress: 0,\n    action: () => currentStep.value = BookingListStep.Passengers,\n    active: currentStep.value === BookingListStep.Passengers,\n  },\n])\n</script>\n\n<template>\n  <div class=\"fixed bottom-0 z-20 w-full border bg-white px-10 pb-7 pt-5 shadow-md md:hidden\">\n    <Stepper :steps=\"steps\" />\n  </div>\n  <MainContent main-content-title=\"Departure\">\n    <POverlay :show=\"isLoading\" class=\"mt-6\" :class=\"!isFetched && 'min-h-60'\">\n      <div v-if=\"data\" class=\"flex flex-col gap-6\">\n        <div class=\"flex justify-between\">\n          <div class=\"flex flex-col gap-2\">\n            <p class=\"font-medium\">\n              {{ data.departure.time }} {{ data.tour.name }}\n            </p>\n            <div class=\"flex gap-1\">\n              <IconPerson class=\"size-5\" />\n\n              {{ totalPassengers }}\n            </div>\n          </div>\n\n          <div class=\"hidden md:flex\">\n            <Stepper :steps=\"steps\" class=\"justify-end\" />\n          </div>\n        </div>\n        <DepartureUpdateComment\n          v-if=\"isCommentFormVisible\"\n          :scheduled-departure-id=\"data.id\"\n          :comment=\"data.comment\"\n        />\n        <button\n          v-else\n          class=\"self-end text-blue-500 transition-colors hover:text-blue-800\"\n          @click=\"isCommentFormVisible = true\"\n        >\n          Add comment\n        </button>\n        <BookingList\n          v-if=\"currentStep === BookingListStep.Passengers\"\n          :tour-bookings=\"data.tourBookings\"\n          :tour-code=\"data.tour.code\"\n          :start-time=\"data.departure.time\"\n        />\n        <PickupsBookingList\n          v-if=\"currentStep === BookingListStep.Pickup\"\n          :tour-bookings=\"data.tourBookings\"\n          :tour-code=\"data.tour.code\"\n          :start-time=\"data.departure.time\"\n        />\n      </div>\n    </POverlay>\n  </MainContent>\n</template>\n"],"names":["props","__props","departureId","toRefs","data","isLoading","isFetched","useDeparture","isCommentFormVisible","useCloned","computed","_a","totalPassengers","calculateDepartureArrivedPassengers","finishedBookings","_b","b","bookingsProgress","totalBookings","currentStep","ref","BookingListStep","steps"],"mappings":"mzGAoBA,MAAMA,EAAQC,EACR,CAAE,YAAAC,CAAA,EAAgBC,EAAOH,CAAK,EAE9B,CAAE,KAAAI,EAAM,UAAAC,EAAW,UAAAC,CAAA,EAAcC,EAAa,CAClD,qBAAsBL,CAAA,CACvB,EAEK,CAAE,OAAQM,CAAA,EAAyBC,EACvCC,EAAS,IAAA,OAAM,OAAC,GAACC,EAAAP,EAAK,QAAL,MAAAO,EAAY,SAAO,CAAA,EAGhCC,EAAkBF,EACtB,IAAA,OAAM,OAAAG,IAAoCF,EAAAP,EAAK,QAAL,YAAAO,EAAY,eAAgB,CAAA,CAAE,EAAA,EAGpEG,EAAmBJ,EAAS,aAAM,QAAAK,GAAAJ,EAAAP,EAAK,QAAL,YAAAO,EAAY,eAAZ,YAAAI,EAA0B,OAC/DC,GAAMA,EAAE,SAAW,WAAaA,EAAE,SAAW,UAAYA,EAAE,SAAW,gBAAiB,CAAC,EAAA,EAGrFC,EAAmBP,EAAS,IAAM,SACtC,MAAMQ,IAAgBH,GAAAJ,EAAAP,EAAK,QAAL,YAAAO,EAAY,eAAZ,YAAAI,EAA0B,SAAU,EAC1D,OAAOG,EAAgB,EAAIJ,EAAiB,MAAM,OAASI,EAAgB,IAAM,CAAA,CAClF,EACKC,EAAcC,EAAqBC,EAAgB,UAAU,EAE7DC,EAAQZ,EAAS,IAAM,CAC3B,CACE,MAAO,SACP,SAAUO,EAAiB,MAC3B,OAAQ,IAAME,EAAY,MAAQE,EAAgB,OAClD,OAAQF,EAAY,QAAUE,EAAgB,MAChD,EACA,CACE,MAAO,aACP,SAAU,EACV,OAAQ,IAAMF,EAAY,MAAQE,EAAgB,WAClD,OAAQF,EAAY,QAAUE,EAAgB,UAChD,CAAA,CACD"}