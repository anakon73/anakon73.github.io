{"version":3,"file":"Create-90zT1kb5.js","sources":["../../src/shared/types/user/UserDTOs.ts","../../src/pages/staff/Create.vue"],"sourcesContent":["import type { IDepartment } from '@/shared/types/departments/IDepartments'\nimport type { IRole } from '@/shared/types/roles/IRole'\nimport type { IAbility } from '@/shared/types/abilities/IAbility'\nimport type { IPermission } from '@/shared/types/permissions/IPermission'\nimport type { IOperationalBase } from '@/shared/types/operational-bases/IOperationalBase'\nimport type { IEmploymentLog, IUserDepartment } from '@/shared/types/user/IUser'\nimport type { ScheduledDeparture, Vehicle } from '../models'\n\nexport interface CreateUserDTO {\n  firstName: string\n  lastName: string\n  email: string\n  profilePhotoSrc: string\n  profilePhotoDbPath?: string\n  contactNumber: string\n  kennitala: string\n  bankAccountNumber: string\n  departments: IUserDepartment[]\n  nextOfKinName: string\n  nextOfKinContactNumber: string\n  startDate: string\n  operationalBases: IOperationalBase[]\n  roles: IRole[]\n  abilities: IAbility[]\n  permissions: {\n    permission: IPermission\n    department: IDepartment\n  }[]\n}\n\nexport interface EditUserDTO {\n  id: string\n  firstName: string\n  lastName: string\n  email: string\n  profilePhotoSrc: string\n  profilePhotoDbPath?: string\n  contactNumber: string\n  kennitala: string\n  bankAccountNumber: string\n  departments: IUserDepartment[]\n  nextOfKinName: string\n  nextOfKinContactNumber: string\n  operationalBases: IOperationalBase[]\n  roles: IRole[]\n  abilities: IAbility[]\n  permissions: {\n    permission: IPermission\n    department: IDepartment\n  }[]\n  // allAbilities: IAbility[]\n  employmentLogs: IEmploymentLog[]\n  currentlyEmployed: boolean\n}\n\nexport interface UpdateUserPasswordDTO {\n  password: string\n  passwordConfirmation: string\n}\n\nexport const defaultCreateUserDTO: CreateUserDTO = {\n  firstName: '',\n  lastName: '',\n  email: '',\n  profilePhotoSrc: '',\n  profilePhotoDbPath: '',\n  contactNumber: '',\n  kennitala: '',\n  bankAccountNumber: '',\n  departments: [],\n  nextOfKinName: '',\n  nextOfKinContactNumber: '',\n  startDate: '',\n  operationalBases: [],\n  roles: [],\n  abilities: [],\n  permissions: [],\n}\n\nexport interface UserUpcomingShiftsDTO {\n  id: number\n  scheduledDeparture: ScheduledDeparture\n  vehicleId: number\n  vehicle?: Vehicle\n  isOngoing: boolean\n  displayDate: string\n}\n","<script setup lang=\"ts\">\nimport { ref } from 'vue'\nimport RightDrawer from '@/shared/ui/layout/RightDrawer.vue'\nimport { useUi } from '@/shared/lib/composables/useUi'\nimport { useUser } from '@/shared/api/useUser'\nimport IconClose from '@/shared/ui/icons/IconClose.vue'\nimport ProgressSpinner from '@/shared/ui/ProgressSpinner.vue'\nimport ActionErrorAlert from '@/shared/ui/forms/ActionErrorAlert.vue'\nimport ActionSuccessAlert from '@/shared/ui/forms/ActionSuccessAlert.vue'\nimport ImageUpload from '@/shared/ui/forms/ImageUpload.vue'\nimport VDepartmentMultiSelect from '@/shared/ui/inputs/VDepartmentMultiSelect.vue'\nimport VRoleMultiSelect from '@/shared/ui/inputs/VRoleMultiSelect.vue'\nimport VTextInput from '@/shared/ui/inputs/VTextInput.vue'\nimport VAbilityMultiSelect from '@/shared/ui/inputs/VAbilityMultiSelect.vue'\nimport VPermissionMultiSelect from '@/shared/ui/inputs/VPermissionMultiSelect.vue'\nimport { type CreateUserDTO, defaultCreateUserDTO } from '@/shared/types/user/UserDTOs'\nimport VDepartmentSelect from '@/shared/ui/inputs/VDepartmentSelect.vue'\nimport type { IDepartment } from '@/shared/types/departments/IDepartments'\n\nconst { actionIsInProgress, actionIsInError, actionIsInSuccess } = useUi()\nconst { createUser, userActions } = useUser()\n\nconst createUserDTO = ref<CreateUserDTO>({\n  ...defaultCreateUserDTO,\n})\n\nconst handleFileUpload = (paths: { src: string; db_path: string }) => {\n  createUserDTO.value.profilePhotoSrc = paths.src\n  createUserDTO.value.profilePhotoDbPath = paths.db_path\n}\n\nconst handleCreateUser = async () => {\n  try {\n    await createUser(createUserDTO.value)\n    createUserDTO.value = {\n      ...defaultCreateUserDTO,\n    }\n  }\n  catch (error) {\n    console.log(error)\n  }\n}\n\nconst handleUpdatePrimaryDepartment = (department: IDepartment) => {\n  createUserDTO.value.departments.forEach((d) => {\n    d.primary = d.id === department.id\n  })\n}\n\nconst handleUpdateRoles = () => {\n  createUserDTO.value.roles = createUserDTO.value.roles.filter((r) =>\n    createUserDTO.value.departments.some((d) => d.id === r.department.id),\n  )\n}\n\nconst handleUpdateAbilities = () => {\n  createUserDTO.value.abilities = createUserDTO.value.abilities.filter((a) =>\n    createUserDTO.value.departments.some((d) => d.id === a.department?.id),\n  )\n}\n</script>\n\n<template>\n  <RightDrawer>\n    <div class=\"isolate flex flex-col items-center justify-center border-l bg-white pb-6\">\n      <div class=\"sticky top-0 z-10 flex w-full items-center justify-end bg-white p-6\">\n        <ProgressSpinner\n          v-if=\"actionIsInProgress(userActions.getAllAbilities)\"\n          class=\"h-5 w-5 text-blue-500\"\n        />\n        <RouterLink\n          v-else\n          :to=\"{ name: $Routes.Staff }\"\n        >\n          <IconClose class=\"h-5 w-5 fill-red-400\" />\n        </RouterLink>\n      </div>\n      <form class=\"w-full space-y-8 divide-y divide-gray-200 px-6 md:px-12\">\n        <div class=\"space-y-8 divide-y divide-gray-200\">\n          <div>\n            <div>\n              <h3 class=\"text-base font-semibold leading-6 text-gray-900\">\n                Add a new staff member.\n              </h3>\n              <p class=\"mt-1 text-sm text-gray-500\">\n                Complete the form below to add a new staff member to the Portal.\n              </p>\n            </div>\n\n            <div class=\"mt-6 grid grid-cols-1 gap-x-4 gap-y-6 sm:grid-cols-6\">\n              <div class=\"sm:col-span-6\">\n                <ImageUpload\n                  label=\"Profile Photo\"\n                  image-storage-directory=\"profile_photos\"\n                  :default-image-src=\"createUserDTO.profilePhotoSrc\"\n                  @file-uploaded=\"handleFileUpload\"\n                />\n              </div>\n            </div>\n          </div>\n\n          <div class=\"pt-8\">\n            <h3 class=\"text-base font-semibold leading-6 text-gray-900\">\n              Personal Information\n            </h3>\n            <div class=\"mt-6 grid grid-cols-1 gap-x-4 gap-y-6 sm:grid-cols-6\">\n              <div class=\"sm:col-span-3\">\n                <VTextInput\n                  v-model=\"createUserDTO.firstName\"\n                  label=\"First Name\"\n                />\n              </div>\n              <div class=\"sm:col-span-3\">\n                <VTextInput\n                  v-model=\"createUserDTO.lastName\"\n                  label=\"Last Name\"\n                />\n              </div>\n              <div class=\"sm:col-span-3\">\n                <VTextInput\n                  v-model=\"createUserDTO.email\"\n                  label=\"Email\"\n                  type=\"email\"\n                />\n              </div>\n              <div class=\"sm:col-span-3\">\n                <VTextInput\n                  v-model=\"createUserDTO.contactNumber\"\n                  label=\"Contact Number\"\n                />\n              </div>\n              <div class=\"sm:col-span-3\">\n                <VTextInput\n                  v-model=\"createUserDTO.kennitala\"\n                  label=\"Kennitala\"\n                />\n              </div>\n              <div class=\"sm:col-span-3\">\n                <VTextInput\n                  v-model=\"createUserDTO.bankAccountNumber\"\n                  label=\"Bank Account #\"\n                />\n              </div>\n              <div class=\"sm:col-span-3\">\n                <VTextInput\n                  v-model=\"createUserDTO.startDate\"\n                  label=\"Start Date\"\n                  type=\"date\"\n                />\n              </div>\n              <div class=\"sm:col-span-3\">\n                <VTextInput\n                  v-model=\"createUserDTO.nextOfKinName\"\n                  label=\"Next of Kin: Name\"\n                />\n              </div>\n              <div class=\"sm:col-span-3\">\n                <VTextInput\n                  v-model=\"createUserDTO.nextOfKinContactNumber\"\n                  label=\"Next of Kin: Contact Number\"\n                />\n              </div>\n            </div>\n          </div>\n\n          <div class=\"pt-8\">\n            <h3 class=\"text-base font-semibold leading-6 text-gray-900\">\n              Departments, Roles & Abilities\n            </h3>\n            <div class=\"mt-6 space-y-6\">\n              <VDepartmentMultiSelect\n                v-model:selected-departments=\"createUserDTO.departments\"\n                v-model:selected-operational-bases=\"createUserDTO.operationalBases\"\n              />\n              <VDepartmentSelect\n                v-if=\"createUserDTO.departments.length\"\n                label=\"Primary Department\"\n                :department-options=\"createUserDTO.departments\"\n                @update-primary-department=\"handleUpdatePrimaryDepartment\"\n              />\n              <template\n                v-for=\"department in createUserDTO.departments\"\n                :key=\"department.id\"\n              >\n                <h3 v-if=\"createUserDTO.departments.length > 1\">\n                  {{ department.name }}\n                </h3>\n                <VRoleMultiSelect\n                  v-model:selected-roles=\"createUserDTO.roles\"\n                  :department-filters=\"{ dto: createUserDTO.departments, department }\"\n                  @update-selected-roles=\"handleUpdateRoles\"\n                />\n                <VAbilityMultiSelect\n                  v-model:selected-abilities=\"createUserDTO.abilities\"\n                  :department-filters=\"{ dto: createUserDTO.departments, department }\"\n                  @update-selected-abilities=\"handleUpdateAbilities\"\n                />\n              </template>\n              <VPermissionMultiSelect\n                v-model:selected-permissions=\"createUserDTO.permissions\"\n                :department-filters=\"createUserDTO.departments\"\n                @clear-selected-permissions=\"createUserDTO.permissions = []\"\n              />\n            </div>\n          </div>\n        </div>\n\n        <div class=\"relative pt-5\">\n          <div class=\"flex items-center justify-end\">\n            <Transition name=\"alert\">\n              <ActionSuccessAlert\n                v-if=\"actionIsInSuccess(userActions.createUser)\"\n                :action=\"userActions.createUser\"\n              />\n            </Transition>\n            <Transition name=\"alert\">\n              <ActionErrorAlert\n                v-if=\"actionIsInError(userActions.createUser)\"\n                :action=\"userActions.createUser\"\n              />\n            </Transition>\n            <div class=\"flex items-center\">\n              <button\n                class=\"ml-3 inline-flex h-9 items-center justify-center rounded-md border border-transparent bg-blue-600 px-4 py-2 text-sm font-medium text-white shadow-sm focus:outline-none hover:bg-blue-700\"\n                @click.prevent=\"handleCreateUser\"\n              >\n                <span v-if=\"!actionIsInProgress(userActions.createUser)\">\n                  Save\n                </span>\n                <ProgressSpinner\n                  v-else\n                  class=\"h-3 w-3 text-white\"\n                />\n              </button>\n            </div>\n          </div>\n        </div>\n      </form>\n    </div>\n  </RightDrawer>\n</template>\n"],"names":["defaultCreateUserDTO","actionIsInProgress","actionIsInError","actionIsInSuccess","useUi","createUser","userActions","useUser","createUserDTO","ref","handleFileUpload","paths","handleCreateUser","error","handleUpdatePrimaryDepartment","department","d","handleUpdateRoles","r","handleUpdateAbilities","a","_a"],"mappings":"muGA4DO,MAAMA,EAAsC,CACjD,UAAW,GACX,SAAU,GACV,MAAO,GACP,gBAAiB,GACjB,mBAAoB,GACpB,cAAe,GACf,UAAW,GACX,kBAAmB,GACnB,YAAa,CAAC,EACd,cAAe,GACf,uBAAwB,GACxB,UAAW,GACX,iBAAkB,CAAC,EACnB,MAAO,CAAC,EACR,UAAW,CAAC,EACZ,YAAa,CAAC,CAChB,qzCC1DA,KAAM,CAAE,mBAAAC,EAAoB,gBAAAC,EAAiB,kBAAAC,GAAsBC,EAAM,EACnE,CAAE,WAAAC,EAAY,YAAAC,CAAY,EAAIC,EAAQ,EAEtCC,EAAgBC,EAAmB,CACvC,GAAGT,CAAA,CACJ,EAEKU,EAAoBC,GAA4C,CACtDH,EAAA,MAAM,gBAAkBG,EAAM,IAC9BH,EAAA,MAAM,mBAAqBG,EAAM,OAAA,EAG3CC,EAAmB,SAAY,CAC/B,GAAA,CACI,MAAAP,EAAWG,EAAc,KAAK,EACpCA,EAAc,MAAQ,CACpB,GAAGR,CAAA,QAGAa,EAAO,CACZ,QAAQ,IAAIA,CAAK,CACnB,CAAA,EAGIC,EAAiCC,GAA4B,CACjEP,EAAc,MAAM,YAAY,QAASQ,GAAM,CAC3CA,EAAA,QAAUA,EAAE,KAAOD,EAAW,EAAA,CACjC,CAAA,EAGGE,EAAoB,IAAM,CAC9BT,EAAc,MAAM,MAAQA,EAAc,MAAM,MAAM,OAAQU,GAC5DV,EAAc,MAAM,YAAY,KAAMQ,GAAMA,EAAE,KAAOE,EAAE,WAAW,EAAE,CAAA,CACtE,EAGIC,EAAwB,IAAM,CAClCX,EAAc,MAAM,UAAYA,EAAc,MAAM,UAAU,OAAQY,GACpEZ,EAAc,MAAM,YAAY,KAAMQ,GAAA,OAAM,OAAAA,EAAE,OAAOK,EAAAD,EAAE,aAAF,YAAAC,EAAc,IAAE,CAAA,CACvE"}