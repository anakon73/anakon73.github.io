import{e as se,z as oe,j as y,q as ie,g as ae,w as M,o,A as u,B as x,E as re,l as e,u as t,b as g,k as r,x as f,G as m,J as C,P as j,S as le,F as T,H as P,D as c,T as A,N as ne,$ as de,a0 as ce,a1 as ue}from"./vue.esm-bundler-CYPfFjdk.js";import{s as me}from"./schemas-74JEr9Jm.js";import{R as pe}from"./RightDrawer-Lpr6admO.js";import{a as fe,e as ge,f as _e,A as ve}from"./preview-D0Pi-YKn.js";import{P as I}from"./ProgressSpinner-lCLkagxy.js";import{u as ye}from"./useTraining-wSOngOuP.js";import{I as he}from"./IconClose-tbzieUCA.js";import{_ as xe,a as be}from"./ActionErrorAlert--bGVRXV4.js";import{_ as we}from"./FeedbackWarning-iVsjxw1W.js";import{u as ke}from"./useHelpers-Uc_HlRzD.js";import{I as V,r as Te,a as Ie}from"./IconSchool-H8BAsls-.js";import{u as Ue,_ as Ce}from"./VTrainingCategorySelect-f8ZTFtAS.js";import{u as Ae}from"./useAuth-8d_1_S6I.js";import{_ as Se}from"./_plugin-vue_export-helper-x3n3nnut.js";import"./index-LmGWO5sK.js";import"./vue-router-E7v71uM3.js";import"./routes-WhYxSpGG.js";import"./models-qWR1FMGP.js";import"./chunk-UXHY756F-iEg6Hh0Y.js";import"./index-C1vJkiWb.js";import"./_commonjsHelpers-4gQjN7DL.js";import"./preview-errors-7FWlPnjy.js";import"./index-PPLHz8o0.js";import"./PDays-npMhi6Nw.js";import"./index-baqd9Qr3.js";import"./index-TCXC35p5.js";import"./index-05uTbNHo.js";import"./PPopoverPanel-RNuJphX8.js";import"./headlessui-float-sqR0azf2.js";import"./transition-qpXhaAaU.js";import"./keyboard-64MH3N5t.js";import"./open-closed-nhb_Ydho.js";import"./use-root-containers-gEPBKDr2.js";import"./use-resolve-button-type-49aRxFpo.js";import"./iframe-ufxlS10p.js";import"../sb-preview/runtime.js";import"./query-G1AwWss6.js";import"./ChevronDownIcon-AgxEjrtE.js";import"./listbox-3RN1mHPV.js";import"./form-TGXPuq_M.js";import"./DepartureList-w5NrqMJ9.js";import"./DepartureAssignStaffAndVehicles-8AoBdfT8.js";import"./api-B2HcjM2j.js";import"./api-cJzoLyfI.js";import"./PButton-h9_xezBg.js";import"./index-VqpYtbVe.js";import"./PInput-iZb_REtl.js";import"./POverlay-3jPNvx4x.js";import"./PSpinner-cF72MsvC.js";import"./IconBus-0QPjtZ9u.js";import"./IconPerson-i3ljUCnk.js";import"./SuggestedUser-4kWsZiWj.js";import"./PAvatar-wq6oK0Zr.js";import"./PlusCircleIcon-aSiXn_Mr.js";import"./SuggestedVehicle-r1TyKt-D.js";import"./ScheduledUser-esbe3tjU.js";import"./VehicleTitle-0pOySBND.js";import"./XMarkIcon-_tXc_TyD.js";import"./PPhoneLink-wKLYRG_F.js";import"./PAlert-quHLeqTA.js";import"./CheckCircleIcon-akbq8cGf.js";import"./XMarkIcon-t43a1P5Z.js";import"./PDialogTitle-rfxNVwSR.js";import"./description-LPuBJoU_.js";import"./DepartureListItem-I88AIHqM.js";import"./DepartureUpdateComment-2rt04tFb.js";import"./PTextarea-Wrr33MR5.js";import"./DepartureUpdateCommentPopover-euFlcGix.js";import"./DepartureUpdateStatus-zdhd3wV8.js";import"./PListboxLabel-U39qo3cm.js";import"./CheckIcon-WRJIoum8.js";import"./lib-Fy6oBlQ3.js";import"./PToggle-mLVcOzrp.js";import"./PRadio-sGATo2dT.js";import"./index-bhXQ3okY.js";import"./isNativeReflectConstruct-ubdnbphT.js";import"./mock-vjhcKIQW.js";import"./index-1aVAeLWL.js";import"./mock-UR5nntqf.js";import"./mock-CzN7Q16W.js";import"./mock-YoOI-P8k.js";import"./mock-psFphV_9.js";import"./mock-OgPWcINV.js";import"./IconTickMarkCircle-2_sKm8Jk.js";import"./IconAlert-B2oaG4cc.js";const v=h=>(ce("data-v-cdb3a060"),h=h(),ue(),h),Be={class:"isolate flex flex-col items-center justify-center border-l bg-white pb-6"},De={class:"sticky top-0 z-10 flex w-full items-center justify-end bg-white p-6"},Ne={class:"space-y-8 divide-y divide-gray-200"},$e=v(()=>e("h3",{class:"text-base font-semibold leading-6 text-gray-900"}," Log training. ",-1)),Fe={class:"mt-1 text-sm text-gray-500"},Me={class:"font-medium"},je={class:"flex flex-col space-y-6 pt-6"},Pe=v(()=>e("label",{for:"date",class:"block text-sm font-medium text-gray-700"}," Date ",-1)),Ve={class:"flex flex-wrap space-y-6 sm:space-x-3 sm:space-y-0"},Re={class:"w-full sm:flex-1"},Le=v(()=>e("p",{class:"mb-1 block text-sm font-medium text-gray-700"}," Category ",-1)),Ee={class:"w-full sm:flex-1"},He=v(()=>e("label",{for:"training",class:"block text-sm font-medium text-gray-700"}," Training ",-1)),qe=["disabled"],Ge=v(()=>e("option",{disabled:"",selected:"",value:"null"}," Select training... ",-1)),ze=["value"],Oe={key:0,class:"sm:col-span-3"},Je={for:"feedback",class:"block text-sm font-medium text-gray-700"},Ye=["innerHTML"],Ke={key:0,class:"relative pt-5"},Qe={class:"flex items-center justify-end"},We={class:"flex items-center"},Xe=["disabled"],Ze={key:0},et={key:1,class:"w-full space-y-8 divide-y divide-gray-200 px-6 pt-12 md:px-12"},tt={class:"space-y-8 divide-y divide-gray-200"},st={class:"flex items-center justify-between"},ot=v(()=>e("h3",{class:"text-base font-semibold leading-6 text-gray-900"}," Previous training logs. ",-1)),it={class:"mt-1 text-sm text-gray-500"},at={class:"font-medium"},rt={key:0,class:"flex flex-col space-y-3 pt-6"},lt={class:"flow-root"},nt={role:"list",class:"-mb-8"},dt={class:"relative pb-8"},ct={key:0,class:"absolute left-5 top-5 -ml-px h-full w-0.5 bg-gray-200","aria-hidden":"true"},ut={class:"relative flex items-start space-x-3"},mt={class:"relative"},pt=["src"],ft={key:1,class:"flex h-10 w-10 items-center justify-center rounded-full bg-gray-100 ring-8 ring-white"},gt={class:"absolute -bottom-0.5 -right-0.5 rounded-tl bg-white px-0.5 py-px"},_t={class:"min-w-0 flex-1"},vt={class:"text-sm font-medium text-gray-900"},yt={class:"text-xs text-gray-400"},ht={class:"mt-0.5 text-sm text-gray-500"},xt={class:"text-xs"},bt={class:"mt-2 text-sm text-gray-700"},wt={class:"italic"},kt={class:"relative px-1"},Tt={class:"flex h-10 w-10 items-center justify-center rounded-full bg-gray-100 ring-8 ring-white"},It={class:"min-w-0 flex-1 py-1.5"},Ut={class:"text-sm text-gray-500"},Ct={key:0,class:"font-medium text-gray-900"},At={class:"text-xs text-gray-400"},St=["textContent"],Bt={class:"whitespace-nowrap text-xs"},Dt=["onClick"],Nt={class:"rounded-md bg-white shadow sm:rounded-lg"},$t={class:"px-4 py-5 sm:p-6"},Ft=v(()=>e("h3",{class:"text-base font-semibold leading-6 text-gray-900"}," Are you sure? ",-1)),Mt={class:"mt-5 flex space-x-2"},R=se({__name:"Train",props:{userId:{}},setup(h){const L=h,{userId:b}=oe(L),{validateForm:E,actionIsInProgress:d,actionIsInError:H,actionIsInSuccess:q}=fe(),{getAllTrainingByUserAbility:G,getAllTrainingLogsByUserId:w,trainUser:z,deleteTrainingLog:O,trainingActions:n}=ye(),{getCurrentDateInYmdFormat:J}=ke(),{user:U}=ge(),{trainingCategoryActions:Y}=Ue(),{userHasPermissionInDepartment:K}=Ae(),{storeFilterState:S}=me(_e()),B=y(null),_=y([]),Q=J(),p=y(null),a=y(null),k=y(!1),D=y(0);ie(async()=>{const[l,i]=await Promise.all([G(),w(b.value.toString())]);l&&i&&(_.value=l,p.value=i,a.value={trainingCategoryId:_.value[0]?_.value[0].category.id:1,trainee:i.user,trainer:U.value,date:Q,training:_.value[0],feedback:""})});const W=l=>{D.value=l,k.value=!0},X=async()=>{await E(B.value,async()=>{if(!a.value)return;await z(a.value);const l=await w(b.value.toString());l&&(p.value=l,a.value.feedback="")})},Z=async l=>{if(await O(l),!a.value)return;const i=await w(b.value.toString());i&&(p.value=i)},N=ae(()=>_.value.filter(l=>{var i;return l.category.id===((i=a.value)==null?void 0:i.trainingCategoryId)}));return M(b,async l=>{const i=await w(l.toString());i&&(p.value=i,a.value.trainee=i.user)}),M(()=>{var l;return(l=a.value)==null?void 0:l.trainingCategoryId},()=>{a.value.training=N.value[0]}),(l,i)=>{const ee=re("RouterLink");return o(),u(pe,null,{default:x(()=>{var $;return[e("div",Be,[e("div",De,[t(d)(t(n).getAllTrainingByUserAbility)||t(d)(t(n).getAllTrainingLogsByUserId)?(o(),u(I,{key:0,class:"h-5 w-5 text-blue-500"})):(o(),u(ee,{key:1,to:{name:l.$Routes.Staff}},{default:x(()=>[g(he,{class:"h-5 w-5 fill-red-400"})]),_:1},8,["to"]))]),a.value&&_.value&&_.value.length>0?(o(),r("form",{key:0,id:"train_user_form",ref_key:"trainUserFormElement",ref:B,class:"w-full space-y-8 divide-y divide-gray-200 px-6 md:px-12"},[e("div",Ne,[e("div",null,[$e,e("p",Fe,[f(" Use the form below to create a new Training Log for "),e("span",Me,m(a.value.trainee.fullName),1),f(". ")])]),e("div",je,[e("div",null,[Pe,C(e("input",{id:"date","onUpdate:modelValue":i[0]||(i[0]=s=>a.value.date=s),type:"date",name:"date",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"},null,512),[[j,a.value.date]])]),e("div",Ve,[e("div",Re,[Le,g(Ce,{modelValue:a.value.trainingCategoryId,"onUpdate:modelValue":i[1]||(i[1]=s=>a.value.trainingCategoryId=s)},null,8,["modelValue"])]),e("div",Ee,[He,C(e("select",{id:"training","onUpdate:modelValue":i[2]||(i[2]=s=>a.value.training=s),name:"training",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm",disabled:t(d)(t(Y).getTrainingCategories)},[Ge,(o(!0),r(T,null,P(N.value,s=>(o(),r("option",{key:s.id,value:s},m(s.name),9,ze))),128))],8,qe),[[le,a.value.training]])])]),a.value.training&&a.value.training.requiresFeedback?(o(),r("div",Oe,[e("label",Je,[f(" Feedback or additional comments "),e("span",{class:"text-xs font-normal text-gray-400",innerHTML:`(from ${($=t(U))==null?void 0:$.fullName})`},null,8,Ye)]),C(e("textarea",{id:"feedback","onUpdate:modelValue":i[3]||(i[3]=s=>a.value.feedback=s),name:"feedback",rows:"8",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm",required:""},null,512),[[j,a.value.feedback]])])):c("",!0)])]),a.value.training?(o(),r("div",Ke,[e("div",Qe,[g(A,{name:"alert"},{default:x(()=>[t(q)(t(n).trainUser)?(o(),u(xe,{key:0,action:t(n).trainUser},null,8,["action"])):c("",!0)]),_:1}),g(A,{name:"alert"},{default:x(()=>[t(H)(t(n).trainUser)?(o(),u(be,{key:0,action:t(n).trainUser},null,8,["action"])):c("",!0)]),_:1}),e("div",We,[e("button",{disabled:t(d)(t(n).getAllTrainingByUserAbility)||t(d)(t(n).getAllTrainingLogsByUserId)||t(d)(t(n).trainUser),class:"ml-3 inline-flex h-9 items-center justify-center rounded-md border border-transparent bg-blue-600 px-4 py-2 text-sm font-medium text-white shadow-sm focus:outline-none disabled:cursor-not-allowed hover:bg-blue-700",onClick:ne(X,["prevent"])},[!t(d)(t(n).getAllTrainingByUserAbility)&&!t(d)(t(n).getAllTrainingLogsByUserId)&&!t(d)(t(n).trainUser)?(o(),r("span",Ze," Save ")):(o(),u(I,{key:1,class:"h-3 w-3 text-white"}))],8,Xe)])])])):c("",!0)],512)):c("",!0),a.value&&p.value&&p.value.logs.length?(o(),r("div",et,[e("div",tt,[e("div",st,[e("div",null,[ot,e("p",it,[f(" Below are the previous training logs for "),e("span",at,m(a.value.trainee.fullName),1),f(". ")])]),t(d)(t(n).getAllTrainingLogsByUserId)?(o(),u(I,{key:0,class:"h-5 w-5 text-blue-500"})):c("",!0)]),!t(d)(t(n).getAllTrainingLogsByUserId)&&p.value&&p.value.logs.length>0?(o(),r("div",rt,[e("div",lt,[e("ul",nt,[(o(!0),r(T,null,P(p.value.logs,(s,te)=>{var F;return o(),r("li",{key:s.id},[e("div",dt,[te!==p.value.logs.length-1?(o(),r("span",ct)):c("",!0),e("div",ut,[s.feedback?(o(),r(T,{key:0},[e("div",mt,[s.trainer.profilePhotoSrc?(o(),r("img",{key:0,class:"flex h-10 w-10 items-center justify-center rounded-full bg-gray-400 ring-8 ring-white",src:s.trainer.profilePhotoSrc,alt:"Trainer profile photo"},null,8,pt)):(o(),r("div",ft,[g(V,{class:"h-5 w-5 fill-gray-500","aria-hidden":"true"})])),e("span",gt,[g(t(Te),{class:"h-4 w-4 text-gray-400","aria-hidden":"true"})])]),e("div",_t,[e("div",null,[e("p",vt,[f(m(s.name)+" ",1),e("span",yt,"(with "+m(s.trainer.fullName)+")",1)]),e("p",ht,[f(" Training date: "),e("span",xt,m(s.date),1)])]),e("div",bt,[e("p",wt,' - "'+m(s.feedback)+'" ',1)])])],64)):s.feedback?c("",!0):(o(),r(T,{key:1},[e("div",kt,[e("div",Tt,[g(V,{class:"h-5 w-5 fill-gray-500","aria-hidden":"true"})])]),e("div",It,[e("div",Ut,[s.feedback?(o(),r("p",Ct,[f(m(s.name)+" ",1),e("span",At,"(with "+m(s.trainer.fullName)+")",1)])):(o(),r("p",{key:1,class:"font-medium text-gray-900",textContent:m(s.name)},null,8,St)),f(" Training date: "),e("span",Bt,m(s.date),1)])])],64)),t(S).selectedDepartment&&(t(K)(t(ve).MANAGE_TRAINING,t(S).selectedDepartment)||s.trainer.id===((F=t(U))==null?void 0:F.id))?(o(),r("button",{key:2,class:"group",onClick:jt=>W(s.id)},[t(d)({id:`deleteTrainingLog-${s.id.toString()}`,successMessage:"Training log deleted successfully.",errorMessage:"Failed to delete training log."})?(o(),u(I,{key:1,class:"h-5 w-5 text-red-400 group-hover:text-red-600"})):(o(),u(Ie,{key:0,class:"h-5 w-5 fill-red-400 group-hover:fill-red-600"}))],8,Dt)):c("",!0)])])])}),128))])])])):a.value&&!t(d)(t(n).getAllTrainingLogsByUserId)&&!t(d)(t(n).getAllTrainingLogsByUserId)?(o(),u(we,{key:1,title:`There are no training logs for ${a.value.trainee.fullName}`,message:"Use the form above to add a new training log."},null,8,["title"])):c("",!0),(o(),u(de,{to:"#modal"},[g(A,null,{default:x(()=>[k.value?(o(),r("div",{key:0,class:"pointer-events-auto fixed inset-0 isolate flex items-center justify-center overflow-x-auto bg-black/50",onClick:i[6]||(i[6]=s=>k.value=!1)},[e("div",Nt,[e("div",$t,[Ft,e("div",Mt,[e("button",{type:"button",class:"inline-flex items-center rounded-md bg-red-600 px-3 py-2 text-sm font-semibold text-white shadow-sm focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-red-500 hover:bg-red-500",onClick:i[4]||(i[4]=s=>k.value=!1)}," Cancel "),e("button",{type:"button",class:"inline-flex items-center rounded-md bg-blue-600 px-3 py-2 text-sm font-semibold text-white shadow-sm focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-500 hover:bg-blue-500",onClick:i[5]||(i[5]=s=>Z(D.value))}," Confirm ")])])])])):c("",!0)]),_:1})]))])])):c("",!0)])]}),_:1})}}}),go=Se(R,[["__scopeId","data-v-cdb3a060"]]);R.__docgenInfo={exportName:"default",displayName:"Train",description:"",tags:{},props:[{name:"userId",required:!0,type:{name:"number"}}],sourceFiles:["D:/work/server/htdocs/aa-portal.is/src/pages/staff/Train.vue"]};export{go as default};
