{"version":3,"file":"DepartureAssignStaffAndVehicles-8AoBdfT8.js","sources":["../../node_modules/.pnpm/@heroicons+vue@2.1.1_vue@3.4.7/node_modules/@heroicons/vue/16/solid/esm/MagnifyingGlassIcon.js","../../src/shared/api/user/query.ts","../../src/shared/api/vehicle/query.ts","../../src/features/departure/assign-staff-and-vehicles/DepartureAssignStaffAndVehicles.vue"],"sourcesContent":["import { createElementVNode as _createElementVNode, openBlock as _openBlock, createElementBlock as _createElementBlock } from \"vue\"\n\nexport default function render(_ctx, _cache) {\n  return (_openBlock(), _createElementBlock(\"svg\", {\n    xmlns: \"http://www.w3.org/2000/svg\",\n    viewBox: \"0 0 16 16\",\n    fill: \"currentColor\",\n    \"aria-hidden\": \"true\",\n    \"data-slot\": \"icon\"\n  }, [\n    _createElementVNode(\"path\", {\n      \"fill-rule\": \"evenodd\",\n      d: \"M9.965 11.026a5 5 0 1 1 1.06-1.06l2.755 2.754a.75.75 0 1 1-1.06 1.06l-2.755-2.754ZM10.5 7a3.5 3.5 0 1 1-7 0 3.5 3.5 0 0 1 7 0Z\",\n      \"clip-rule\": \"evenodd\"\n    })\n  ]))\n}","import { queryOptions, useQuery } from '@tanstack/vue-query'\n\nimport { getUsers } from './api'\nimport { type Keys } from '../lib'\n\nconst entity = 'user'\nconst Scopes = { All: 'all' }\n\nconst keys = { all: [{ entity, scope: Scopes.All }] as const } satisfies Keys\n\nexport {\n  keys as scheduledDepartureKeys,\n  entity as scheduledDepartureEntities,\n  Scopes as scheduledDepartureScopes,\n}\n\nexport function useUsersQuery() {\n  return queryOptions({\n    queryKey: keys.all,\n    queryFn: getUsers,\n  })\n}\n\nexport function useUsers() {\n  return useQuery(useUsersQuery())\n}\n","import type { MaybeRef } from 'vue'\nimport { queryOptions, useQuery } from '@tanstack/vue-query'\n\nimport { type Keys } from '../lib'\nimport { getVehicles } from './api'\n\nconst entity = 'vehicle'\nconst Scopes = { All: 'all' }\n\nconst keys = { all: [{ entity, scope: Scopes.All }] as const } satisfies Keys\n\nexport {\n  keys as vehicleKeys,\n  entity as vehicleEntity,\n  Scopes as vehicleScopes,\n}\n\nexport type UseVehicleOptions = {\n  enabled?: MaybeRef<boolean>\n}\n\nexport function useVehiclesQuery(options: UseVehicleOptions = {}) {\n  return queryOptions({\n    queryKey: keys.all,\n    queryFn: getVehicles,\n    ...options,\n  })\n}\n\nexport function useVehicles(options: UseVehicleOptions = {}) {\n  return useQuery(useVehiclesQuery(options))\n}\n","<script setup lang=\"ts\">\nimport { computed, ref, toRefs } from 'vue'\nimport { or } from '@vueuse/math'\nimport { createReusableTemplate, useCloned } from '@vueuse/core'\nimport { push } from 'notivue'\nimport { isDeepEqual, notNullish } from '@antfu/utils'\nimport { MagnifyingGlassIcon } from '@heroicons/vue/16/solid'\n\nimport type { ScheduledDeparture, User, Vehicle } from '@/shared/types'\nimport {\n  useDepartureSuggestedResources,\n  useScheduledDepartureUsersUpdate,\n} from '@/shared/api/scheduled-departure'\nimport { useUsers } from '@/shared/api/user'\nimport { useVehicles } from '@/shared/api/vehicle'\n\nimport { PButton } from '@/shared/ui/PButton'\nimport { PInput } from '@/shared/ui/PInput'\nimport { POverlay } from '@/shared/ui/POverlay'\nimport { BusIcon } from '@/shared/ui/icons'\nimport PersonIcon from '@/shared/ui/icons/IconPerson.vue'\n\nimport { SuggestedUser } from './ui/SuggestedUser'\nimport { SuggestedVehicle } from './ui/SuggestedVehicle'\nimport { ScheduledUser } from './ui/ScheduledUser'\n\nexport interface Props {\n  scheduledDepartureId: ScheduledDeparture['id'] | null\n  tourTime: string\n  tourName: string\n  scheduledUsers: ScheduledDeparture['scheduledUsers']\n}\n\nconst props = defineProps<Props>()\nconst { scheduledDepartureId, scheduledUsers } = toRefs(props)\n\nconst emit = defineEmits<{ close: [] }>()\n\nconst { cloned: scheduledUsersModel } = useCloned(scheduledUsers)\nconst isScheduledUsersChanged = computed(\n  () => !isDeepEqual(scheduledUsers.value, scheduledUsersModel.value),\n)\n\nconst selectedUserId = ref<User['id'] | null>(null)\nconst toggleSelectedUser = (userId: User['id']) => {\n  selectedUserId.value = selectedUserId.value !== userId ? userId : null\n}\n\nconst { data: users, isFetching: isUsersFetching } = useUsers()\nconst { data: vehicles, isFetching: isVehiclesFetching } = useVehicles({\n  enabled: or(selectedUserId, isScheduledUsersChanged),\n})\nconst {\n  data: suggestedResources,\n  isFetching: isSuggestedResourcesFetching,\n} = useDepartureSuggestedResources({\n  scheduledDepartureId,\n})\n\nconst searchModel = ref<string | null>(null)\n\nconst { mutate, isPending } = useScheduledDepartureUsersUpdate()\n\nconst assignUser = (userId: User['id']) => {\n  scheduledUsersModel.value?.push({ userId, vehicleId: null })\n\n  searchModel.value = null\n}\n\nconst removeUser = (userId: User['id']) => {\n  scheduledUsersModel.value = scheduledUsersModel.value.filter(\n    (i) => i.userId !== userId,\n  )\n}\n\nconst assignedUsers = computed(() =>\n  scheduledUsersModel.value?.map((entry) => {\n    const user = users.value?.find((i) => i.id === entry.userId)\n\n    if (!user) return null\n\n    return {\n      ...user,\n      vehicle: vehicles.value?.find((i) => i.id === entry.vehicleId) ?? null,\n    }\n  }).filter(notNullish),\n)\n\nconst suggestedUsers = computed(() => {\n  const searchTerm = searchModel.value?.toLowerCase().trim() ?? ''\n\n  return users.value?.filter(\n    (user) => suggestedResources.value?.users.includes(user.id),\n  ).filter(\n    (user) => !scheduledUsersModel.value.some((i) => i.userId === user.id),\n  ).filter(\n    (user) => user.name.toLowerCase().includes(searchTerm),\n  )\n})\n\nconst suggestedVehicles = computed(() => {\n  const searchTerm = searchModel.value?.toLowerCase().trim() ?? ''\n\n  return vehicles.value?.filter(\n    (vehicle) => suggestedResources.value?.vehicles.includes(vehicle.id),\n  ).filter(\n    (vehicle) => !scheduledUsersModel.value.some((i) => i.vehicleId === vehicle.id),\n  ).filter(\n    (vehicle) => vehicle.title.toLowerCase().includes(searchTerm),\n  )\n})\n\nconst assignedVehiclesCount = computed(() =>\n  scheduledUsersModel.value.map((item) => item.vehicleId).filter(notNullish).length,\n)\n\nconst setVehicleToPerson = (vehicleId: Vehicle['id']) => {\n  scheduledUsersModel.value.find(\n    (entry) => entry.userId === selectedUserId.value,\n  )!.vehicleId = vehicleId\n\n  selectedUserId.value = null\n  searchModel.value = ''\n}\n\nconst removeVehicle = (userId: User['id']) => {\n  scheduledUsersModel.value.find(\n    (entry) => entry.userId === userId,\n  )!.vehicleId = null\n}\n\nconst clearAll = () => {\n  scheduledUsersModel.value = []\n  selectedUserId.value = null\n}\n\nconst submit = () => {\n  mutate({\n    scheduledDepartureId: scheduledDepartureId.value!,\n    scheduledUsers: scheduledUsersModel.value,\n  }, {\n    onSuccess: () => {\n      push.success('Staff and vehicles updated')\n\n      emit('close')\n    },\n  })\n}\n\nconst [DefineNoAvailable, ReuseNoAvailable] = createReusableTemplate()\n</script>\n\n<template>\n  <form @submit.prevent=\"submit\">\n    <DefineNoAvailable v-slot=\"{ $slots }\">\n      <div\n        class=\"\n        flex h-full select-none items-center justify-center\n        text-sm font-medium text-slate-400\n        \"\n      >\n        <component :is=\"$slots.default\" />\n      </div>\n    </DefineNoAvailable>\n\n    <div>\n      <div class=\"flex items-center justify-between\">\n        <div class=\"flex items-center gap-4\">\n          <p class=\"font-medium text-gray-900 sm:text-lg\">\n            Select guides and vehicles\n          </p>\n\n          <div class=\"hidden items-center gap-1 min-[420px]:flex\">\n            <PersonIcon class=\"size-5 text-slate-400\" />\n\n            <div\n              class=\"\n              rounded-md border-[0.5px] border-zinc-200 bg-gray-100 px-2.5\n              py-0.5 font-medium text-gray-900\n              \"\n            >\n              {{ assignedUsers.length }}\n            </div>\n          </div>\n\n          <div class=\"hidden items-center gap-1 min-[420px]:flex\">\n            <BusIcon class=\"size-5 text-slate-400\" />\n\n            <div\n              class=\"\n              rounded-md border-[0.5px] border-zinc-200 bg-gray-100 px-2.5\n              py-0.5 font-medium text-gray-900\n              \"\n            >\n              {{ assignedVehiclesCount }}\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <p class=\"text-xs text-gray-500 sm:text-sm\">\n        {{ tourTime }} {{ tourName }}\n      </p>\n    </div>\n\n    <div class=\"mt-4 flex h-72 flex-col gap-4 sm:flex-row\">\n      <div class=\"flex min-w-56 flex-col gap-2\">\n        <div class=\"relative\">\n          <PInput v-model=\"searchModel\" placeholder=\"Search guides\" />\n\n          <MagnifyingGlassIcon\n            class=\"absolute right-4 top-[11px] size-4 text-gray-500\"\n          />\n        </div>\n\n        <div class=\"text-xs font-medium text-gray-500\">\n          Suggested:\n        </div>\n\n        <POverlay\n          class=\"\n          flex h-32 grow flex-col gap-1 overflow-y-auto rounded-md bg-gray-50\n          shadow shadow-slate-400/40 scrollbar-thin\n          scrollbar-track-gray-100 scrollbar-thumb-blue-500/25 sm:h-auto\n          \"\n          :show=\"\n            isSuggestedResourcesFetching || isUsersFetching || isVehiclesFetching\n          \"\n        >\n          <div class=\"h-full\">\n            <template v-if=\"!selectedUserId\">\n              <template v-if=\"suggestedUsers?.length\">\n                <SuggestedUser\n                  v-for=\"{ id, name, avatar } in suggestedUsers\"\n                  :key=\"id\"\n                  :avatar=\"avatar\"\n                  :name=\"name\"\n                  @click=\"assignUser(id)\"\n                />\n              </template>\n              <ReuseNoAvailable v-else>\n                Not available staff\n              </ReuseNoAvailable>\n            </template>\n            <template v-else>\n              <div v-if=\"suggestedVehicles?.length\">\n                <SuggestedVehicle\n                  v-for=\"{ id, title, registrationNumber } in suggestedVehicles\"\n                  :key=\"id\"\n                  :registration-number=\"registrationNumber\"\n                  :title=\"title\"\n                  @click=\"setVehicleToPerson(id)\"\n                />\n              </div>\n              <ReuseNoAvailable v-else>\n                Not available vehicles\n              </ReuseNoAvailable>\n            </template>\n          </div>\n        </POverlay>\n      </div>\n\n      <div\n        class=\"\n        h-52 w-full overflow-y-auto rounded-md bg-gray-50 py-1\n        shadow shadow-slate-400/40 scrollbar-thin\n        scrollbar-track-gray-100 scrollbar-thumb-blue-500/25 sm:h-auto\n        \"\n      >\n        <div v-if=\"assignedUsers.length\">\n          <ScheduledUser\n            v-for=\"{ id, name, avatar, phone, vehicle } in assignedUsers\"\n            :key=\"id\"\n            :name=\"name\"\n            :avatar=\"avatar\"\n            :phone=\"phone\"\n            :vehicle-title=\"vehicle?.title ?? null\"\n            :selected=\"id === selectedUserId\"\n            :disable-remove=\"!!selectedUserId\"\n            @click=\"!vehicle ? toggleSelectedUser(id) : undefined\"\n            @remove=\"removeUser(id)\"\n            @remove-vehicle=\"removeVehicle(id)\"\n          />\n        </div>\n\n        <ReuseNoAvailable v-else>\n          Drop your staff for departure here\n        </ReuseNoAvailable>\n      </div>\n    </div>\n\n    <div class=\"mt-4 flex items-center justify-between\">\n      <button\n        v-if=\"assignedUsers.length && !selectedUserId\"\n        class=\"\n        select-none text-sm font-medium text-gray-500\n        transition-colors duration-200 hover:text-gray-600\n        \"\n        type=\"button\"\n        @click=\"clearAll\"\n      >\n        Clear all\n      </button>\n\n      <button\n        v-if=\"selectedUserId\"\n        class=\"\n        select-none text-sm font-medium text-blue-600\n        transition-colors duration-200 hover:text-blue-500\n        \"\n        type=\"button\"\n        @click=\"selectedUserId = null\"\n      >\n        Cancel\n      </button>\n\n      <POverlay class=\"ml-auto\" :show=\"isPending\">\n        <PButton\n          class=\"\n          border border-gray-300 bg-white px-10 text-black disabled:pointer-events-none\n        disabled:bg-gray-200 disabled:text-gray-500 hover:bg-blue-200 sm:w-auto\n          \"\n          size=\"lg\"\n          type=\"submit\"\n          :disabled=\"!isScheduledUsersChanged\"\n        >\n          Save\n        </PButton>\n      </POverlay>\n    </div>\n  </form>\n</template>\n"],"names":["render","_ctx","_cache","_openBlock","_createElementBlock","_createElementVNode","entity","Scopes","keys","useUsersQuery","queryOptions","getUsers","useUsers","useQuery","useVehiclesQuery","options","getVehicles","useVehicles","props","__props","scheduledDepartureId","scheduledUsers","toRefs","emit","__emit","scheduledUsersModel","useCloned","isScheduledUsersChanged","computed","isDeepEqual","selectedUserId","ref","toggleSelectedUser","userId","users","isUsersFetching","vehicles","isVehiclesFetching","or","suggestedResources","isSuggestedResourcesFetching","useDepartureSuggestedResources","searchModel","mutate","isPending","useScheduledDepartureUsersUpdate","assignUser","_a","removeUser","i","assignedUsers","entry","user","_b","notNullish","suggestedUsers","searchTerm","suggestedVehicles","vehicle","assignedVehiclesCount","item","setVehicleToPerson","vehicleId","removeVehicle","clearAll","submit","push","DefineNoAvailable","ReuseNoAvailable","createReusableTemplate"],"mappings":"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","x_google_ignoreList":[0]}