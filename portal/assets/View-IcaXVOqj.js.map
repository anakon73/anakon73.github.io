{"version":3,"file":"View-IcaXVOqj.js","sources":["../../src/pages/deviations/View.vue"],"sourcesContent":["<script setup lang=\"ts\">\nimport { onMounted, ref, toRefs, watch } from 'vue'\nimport { useRouter } from 'vue-router'\nimport RightDrawer from '@/shared/ui/layout/RightDrawer.vue'\nimport { useUser } from '@/shared/api/useUser'\nimport { useUi } from '@/shared/lib/composables/useUi'\nimport IconClose from '@/shared/ui/icons/IconClose.vue'\nimport ProgressSpinner from '@/shared/ui/ProgressSpinner.vue'\nimport { useDeviation } from '@/shared/api/useDeviation'\nimport type { IDeviation } from '@/shared/types/deviations/IDeviation'\nimport { AppPermissions } from '@/shared/types/enums/permissions/permissions'\nimport { Routes } from '@/shared/lib/router'\n\nconst props = defineProps<{ deviationId: number }>()\nconst { deviationId } = toRefs(props)\n\nconst { actionIsInProgress } = useUi()\nconst { deviationActions, getDeviationById } = useDeviation()\nconst { fetchAndStoreUsersIndex, userActions } = useUser()\nconst { user } = useUser()\n\nconst viewDeviationFormData = ref<IDeviation | null>(null)\n\nconst router = useRouter()\nconst canManageDeviations = user.value?.permissions?.some((permission) => {\n  return permission.permission.slug === AppPermissions.MANAGE_DEVIATIONS\n})\n\nonMounted(async () => {\n  const primaryDepartment = user.value?.departments.find((department) => department.primary)\n\n  if (primaryDepartment) {\n    const [deviation] = await Promise.all([\n      await getDeviationById(deviationId.value.toString()),\n      fetchAndStoreUsersIndex(\n        primaryDepartment.id,\n        false,\n      ),\n    ])\n\n    if (!canManageDeviations && deviation?.staffMemberInvolved.id !== user.value?.id) {\n      await router.push({ name: Routes.Forbidden })\n    }\n    else {\n      viewDeviationFormData.value = deviation as IDeviation\n    }\n  }\n})\n\nwatch(\n  deviationId,\n  async (newId) => {\n    if (newId) {\n      const rsp = await getDeviationById(newId.toString())\n\n      if (rsp) {\n        viewDeviationFormData.value = rsp\n      }\n    }\n  },\n)\n</script>\n\n<template>\n  <RightDrawer>\n    <div class=\"isolate flex flex-col items-center justify-center border-l bg-white pb-6\">\n      <div class=\"sticky top-0 z-10 flex w-full items-center justify-end bg-white p-6\">\n        <ProgressSpinner\n          v-if=\"actionIsInProgress(deviationActions.getDeviationById)\n            || actionIsInProgress(userActions.getAllUsers)\"\n          class=\"h-5 w-5 text-blue-500\"\n        />\n        <RouterLink\n          v-else\n          :to=\"{ name: $Routes.Deviations }\"\n        >\n          <IconClose class=\"h-5 w-5 fill-red-400\" />\n        </RouterLink>\n      </div>\n\n      <form\n        id=\"create_deviation_form\"\n        class=\"w-full space-y-8 divide-y divide-gray-200 px-6 md:px-12\"\n      >\n        <div class=\"mb-6\">\n          <h3 class=\"text-base font-semibold leading-6 text-gray-900\">\n            View deviation.\n          </h3>\n          <p class=\"mt-1 text-sm text-gray-500\">\n            Details of the deviation are shown below.\n          </p>\n        </div>\n\n        <template v-if=\"viewDeviationFormData\">\n          <div class=\"grid grid-cols-1 gap-x-4 gap-y-6 pt-6 sm:grid-cols-6\">\n            <div class=\"sm:col-span-3\">\n              <label for=\"deviation_date_input\" class=\"block text-sm font-medium text-gray-700\">\n                Date and Time\n              </label>\n              <div class=\"mt-1\">\n                <input\n                  id=\"deviation_date_input\"\n                  v-model=\"viewDeviationFormData.dateInput\"\n                  type=\"datetime-local\"\n                  class=\"block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm\"\n                  disabled\n                >\n              </div>\n            </div>\n            <div class=\"sm:col-span-3\">\n              <label for=\"staff_involved_id\" class=\"block text-sm font-medium text-gray-700\">\n                Staff Involved\n              </label>\n              <div class=\"mt-1\">\n                <select\n                  id=\"staff_involved_id\"\n                  v-model=\"viewDeviationFormData.staffMemberInvolved.fullName\"\n                  class=\"block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm\"\n                  required\n                  disabled\n                >\n                  <option>\n                    {{ viewDeviationFormData.staffMemberInvolved.fullName }}\n                  </option>\n                </select>\n              </div>\n            </div>\n            <div class=\"sm:col-span-3\">\n              <label for=\"staff_involved_id\" class=\"block text-sm font-medium text-gray-700\">\n                Staff Reporting\n              </label>\n              <div class=\"mt-1\">\n                <select\n                  id=\"staff_involved_id\"\n                  v-model=\"viewDeviationFormData.staffMemberReporting.fullName\"\n                  class=\"block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm\"\n                  required\n                  disabled\n                >\n                  <option>\n                    {{ viewDeviationFormData.staffMemberReporting.fullName }}\n                  </option>\n                </select>\n              </div>\n            </div>\n          </div>\n\n          <div class=\"grid grid-cols-1 gap-x-4 gap-y-6 pt-6 sm:grid-cols-6\">\n            <div class=\"sm:col-span-6\">\n              <label for=\"category\" class=\"block text-sm font-medium text-gray-700\">\n                Category\n              </label>\n              <div class=\"mt-1\">\n                <select\n                  id=\"category\"\n                  v-model=\"viewDeviationFormData.categoryLabel\"\n                  class=\"block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm\"\n                  disabled\n                >\n                  <option>\n                    {{ viewDeviationFormData.categoryLabel }}\n                  </option>\n                </select>\n              </div>\n            </div>\n          </div>\n\n          <div class=\"grid grid-cols-1 gap-x-4 gap-y-6 pt-6 sm:grid-cols-6\">\n            <div class=\"sm:col-span-6\">\n              <label for=\"incident_description\" class=\"block text-sm font-medium text-gray-700 sm:mt-px sm:pt-2\">\n                Details of the incident\n              </label>\n              <div class=\"mt-1 sm:col-span-2\">\n                <textarea\n                  id=\"incident_description\"\n                  v-model=\"viewDeviationFormData.details\"\n                  rows=\"3\"\n                  class=\"block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm\"\n                  disabled\n                />\n              </div>\n            </div>\n          </div>\n        </template>\n      </form>\n    </div>\n  </RightDrawer>\n</template>\n"],"names":["props","__props","deviationId","toRefs","actionIsInProgress","useUi","deviationActions","getDeviationById","useDeviation","fetchAndStoreUsersIndex","userActions","useUser","user","viewDeviationFormData","ref","router","useRouter","canManageDeviations","_b","_a","permission","AppPermissions","onMounted","primaryDepartment","department","deviation","Routes","watch","newId","rsp"],"mappings":"suIAaA,MAAMA,EAAQC,EACR,CAAE,YAAAC,CAAA,EAAgBC,EAAOH,CAAK,EAE9B,CAAE,mBAAAI,GAAuBC,IACzB,CAAE,iBAAAC,EAAkB,iBAAAC,CAAiB,EAAIC,EAAa,EACtD,CAAE,wBAAAC,EAAyB,YAAAC,CAAY,EAAIC,EAAQ,EACnD,CAAE,KAAAC,GAASD,IAEXE,EAAwBC,EAAuB,IAAI,EAEnDC,EAASC,IACTC,GAAsBC,GAAAC,EAAAP,EAAK,QAAL,YAAAO,EAAY,cAAZ,YAAAD,EAAyB,KAAME,GAClDA,EAAW,WAAW,OAASC,EAAe,mBAGvD,OAAAC,EAAU,SAAY,SACd,MAAAC,GAAoBJ,EAAAP,EAAK,QAAL,YAAAO,EAAY,YAAY,KAAMK,GAAeA,EAAW,SAElF,GAAID,EAAmB,CACrB,KAAM,CAACE,CAAS,EAAI,MAAM,QAAQ,IAAI,CACpC,MAAMlB,EAAiBL,EAAY,MAAM,UAAU,EACnDO,EACEc,EAAkB,GAClB,EACF,CAAA,CACD,EAEG,CAACN,IAAuBQ,GAAA,YAAAA,EAAW,oBAAoB,QAAOP,EAAAN,EAAK,QAAL,YAAAM,EAAY,IAC5E,MAAMH,EAAO,KAAK,CAAE,KAAMW,EAAO,UAAW,EAG5Cb,EAAsB,MAAQY,CAElC,CAAA,CACD,EAEDE,EACEzB,EACA,MAAO0B,GAAU,CACf,GAAIA,EAAO,CACT,MAAMC,EAAM,MAAMtB,EAAiBqB,EAAM,SAAU,CAAA,EAE/CC,IACFhB,EAAsB,MAAQgB,EAElC,CACF,CAAA"}