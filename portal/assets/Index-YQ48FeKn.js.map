{"version":3,"file":"Index-YQ48FeKn.js","sources":["../../src/shared/api/useEODReport.ts","../../src/pages/eod-report/Index.vue"],"sourcesContent":["import { storeToRefs } from 'pinia'\nimport { useUserStore } from '@/shared/api/stores/user'\nimport { useUi } from '@/shared/lib/composables/useUi'\nimport type { IAction } from '@/shared/types/api/IAction'\nimport { useApiClient } from '@/shared/api/useApiClient'\nimport type { IEODReportLog } from '@/shared/types/eod-report/IEODReport'\nimport type { IOperationalBase } from '@/shared/types/operational-bases/IOperationalBase'\n\nexport function useEODReport() {\n  const { apiClient } = useApiClient()\n  const {\n    addToActionsInProgress,\n    removeFromActionsInProgress,\n    processActionError,\n    processActionSuccess,\n    resetActionsInError,\n    resetActionsInSuccess,\n  } = useUi()\n  const { user } = storeToRefs(useUserStore())\n\n  const eodReportActions = {\n    sendEODReport: {\n      id: 'sendEODReport',\n      successMessage: 'EOD Report sent successfully.',\n      errorMessage: 'There was a problem sending the EOD Report.',\n    } as IAction,\n    getEODReportByDate: {\n      id: 'getEODReportByDate',\n      successMessage: 'EOD Report retrieved successfully.',\n      errorMessage: 'There was a problem retrieving the EOD Report.',\n    } as IAction,\n  }\n\n  const apiGetEODReportByOpBaseAndDate = async (\n    operationalBase: IOperationalBase,\n    date: string,\n  ): Promise<IEODReportLog | void> => {\n    resetActionsInError()\n    addToActionsInProgress(eodReportActions.getEODReportByDate)\n\n    try {\n      const rsp = await apiClient.get('/api/eod-report', {\n        params: {\n          selectedOperationalBaseId: operationalBase.id,\n          selectedDate: date,\n        },\n      })\n\n      removeFromActionsInProgress(eodReportActions.getEODReportByDate)\n\n      return rsp.data\n    }\n    catch (e: any) {\n      processActionError(eodReportActions.getEODReportByDate, e)\n    }\n  }\n\n  const sendEODReport = async (eodReport: IEODReportLog) => {\n    resetActionsInError()\n    resetActionsInSuccess()\n    addToActionsInProgress(eodReportActions.sendEODReport)\n\n    try {\n      await apiClient.post('/api/eod-report', eodReport)\n\n      removeFromActionsInProgress(eodReportActions.sendEODReport)\n      processActionSuccess(eodReportActions.sendEODReport)\n      setTimeout(() => {\n        resetActionsInSuccess()\n      }, 3000)\n    }\n    catch (e: any) {\n      console.log(e)\n      processActionError(eodReportActions.sendEODReport, e)\n    }\n  }\n\n  return {\n    user,\n    eodReportActions,\n    apiGetEODReportByOpBaseAndDate,\n    sendEODReport,\n  }\n}\n","<script setup lang=\"ts\">\nimport { ref, watch } from 'vue'\nimport { storeToRefs } from 'pinia'\nimport MainContent from '@/shared/ui/layout/MainContent.vue'\nimport { useUi } from '@/shared/lib/composables/useUi'\nimport { useEODReport } from '@/shared/api/useEODReport'\nimport VDataFilters from '@/shared/ui/inputs/VDataFilters.vue'\nimport type { IDataFilters } from '@/shared/types/inputs/IDataFilters'\nimport type { IEODReportLog } from '@/shared/types/eod-report/IEODReport'\nimport FeedbackWarning from '@/shared/ui/FeedbackWarning.vue'\nimport IconTickMarkCircle from '@/shared/ui/icons/IconTickMarkCircle.vue'\nimport { AppPermissions } from '@/shared/types/enums/permissions/permissions'\nimport VActionButton from '@/shared/ui/forms/VActionButton.vue'\nimport { useUserStore } from '@/shared/api/stores/user'\nimport IconCash from '@/shared/ui/icons/IconCash.vue'\nimport IconCreditCard from '@/shared/ui/icons/IconCreditCard.vue'\n\nconst { actionIsInProgress, getActionSuccessMessage, actionIsInSuccess, validateForm } = useUi()\nconst {\n  sendEODReport,\n  apiGetEODReportByOpBaseAndDate,\n  eodReportActions,\n} = useEODReport()\n\nconst { user } = storeToRefs(useUserStore())\n\nconst eodReportFormElement = ref<HTMLFormElement | null>(null)\n\nconst filterState = ref<IDataFilters>({\n  selectedDepartment: null,\n  selectedOperationalBase: null,\n  selectedRole: null,\n  selectedMonth: '',\n  selectedDate: '',\n})\n\nconst eodReportLog = ref<IEODReportLog | null>(null)\nconst loading = ref(true)\n\nconst handleFilterStateUpdate = async (newFilterState: IDataFilters) => {\n  filterState.value = newFilterState\n}\n\nconst handleFormSubmission = async () => {\n  await validateForm(\n    eodReportFormElement.value,\n    async () => {\n      if (eodReportLog.value) {\n        eodReportLog.value.user = user.value\n        await sendEODReport(eodReportLog.value)\n      }\n    },\n  )\n}\n\nwatch (\n  () => filterState.value,\n  async (newValue, oldValue) => {\n    if (newValue !== oldValue) {\n      if (\n        filterState.value.selectedDepartment\n        && filterState.value.selectedOperationalBase\n        && filterState.value.selectedDate\n      ) {\n        const eodReport = await apiGetEODReportByOpBaseAndDate(\n          filterState.value.selectedOperationalBase,\n          filterState.value.selectedDate,\n        )\n\n        if (eodReport) {\n          eodReportLog.value = {\n            id: eodReport.id,\n            departmentId: eodReport.departmentId,\n            eodReportFormId: eodReport.eodReportFormId,\n            user: eodReport.user ? eodReport.user : null,\n            date: eodReport.date,\n            eodReportFormItems: eodReport.eodReportFormItems,\n            eodReportLogItems: eodReport.eodReportLogItems,\n          }\n        }\n        else {\n          eodReportLog.value = null\n        }\n\n        loading.value = false\n      }\n    }\n  },\n)\n</script>\n\n<template>\n  <MainContent main-content-title=\"EOD Report\">\n    <form\n      ref=\"eodReportFormElement\"\n      class=\"space-y-8 divide-y divide-gray-200\"\n    >\n      <div>\n        <VDataFilters\n          :department-permissions-required=\"[\n            AppPermissions.VIEW_END_OF_DAY_REPORTS,\n          ]\"\n          filter-by-operational-bases\n          filter-by-date\n          :filter-state=\"filterState\"\n          @filter-state-updated=\"handleFilterStateUpdate\"\n        />\n      </div>\n      <div class=\"space-y-8 divide-y divide-gray-200 sm:space-y-5\">\n        <div class=\"space-y-6 sm:space-y-5\">\n          <FeedbackWarning\n            v-if=\"!loading && !eodReportLog && !actionIsInProgress(eodReportActions.getEODReportByDate)\"\n            title=\"No EOD Report form found\"\n            message=\"We couldn't find an EOD Report form for the selected department and operational base!\"\n          />\n          <FeedbackWarning\n            v-if=\"eodReportLog && eodReportLog.id\"\n            title=\"Just so you know...\"\n            :message=\"`An EOD Report for ${filterState.selectedDate} was already submitted by ${eodReportLog.user?.fullName} for ${filterState.selectedOperationalBase?.name}.`\"\n          />\n\n          <div\n            v-if=\"eodReportLog\"\n            class=\"max-w-[625px] space-y-6 sm:space-y-5\"\n          >\n            <div\n              v-for=\"(formItem, i) in eodReportLog.eodReportFormItems\"\n              :key=\"i\"\n              class=\"sm:grid sm:grid-cols-3 sm:items-start sm:gap-4 sm:border-t sm:border-gray-200 sm:pt-5\"\n            >\n              <label for=\"departures\" class=\"block text-sm font-medium text-gray-700 sm:mt-px sm:pt-2\">\n                {{ formItem.label }}  <span class=\"text-xs font-normal\">({{ formItem.category }})</span>\n              </label>\n\n              <div class=\"relative mt-1 lg:mt-0\">\n                <div class=\"absolute inset-y-0 left-0 m-[1px] flex w-10 items-center justify-center rounded-l border-r border-gray-300 bg-gray-200\">\n                  <IconCreditCard class=\"h-4 w-4 fill-gray-500\" />\n                </div>\n                <input\n                  v-model.number=\"eodReportLog.eodReportLogItems[i].card\"\n                  type=\"number\"\n                  min=\"0\"\n                  required\n                  class=\"block w-40 rounded-md border-gray-300 pl-14 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm\"\n                >\n              </div>\n              <div class=\"relative mt-1 lg:mt-0\">\n                <div class=\"absolute inset-y-0 left-0 m-[1px] flex w-10 items-center justify-center rounded-l border-r border-gray-300 bg-gray-200\">\n                  <IconCash class=\"h-4 w-4 fill-gray-500\" />\n                </div>\n                <input\n                  v-model.number=\"eodReportLog.eodReportLogItems[i].cash\"\n                  type=\"number\"\n                  min=\"0\"\n                  required\n                  class=\"block w-40 rounded-md border-gray-300 pl-14 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm\"\n                >\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <VActionButton\n        v-if=\"eodReportLog && filterState.selectedDepartment\"\n        :action=\"handleFormSubmission\"\n        :permission-required=\"{\n          permission: AppPermissions.MANAGE_EOD_REPORTS,\n          department: filterState.selectedDepartment,\n        }\"\n        :loading=\"actionIsInProgress(eodReportActions.sendEODReport)\"\n        label=\"Save EOD Report\"\n      />\n\n      <Transition name=\"save\">\n        <div\n          v-if=\"actionIsInSuccess(eodReportActions.sendEODReport)\"\n          class=\"fixed inset-x-0 top-0 flex justify-center p-2\"\n        >\n          <div class=\"w-64 rounded-md border border-green-100 bg-green-50 p-3 md:p-4\">\n            <div class=\"flex\">\n              <div class=\"shrink-0\">\n                <IconTickMarkCircle class=\"h-5 w-5 fill-green-400\" />\n              </div>\n              <div class=\"ml-3\">\n                <p\n                  class=\"text-sm text-green-700\"\n                  v-html=\"getActionSuccessMessage(eodReportActions.sendEODReport)\"\n                />\n              </div>\n            </div>\n          </div>\n        </div>\n      </Transition>\n    </form>\n  </MainContent>\n</template>\n\n<style scoped>\n.v-enter-active,\n.v-leave-active {\n  transition: opacity 0.2s ease;\n}\n.v-leave-to {\n  transition-delay: 0.5s;\n  opacity: 0;\n}\n\n.save-enter-active,\n.save-leave-active {\n  transition: transform 0.2s ease-in-out;\n}\n.save-enter-from,\n.save-leave-to {\n  transform: translateY(-100%);\n}\n</style>\n"],"names":["useEODReport","apiClient","useApiClient","addToActionsInProgress","removeFromActionsInProgress","processActionError","processActionSuccess","resetActionsInError","resetActionsInSuccess","useUi","user","storeToRefs","useUserStore","eodReportActions","operationalBase","date","rsp","e","eodReport","actionIsInProgress","getActionSuccessMessage","actionIsInSuccess","validateForm","sendEODReport","apiGetEODReportByOpBaseAndDate","eodReportFormElement","ref","filterState","eodReportLog","loading","handleFilterStateUpdate","newFilterState","handleFormSubmission","watch","newValue","oldValue"],"mappings":"ugGAQO,SAASA,IAAe,CACvB,KAAA,CAAE,UAAAC,GAAcC,IAChB,CACJ,uBAAAC,EACA,4BAAAC,EACA,mBAAAC,EACA,qBAAAC,EACA,oBAAAC,EACA,sBAAAC,GACEC,EAAM,EACJ,CAAE,KAAAC,CAAS,EAAAC,EAAYC,EAAc,CAAA,EAErCC,EAAmB,CACvB,cAAe,CACb,GAAI,gBACJ,eAAgB,gCAChB,aAAc,6CAChB,EACA,mBAAoB,CAClB,GAAI,qBACJ,eAAgB,qCAChB,aAAc,gDAChB,CAAA,EA+CK,MAAA,CACL,KAAAH,EACA,iBAAAG,EACA,+BA/CqC,MACrCC,EACAC,IACkC,CACdR,IACpBJ,EAAuBU,EAAiB,kBAAkB,EAEtD,GAAA,CACF,MAAMG,EAAM,MAAMf,EAAU,IAAI,kBAAmB,CACjD,OAAQ,CACN,0BAA2Ba,EAAgB,GAC3C,aAAcC,CAChB,CAAA,CACD,EAED,OAAAX,EAA4BS,EAAiB,kBAAkB,EAExDG,EAAI,WAENC,EAAQ,CACMZ,EAAAQ,EAAiB,mBAAoBI,CAAC,CAC3D,CAAA,EA2BA,cAxBoB,MAAOC,GAA6B,CACpCX,IACEC,IACtBL,EAAuBU,EAAiB,aAAa,EAEjD,GAAA,CACI,MAAAZ,EAAU,KAAK,kBAAmBiB,CAAS,EAEjDd,EAA4BS,EAAiB,aAAa,EAC1DP,EAAqBO,EAAiB,aAAa,EACnD,WAAW,IAAM,CACOL,KACrB,GAAI,QAEFS,EAAQ,CACb,QAAQ,IAAIA,CAAC,EACMZ,EAAAQ,EAAiB,cAAeI,CAAC,CACtD,CAAA,CAOA,CAEJ,i5BClEA,KAAM,CAAE,mBAAAE,EAAoB,wBAAAC,EAAyB,kBAAAC,EAAmB,aAAAC,CAAA,EAAiBb,IACnF,CACJ,cAAAc,EACA,+BAAAC,EACA,iBAAAX,GACEb,GAAa,EAEX,CAAE,KAAAU,CAAS,EAAAC,EAAYC,EAAc,CAAA,EAErCa,EAAuBC,EAA4B,IAAI,EAEvDC,EAAcD,EAAkB,CACpC,mBAAoB,KACpB,wBAAyB,KACzB,aAAc,KACd,cAAe,GACf,aAAc,EAAA,CACf,EAEKE,EAAeF,EAA0B,IAAI,EAC7CG,EAAUH,EAAI,EAAI,EAElBI,EAA0B,MAAOC,GAAiC,CACtEJ,EAAY,MAAQI,CAAA,EAGhBC,EAAuB,SAAY,CACjC,MAAAV,EACJG,EAAqB,MACrB,SAAY,CACNG,EAAa,QACFA,EAAA,MAAM,KAAOlB,EAAK,MACzB,MAAAa,EAAcK,EAAa,KAAK,EAE1C,CAAA,CACF,EAGF,OAAAK,EACE,IAAMN,EAAY,MAClB,MAAOO,EAAUC,IAAa,CAC5B,GAAID,IAAaC,GAEbR,EAAY,MAAM,oBACfA,EAAY,MAAM,yBAClBA,EAAY,MAAM,aACrB,CACA,MAAMT,EAAY,MAAMM,EACtBG,EAAY,MAAM,wBAClBA,EAAY,MAAM,YAAA,EAGhBT,EACFU,EAAa,MAAQ,CACnB,GAAIV,EAAU,GACd,aAAcA,EAAU,aACxB,gBAAiBA,EAAU,gBAC3B,KAAMA,EAAU,KAAOA,EAAU,KAAO,KACxC,KAAMA,EAAU,KAChB,mBAAoBA,EAAU,mBAC9B,kBAAmBA,EAAU,iBAAA,EAI/BU,EAAa,MAAQ,KAGvBC,EAAQ,MAAQ,EAClB,CAEJ,CAAA"}