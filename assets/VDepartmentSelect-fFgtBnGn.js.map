{"version":3,"file":"VDepartmentSelect-fFgtBnGn.js","sources":["../../src/shared/ui/inputs/VDepartmentSelect.vue"],"sourcesContent":["<script setup lang=\"ts\">\nimport { onMounted, ref, watch } from 'vue'\nimport ProgressSpinner from '@/shared/ui/ProgressSpinner.vue'\nimport type { IDepartment } from '@/shared/types/departments/IDepartments'\nimport { useDepartment } from '@/shared/api/departments/useDepartment'\nimport { useUi } from '@/shared/lib/composables/useUi'\nimport type { IUserDepartment } from '@/shared/types/user/IUser'\nimport type { AppPermissions } from '@/shared/types/enums/permissions/permissions'\nimport { useAuth } from '@/shared/api/useAuth'\n\ninterface IProps {\n  departmentOptions?: IDepartment[]\n  initialSelectedDepartment?: IUserDepartment | null\n  label?: string\n  departmentPermissionsRequired?: AppPermissions[]\n}\nconst {\n  departmentOptions = [],\n  initialSelectedDepartment = null,\n  label,\n  departmentPermissionsRequired = [],\n} = defineProps<IProps>()\n\nconst emits = defineEmits<{\n  updatePrimaryDepartment: [department: IDepartment]\n}>()\n\nconst { actionIsInProgress } = useUi()\nconst { userHasSomePermissionsInDepartment } = useAuth()\nconst {\n  departmentActions,\n  apiGetDepartments,\n} = useDepartment()\n\nconst selectedDepartment = defineModel<IDepartment>()\n\nconst departments = ref<IDepartment[]>([])\n\nonMounted(async () => {\n  if (departmentOptions.length > 0) {\n    departments.value = departmentOptions\n    if (initialSelectedDepartment) {\n      selectedDepartment.value = initialSelectedDepartment\n    }\n    return\n  }\n\n  departments.value = await apiGetDepartments()\n  if (departmentPermissionsRequired.length > 0) {\n    departments.value = departments.value.filter((d) => {\n      return userHasSomePermissionsInDepartment(departmentPermissionsRequired, d)\n    })\n  }\n  else {\n    departments.value = departmentOptions\n  }\n})\n\nwatch(selectedDepartment, (newValue) => {\n  if (newValue) {\n    emits('updatePrimaryDepartment', newValue)\n  }\n})\n\nwatch(() => departmentOptions, (newValue) => {\n  if (newValue.length === 1) {\n    selectedDepartment.value = newValue[0]\n  }\n}, {\n  deep: true,\n  immediate: true,\n})\n</script>\n\n<template>\n  <div\n    class=\"relative\"\n    :class=\"{\n      'cursor-not-allowed opacity-50': actionIsInProgress(departmentActions.getDepartments),\n      'hidden': departments.length === 1,\n    }\"\n  >\n    <p\n      v-if=\"label\"\n      class=\"mb-2 text-sm font-medium text-gray-700\"\n    >\n      {{ label }}\n    </p>\n    <select\n      v-model=\"selectedDepartment\"\n      class=\"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:min-w-[250px] sm:text-sm\"\n      :disabled=\"departments.length === 1\"\n      :class=\"{ 'bg-gray-200 bg-none': departments.length === 1 }\"\n    >\n      <option\n        v-for=\"department in departments\"\n        :key=\"department.id\"\n        :value=\"department\"\n      >\n        {{ department.name }}\n      </option>\n    </select>\n    <div\n      v-if=\"actionIsInProgress(departmentActions.getDepartments)\"\n      class=\"absolute inset-0 flex items-center justify-center\"\n    >\n      <ProgressSpinner class=\"h-4 w-4 text-blue-500\" />\n    </div>\n  </div>\n</template>\n"],"names":["emits","__emit","actionIsInProgress","useUi","userHasSomePermissionsInDepartment","useAuth","departmentActions","apiGetDepartments","useDepartment","selectedDepartment","_useModel","departments","ref","onMounted","__props","d","watch","newValue"],"mappings":"sxBAuBA,MAAMA,EAAQC,EAIR,CAAE,mBAAAC,GAAuBC,IACzB,CAAE,mCAAAC,GAAuCC,IACzC,CACJ,kBAAAC,EACA,kBAAAC,GACEC,EAAc,EAEZC,EAAqBC,gBAAyB,EAE9CC,EAAcC,EAAmB,CAAA,CAAE,EAEzC,OAAAC,EAAU,SAAY,CAChB,GAAAC,EAAA,kBAAkB,OAAS,EAAG,CAChCH,EAAY,MAAQG,EAAiB,kBACjCA,EAAA,4BACFL,EAAmB,MAAQK,EAAyB,2BAEtD,MACF,CAEYH,EAAA,MAAQ,MAAMJ,IACtBO,EAAA,8BAA8B,OAAS,EACzCH,EAAY,MAAQA,EAAY,MAAM,OAAQI,GACrCX,EAAmCU,EAA6B,8BAAEC,CAAC,CAC3E,EAGDJ,EAAY,MAAQG,EAAiB,iBACvC,CACD,EAEKE,EAAAP,EAAqBQ,GAAa,CAClCA,GACFjB,EAAM,0BAA2BiB,CAAQ,CAC3C,CACD,EAEDD,EAAM,IAAMF,EAAA,kBAAoBG,GAAa,CACvCA,EAAS,SAAW,IACHR,EAAA,MAAQQ,EAAS,CAAC,EACvC,EACC,CACD,KAAM,GACN,UAAW,EAAA,CACZ"}