{"version":3,"file":"Incidents-1vlucW3a.js","sources":["../../src/shared/api/metrics/useIncidentMetrics.ts","../../src/pages/metrics/Incidents.vue"],"sourcesContent":["import { ref } from 'vue'\nimport { useApiClient } from '@/shared/api/useApiClient'\n\nexport function useIncidentMetrics() {\n  const { apiClient } = useApiClient()\n\n  /**\n   * Incidents by location\n   */\n  const chartDataIncidentsByLocationOptions = ref({\n    chart: {\n      type: 'bar',\n      stacked: true,\n    },\n    plotOptions: {\n      bar: {\n        borderRadius: 4,\n        horizontal: true,\n      },\n    },\n    xaxis: {\n      categories: [] as string[],\n    },\n    yaxis: {\n      labels: {\n        align: 'left',\n      },\n    },\n  })\n  const chartDataIncidentsByLocationSeries = ref([])\n\n  const getIncidentCountByLocationData = async () => {\n    try {\n      const rsp = await apiClient.get('/api/metrics/incidents/total-by-location')\n      chartDataIncidentsByLocationOptions.value = {\n        ...chartDataIncidentsByLocationOptions.value,\n        xaxis: {\n          categories: rsp.data.categories,\n        },\n      }\n      chartDataIncidentsByLocationSeries.value = rsp.data.series\n    }\n    catch (e: any) {\n      console.log(e)\n    }\n  }\n\n  /**\n   * Frequency over time\n   */\n  const chartDataIncidentFrequencyOverTimeOptions = ref({\n    chart: {\n      type: 'line',\n      height: 350,\n      zoom: {\n        enabled: true,\n      },\n    },\n    dataLabels: {\n      enabled: false,\n    },\n    stroke: {\n      curve: 'smooth',\n      width: 2,\n    },\n    xaxis: {\n      categories: [] as string[],\n      labels: {\n        show: false,\n      },\n    },\n    tooltip: {\n      x: {\n        format: 'dd/MM/yy',\n      },\n    },\n    yaxis: [\n      {\n        seriesName: 'Incidents',\n        labels: {\n          formatter: (val: number) => {\n            return Math.round(val).toString()\n          },\n        },\n      },\n    ],\n  })\n  const chartDataIncidentFrequencyOverTimeSeries = ref([])\n\n  const getIncidentFrequencyOverTimeData = async () => {\n    try {\n      const rsp = await apiClient.get('/api/metrics/incidents/frequency-over-time')\n      chartDataIncidentFrequencyOverTimeOptions.value = {\n        ...chartDataIncidentFrequencyOverTimeOptions.value,\n        xaxis: {\n          categories: rsp.data.categories,\n          labels: {\n            show: false,\n          },\n        },\n      }\n      chartDataIncidentFrequencyOverTimeSeries.value = rsp.data.series\n    }\n    catch (e: any) {\n      console.log(e)\n    }\n  }\n\n  /**\n   * Ascending vs descending.\n   */\n  const chartDataASCvsDESCOptions = ref({\n    chart: {\n      type: 'area',\n      stacked: true,\n      height: 350,\n      zoom: {\n        enabled: true,\n      },\n    },\n    dataLabels: {\n      enabled: false,\n    },\n    stroke: {\n      curve: 'smooth',\n    },\n    xaxis: {\n      categories: [] as string[],\n      labels: {\n        show: false,\n      },\n    },\n    tooltip: {\n      x: {\n        format: 'dd/MM/yy',\n      },\n    },\n    fill: {\n      opacity: 1,\n    },\n  })\n  const chartDataASCvsDESCSeries = ref([])\n\n  const getASCvsDESCData = async () => {\n    try {\n      const rsp = await apiClient.get('/api/metrics/incidents/ascending-vs-descending')\n      chartDataASCvsDESCOptions.value = {\n        ...chartDataASCvsDESCOptions.value,\n        xaxis: {\n          categories: rsp.data.categories,\n          labels: {\n            show: false,\n          },\n        },\n      }\n      chartDataASCvsDESCSeries.value = rsp.data.series\n    }\n    catch (e: any) {\n      console.log(e)\n    }\n  }\n\n  /**\n   * Root cause distribution\n   */\n  const chartDataRootCauseDistributionOptions = ref({\n    chart: {\n      type: 'pie',\n    },\n    legend: {\n      position: 'bottom',\n    },\n    labels: [] as string[],\n  })\n  const chartDataRootCauseDistributionSeries = ref([])\n\n  const getRootCauseDistributionData = async () => {\n    try {\n      const rsp = await apiClient.get('/api/metrics/incidents/route-cause-distribution')\n      chartDataRootCauseDistributionOptions.value = {\n        ...chartDataRootCauseDistributionOptions.value,\n        labels: rsp.data.categories,\n      }\n      chartDataRootCauseDistributionSeries.value = rsp.data.series\n    }\n    catch (e: any) {\n      console.log(e)\n    }\n  }\n\n  /**\n   * Environmental impact.\n   */\n  const chartDataEnvironmentalImpactOptions = ref({\n    chart: {\n      type: 'bar',\n    },\n    plotOptions: {\n      bar: {\n        horizontal: false,\n        columnWidth: '55%',\n        endingShape: 'rounded',\n        dataLabels: {\n          position: 'top', // top, center, bottom\n        },\n      },\n      distributed: true,\n    },\n    dataLabels: {\n      enabled: false,\n      formatter(val: string) {\n        return `${val} Incidents`\n      },\n      offsetY: -20,\n      style: {\n        fontSize: '12px',\n        colors: ['#304758'],\n      },\n    },\n    xaxis: {\n      categories: [] as string[],\n    },\n  })\n  const chartDataEnvironmentalImpactSeries = ref([])\n\n  const getEnvironmentalImpactData = async () => {\n    try {\n      const rsp = await apiClient.get('/api/metrics/incidents/environmental-impact')\n      chartDataEnvironmentalImpactOptions.value = {\n        ...chartDataEnvironmentalImpactOptions.value,\n        xaxis: {\n          categories: rsp.data.categories,\n        },\n      }\n      chartDataEnvironmentalImpactSeries.value = rsp.data.series\n    }\n    catch (e: any) {\n      console.log(e)\n    }\n  }\n\n  /**\n   * Client ability and age.\n   */\n  const chartDataClientAbilityAndAgeOptions = ref({\n    chart: {\n      type: 'bubble',\n    },\n    colors: ['#FF9800'],\n    xaxis: {\n      type: 'numeric',\n      title: {\n        text: 'Client Average Age',\n      },\n      tickAmount: 12,\n    },\n    yaxis: {\n      show: true,\n      type: 'numeric',\n      title: {\n        text: 'Client Ability (1 - Low, 2 - Medium, 3 - High)',\n      },\n      max: 4,\n    },\n    plotOptions: {\n      bubble: {\n        minBubbleRadius: 10,\n        maxBubbleRadius: 30,\n      },\n    },\n  })\n  const chartDataClientAbilityAndAgeSeries = ref([])\n\n  const getClientAbilityAndAgeData = async () => {\n    try {\n      const rsp = await apiClient.get('/api/metrics/incidents/client-age-and-ability')\n      chartDataClientAbilityAndAgeSeries.value = rsp.data.series\n    }\n    catch (e: any) {\n      console.log(e)\n    }\n  }\n\n  return {\n    chartDataIncidentsByLocationOptions,\n    chartDataIncidentsByLocationSeries,\n    getIncidentCountByLocationData,\n    chartDataIncidentFrequencyOverTimeOptions,\n    chartDataIncidentFrequencyOverTimeSeries,\n    getIncidentFrequencyOverTimeData,\n    chartDataASCvsDESCOptions,\n    chartDataASCvsDESCSeries,\n    getASCvsDESCData,\n    chartDataRootCauseDistributionOptions,\n    chartDataRootCauseDistributionSeries,\n    getRootCauseDistributionData,\n    chartDataEnvironmentalImpactOptions,\n    chartDataEnvironmentalImpactSeries,\n    getEnvironmentalImpactData,\n    chartDataClientAbilityAndAgeOptions,\n    chartDataClientAbilityAndAgeSeries,\n    getClientAbilityAndAgeData,\n  }\n}\n","<script setup lang=\"ts\">\nimport { onMounted } from 'vue'\nimport MainContent from '@/shared/ui/layout/MainContent.vue'\nimport { useIncidentMetrics } from '@/shared/api/metrics/useIncidentMetrics'\n\nconst {\n  chartDataIncidentsByLocationOptions,\n  chartDataIncidentsByLocationSeries,\n  getIncidentCountByLocationData,\n  chartDataIncidentFrequencyOverTimeOptions,\n  chartDataIncidentFrequencyOverTimeSeries,\n  getIncidentFrequencyOverTimeData,\n  chartDataASCvsDESCOptions,\n  chartDataASCvsDESCSeries,\n  getASCvsDESCData,\n  chartDataRootCauseDistributionOptions,\n  chartDataRootCauseDistributionSeries,\n  getRootCauseDistributionData,\n  chartDataEnvironmentalImpactOptions,\n  chartDataEnvironmentalImpactSeries,\n  getEnvironmentalImpactData,\n  chartDataClientAbilityAndAgeOptions,\n  chartDataClientAbilityAndAgeSeries,\n  getClientAbilityAndAgeData,\n} = useIncidentMetrics()\n\nonMounted(async () => {\n  await Promise.all([\n    getIncidentCountByLocationData(),\n    getIncidentFrequencyOverTimeData(),\n    getASCvsDESCData(),\n    getRootCauseDistributionData(),\n    getEnvironmentalImpactData(),\n    getClientAbilityAndAgeData(),\n  ])\n})\n</script>\n\n<template>\n  <MainContent main-content-title=\"Incident Metrics\">\n    <div>\n      <p class=\"my-6 text-sm text-gray-500\">\n        The following charts are based on the data from the incidents that have been reported.\n      </p>\n\n      <div class=\"mb-3 grid grid-cols-1 gap-3 xl:grid-cols-2\">\n        <div class=\"flex flex-col rounded-2xl border bg-white shadow\">\n          <div class=\"xl:p-3\">\n            <apexchart\n              width=\"100%\"\n              :type=\"chartDataIncidentsByLocationOptions.chart.type\"\n              :options=\"chartDataIncidentsByLocationOptions\"\n              :series=\"chartDataIncidentsByLocationSeries\"\n            />\n          </div>\n          <p class=\"mt-auto border-t bg-gray-50 p-3 text-xs italic text-neutral-500\">\n            Incident occurrence by location and level.\n          </p>\n        </div>\n\n        <div class=\"flex flex-col rounded-2xl border bg-white shadow\">\n          <div class=\"flex flex-1 items-center justify-center xl:p-3\">\n            <apexchart\n              width=\"100%\"\n              :type=\"chartDataIncidentFrequencyOverTimeOptions.chart.type\"\n              :options=\"chartDataIncidentFrequencyOverTimeOptions\"\n              :series=\"chartDataIncidentFrequencyOverTimeSeries\"\n            />\n          </div>\n          <p class=\"mt-auto border-t bg-gray-50 p-3 text-xs italic text-neutral-500\">\n            Incidents per day over time.\n          </p>\n        </div>\n      </div>\n\n      <div class=\"grid grid-cols-1 gap-3 xl:grid-cols-3\">\n        <div class=\"flex flex-col rounded-2xl border bg-white shadow\">\n          <div class=\"flex flex-1 items-center justify-center xl:p-3\">\n            <apexchart\n              width=\"100%\"\n              :type=\"chartDataASCvsDESCOptions.chart.type\"\n              :options=\"chartDataASCvsDESCOptions\"\n              :series=\"chartDataASCvsDESCSeries\"\n            />\n          </div>\n          <p class=\"mt-auto border-t bg-gray-50 p-3 text-xs italic text-neutral-500\">\n            Ascending vs. descending incidents.\n          </p>\n        </div>\n\n        <div class=\"col-span-1 flex flex-col rounded-2xl border bg-white shadow xl:col-span-2\">\n          <div class=\"xl:p-3\">\n            <apexchart\n              width=\"100%\"\n              :type=\"chartDataEnvironmentalImpactOptions.chart.type\"\n              :options=\"chartDataEnvironmentalImpactOptions\"\n              :series=\"chartDataEnvironmentalImpactSeries\"\n            />\n          </div>\n          <p class=\"mt-auto border-t bg-gray-50 p-3 text-xs italic text-neutral-500\">\n            Environmental condition distribution.\n          </p>\n        </div>\n\n        <div class=\"col-span-1 flex flex-col rounded-2xl border bg-white shadow xl:col-span-2\">\n          <div class=\"flex flex-1 items-center justify-center p-0 xl:p-32\">\n            <apexchart\n              width=\"100%\"\n              :type=\"chartDataRootCauseDistributionOptions.chart.type\"\n              :options=\"chartDataRootCauseDistributionOptions\"\n              :series=\"chartDataRootCauseDistributionSeries\"\n            />\n          </div>\n          <p class=\"mt-auto border-t bg-gray-50 p-3 text-xs italic text-neutral-500\">\n            Root cause distribution.\n          </p>\n        </div>\n\n        <div class=\"flex flex-col rounded-2xl border bg-white shadow\">\n          <div class=\"flex flex-1 items-center justify-center xl:p-3\">\n            <apexchart\n              width=\"100%\"\n              :type=\"chartDataClientAbilityAndAgeOptions.chart.type\"\n              :options=\"chartDataClientAbilityAndAgeOptions\"\n              :series=\"chartDataClientAbilityAndAgeSeries\"\n            />\n          </div>\n          <p class=\"mt-auto border-t bg-gray-50 p-3 text-xs italic text-neutral-500\">\n            Client age and ability distribution.\n          </p>\n        </div>\n      </div>\n    </div>\n  </MainContent>\n</template>\n\n<style scoped>\n.vue-apexcharts {\n  width: 100%;\n}\n</style>\n"],"names":["useIncidentMetrics","apiClient","useApiClient","chartDataIncidentsByLocationOptions","ref","chartDataIncidentsByLocationSeries","getIncidentCountByLocationData","rsp","e","chartDataIncidentFrequencyOverTimeOptions","val","chartDataIncidentFrequencyOverTimeSeries","getIncidentFrequencyOverTimeData","chartDataASCvsDESCOptions","chartDataASCvsDESCSeries","getASCvsDESCData","chartDataRootCauseDistributionOptions","chartDataRootCauseDistributionSeries","getRootCauseDistributionData","chartDataEnvironmentalImpactOptions","chartDataEnvironmentalImpactSeries","getEnvironmentalImpactData","chartDataClientAbilityAndAgeOptions","chartDataClientAbilityAndAgeSeries","getClientAbilityAndAgeData","onMounted"],"mappings":"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"}