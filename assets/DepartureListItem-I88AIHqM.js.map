{"version":3,"file":"DepartureListItem-I88AIHqM.js","sources":["../../src/shared/ui/PPopover/lib.ts","../../src/shared/ui/icons/IconPlusSimple.vue","../../src/widgets/departure-list/ui/staff/DepartureListStaff.vue","../../src/widgets/departure-list/ui/item/DepartureListItem.vue"],"sourcesContent":["import { type Ref, ref } from 'vue'\n\nexport function useHoverMenu(delay = 150) {\n  const show = ref(false)\n  const timer = ref(null) as Ref<ReturnType<typeof setTimeout> | null>\n\n  const open = () => {\n    if (timer.value !== null) {\n      clearTimeout(timer.value)\n      timer.value = null\n    }\n    show.value = true\n  }\n\n  const close = () => show.value = false\n\n  const delayClose = () => {\n    timer.value = setTimeout(() => {\n      show.value = false\n    }, delay)\n  }\n\n  return { show, timer, open, close, delayClose }\n}\n","<template>\n  <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\">\n    <path d=\"M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z\" />\n  </svg>\n</template>\n","<script setup lang=\"ts\">\nimport type { User, Vehicle } from '@/shared/types'\nimport { PAvatar } from '@/shared/ui/PAvatar'\nimport {\n  PPopover,\n  PPopoverButton,\n  PPopoverPanel,\n  useHoverMenu,\n} from '@/shared/ui/PPopover'\nimport { PPhoneLink } from '@/shared/ui/PPhoneLink'\n\nexport interface Props {\n  avatar: User['avatar']\n  name: User['name']\n  phone: User['phone']\n  vehicleTitle: Vehicle['title'] | null\n  vehicleRegistrationNumber: Vehicle['registrationNumber'] | null\n}\n\ndefineProps<Props>()\n\ndefineEmits<{ clickAvatar: [] }>()\n\nconst {\n  show: showHoverMenu,\n  open: openHoverMenu,\n  delayClose: delayCloseHoverMenu,\n} = useHoverMenu()\n</script>\n\n<template>\n  <div class=\"relative\">\n    <PPopover\n      :float=\"{\n        show: showHoverMenu,\n        placement: 'top',\n      }\"\n    >\n      <PPopoverButton\n        @mouseenter=\"openHoverMenu\"\n        @mouseleave=\"delayCloseHoverMenu\"\n      >\n        <PAvatar\n          class=\"min-w-14 border-4 border-white\"\n          :src=\"avatar\"\n          :placeholder-name=\"name\"\n          size=\"xl\"\n          @click=\"$emit('clickAvatar')\"\n        />\n      </PPopoverButton>\n\n      <PPopoverPanel\n        static\n        @mouseenter=\"openHoverMenu\"\n        @mouseleave=\"delayCloseHoverMenu\"\n        @click.stop\n      >\n        <div class=\"flex min-w-44 flex-col gap-3\">\n          <p class=\"font-semibold\" v-text=\"name\" />\n\n          <PPhoneLink v-if=\"phone\" :phone=\"phone\" />\n\n          <div class=\"flex gap-3\">\n            <div\n              v-if=\"vehicleTitle\"\n              class=\"\n              rounded-xl bg-gray-900 px-3 text-xs font-medium leading-5\n              text-white\n              \"\n            >\n              {{ vehicleTitle }}\n            </div>\n\n            <p class=\"truncate text-sm font-medium text-gray-500\">\n              {{ vehicleRegistrationNumber }}\n            </p>\n          </div>\n        </div>\n      </PPopoverPanel>\n    </PPopover>\n\n    <div\n      v-if=\"vehicleTitle\"\n      class=\"\n      absolute inset-x-1/2 bottom-[-0.3rem] min-w-7 -translate-x-1/2\n      rounded-xl bg-gray-900 px-1.5 py-0.5 text-center\n      \"\n    >\n      <p class=\"text-[0.6rem] leading-5 text-white\">\n        {{ vehicleTitle }}\n      </p>\n    </div>\n  </div>\n</template>\n","<script setup lang=\"ts\">\nimport { computed, toRefs } from 'vue'\nimport { DepartureUpdateCommentPopover } from '@/features/departure/update-comment'\nimport { DepartureUpdateStatus } from '@/features/departure/update-status'\n\nimport { produceDepartureRatioItems } from '@/entities/departure'\n\nimport type { ScheduledDeparture, ScheduledDepartureStatus, User, Vehicle } from '@/shared/types'\n\nimport { PMultiRatioBar } from '@/shared/ui/PMultiRatioBar'\nimport IconPlusSimple from '@/shared/ui/icons/IconPlusSimple.vue'\nimport { PButton } from '@/shared/ui/PButton'\n\nimport { DepartureListStaff } from '../staff'\n\nexport interface Props {\n  scheduledDepartureId: ScheduledDeparture['id']\n  bookingSystemAvailability: number | null\n  tourName: string\n  tourThumbnailUrl: string | null\n  time: string\n  totalPassengerCount: number\n  comment: string | null\n  status: ScheduledDepartureStatus\n  scheduledUsers: (\n    Pick<User, 'id' | 'name' | 'avatar' | 'phone'> & {\n      vehicleTitle: Vehicle['title'] | null\n      vehicleRegistrationNumber: Vehicle['registrationNumber'] | null\n      maxCapacity: Vehicle['maxCapacity'] | null\n    }\n  )[]\n  compact?: boolean\n}\n\nconst props = defineProps<Props>()\nconst { totalPassengerCount, bookingSystemAvailability, scheduledUsers } = toRefs(props)\n\nconst totalNumberOfSeats = computed(() => scheduledUsers.value.length === 0\n  ? null\n  : scheduledUsers.value?.reduce((current, vehicle) => {\n    if (vehicle.maxCapacity) {\n      return current + vehicle.maxCapacity\n    }\n    return current\n  }, 0))\n\ndefineEmits<{ startAssignment: [] }>()\n\nconst ratioItems = computed(\n  () => produceDepartureRatioItems(bookingSystemAvailability.value ?? null, totalPassengerCount.value, totalNumberOfSeats.value),\n)\n</script>\n\n<template>\n  <RouterLink\n    v-slot=\"{ navigate }\"\n    :to=\"{\n      name: $Routes.DepartureShow,\n      params: { departureId: scheduledDepartureId },\n    }\"\n    custom\n  >\n    <div\n      class=\"w-full cursor-pointer border bg-white px-6 shadow-md\"\n      :class=\"[compact ? 'p-2' : 'rounded-md p-4']\"\n      @click=\"navigate\"\n    >\n      <div class=\"grid grid-cols-2 items-center lg:grid-cols-4\">\n        <div class=\"flex h-full items-center gap-2\">\n          <div class=\"relative\" :class=\"compact ? 'size-12' : 'size-16'\">\n            <div\n              class=\"\n              absolute h-5 w-12 rounded-xl rounded-bl-none rounded-tr-none\n              bg-gray-900 px-1.5 py-0.5 text-center text-xs text-white\n              \"\n              v-text=\"time\"\n            />\n\n            <img\n              v-if=\"tourThumbnailUrl\"\n              :src=\"tourThumbnailUrl\"\n              class=\"size-full min-w-12 rounded-xl object-cover\"\n              :alt=\"tourName\"\n            >\n            <div v-else class=\"size-full min-w-12 rounded-xl bg-gray-400\" />\n          </div>\n\n          <p\n            v-if=\"compact\"\n            class=\"text-sm text-gray-900\"\n            v-text=\"tourName\"\n          />\n        </div>\n\n        <div class=\"flex justify-end lg:justify-center\">\n          <PMultiRatioBar\n            centered-value=\"passengers\"\n            :ratio-items=\"ratioItems\"\n          />\n        </div>\n\n        <div\n          class=\"flex cursor-pointer lg:justify-center\"\n        >\n          <template v-if=\"scheduledUsers.length\">\n            <div\n              v-for=\"(\n                {\n                  id,\n                  name,\n                  avatar,\n                  vehicleTitle,\n                  phone,\n                  vehicleRegistrationNumber,\n                }, idx\n              ) in scheduledUsers\"\n              :key=\"id\"\n              @click.stop=\"$emit('startAssignment')\"\n            >\n              <DepartureListStaff\n                :class=\"[idx > 0 && '-ml-4']\"\n                :name=\"name\"\n                :avatar=\"avatar\"\n                :phone=\"phone\"\n                :vehicle-title=\"vehicleTitle\"\n                :vehicle-registration-number=\"vehicleRegistrationNumber\"\n                @click-avatar=\"$emit('startAssignment')\"\n              />\n            </div>\n\n            <div\n              class=\"\n            relative -ml-4 flex h-14 w-14 min-w-14 cursor-pointer items-center\n            justify-center rounded-full border-4 border-white bg-gray-300\n            \"\n            >\n              <IconPlusSimple class=\"h-6 w-6 fill-white\" />\n            </div>\n          </template>\n          <PButton\n            v-else\n            variant=\"soft\"\n            class=\"flex cursor-pointer items-center\n            justify-center rounded-full bg-gray-300\"\n            @click.stop=\"$emit('startAssignment')\"\n          >\n            <div class=\"flex items-center gap-1 pr-2\">\n              <IconPlusSimple class=\"h-6 w-6 fill-white\" />\n              <p class=\"text-xs text-white\" v-text=\"'Guides'\" />\n            </div>\n          </PButton>\n        </div>\n\n        <div class=\"flex items-center justify-end gap-2\">\n          <!-- TODO: Inject departure messages shared ui -->\n          <DepartureUpdateCommentPopover\n            :scheduled-departure-id=\"scheduledDepartureId\"\n            :comment=\"comment\"\n            @click.stop\n          />\n\n          <DepartureUpdateStatus\n            :scheduled-departure-id=\"scheduledDepartureId\"\n            :status=\"status\"\n            @click.stop\n          />\n        </div>\n      </div>\n    </div>\n  </RouterLink>\n</template>\n"],"names":["useHoverMenu","delay","show","ref","timer","_hoisted_1","_hoisted_3","_cache","showHoverMenu","openHoverMenu","delayCloseHoverMenu","props","__props","totalPassengerCount","bookingSystemAvailability","scheduledUsers","toRefs","totalNumberOfSeats","computed","_a","current","vehicle","ratioItems","produceDepartureRatioItems"],"mappings":"snBAEgB,SAAAA,EAAaC,EAAQ,IAAK,CAClC,MAAAC,EAAOC,EAAI,EAAK,EAChBC,EAAQD,EAAI,IAAI,EAkBtB,MAAO,CAAE,KAAAD,EAAM,MAAAE,EAAO,KAhBT,IAAM,CACbA,EAAM,QAAU,OAClB,aAAaA,EAAM,KAAK,EACxBA,EAAM,MAAQ,MAEhBF,EAAK,MAAQ,EAAA,EAWa,MARd,IAAMA,EAAK,MAAQ,GAQE,WANhB,IAAM,CACjBE,EAAA,MAAQ,WAAW,IAAM,CAC7BF,EAAK,MAAQ,IACZD,CAAK,CAAA,CAGoC,CAChD,YCtBOI,EAAkC,CAAC,MAAO,sHACSC,GAAA,kBAClDC,EAAA,0xBCoBF,KAAA,CACJ,KAAMC,EACN,KAAMC,EACN,WAAYC,GACVV,EAAa,u4ECOjB,MAAMW,EAAQC,EACR,CAAE,oBAAAC,EAAqB,0BAAAC,EAA2B,eAAAC,CAAe,EAAIC,EAAOL,CAAK,EAEjFM,EAAqBC,EAAS,IAAM,OAAA,OAAAH,EAAe,MAAM,SAAW,EACtE,MACAI,EAAAJ,EAAe,QAAf,YAAAI,EAAsB,OAAO,CAACC,EAASC,IACnCA,EAAQ,YACHD,EAAUC,EAAQ,YAEpBD,EACN,GAAE,EAIDE,EAAaJ,EACjB,IAAMK,EAA2BT,EAA0B,OAAS,KAAMD,EAAoB,MAAOI,EAAmB,KAAK,CAAA"}