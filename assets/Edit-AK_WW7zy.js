import{o as n,k as u,l as e,e as ee,z as te,j as I,V as ae,q as oe,n as ie,w as re,A as m,B as c,E as se,u as r,b as p,J as ne,P as le,G as b,D as _,F as N,H as pe,N as x,x as de,T as M}from"./vue.esm-bundler-CYPfFjdk.js";import{s as F}from"./schemas-74JEr9Jm.js";import{R as me}from"./RightDrawer-Lpr6admO.js";import{a as ce,f as ue,A as fe}from"./preview-D0Pi-YKn.js";import{I as T}from"./IconClose-tbzieUCA.js";import{P as C}from"./ProgressSpinner-lCLkagxy.js";import{_ as _e,a as ge}from"./ActionErrorAlert--bGVRXV4.js";import{u as ve,a as V}from"./useOperationalBase-kvvO22e1.js";import{I as be}from"./IconPlus-R6BbPohN.js";import{u as xe}from"./useExperienceLocation-WT3dP7yS.js";import{_ as he}from"./FeedbackWarning-iVsjxw1W.js";import{_ as ye}from"./_plugin-vue_export-helper-x3n3nnut.js";import{u as Be}from"./useMap-r2WMKGtK.js";import{_ as we}from"./VDepartmentSelect-fFgtBnGn.js";import"./index-LmGWO5sK.js";import"./vue-router-E7v71uM3.js";import"./routes-WhYxSpGG.js";import"./models-qWR1FMGP.js";import"./chunk-UXHY756F-iEg6Hh0Y.js";import"./index-C1vJkiWb.js";import"./_commonjsHelpers-4gQjN7DL.js";import"./preview-errors-7FWlPnjy.js";import"./index-PPLHz8o0.js";import"./PDays-npMhi6Nw.js";import"./index-baqd9Qr3.js";import"./index-TCXC35p5.js";import"./index-05uTbNHo.js";import"./PPopoverPanel-RNuJphX8.js";import"./headlessui-float-sqR0azf2.js";import"./transition-qpXhaAaU.js";import"./keyboard-64MH3N5t.js";import"./open-closed-nhb_Ydho.js";import"./use-root-containers-gEPBKDr2.js";import"./use-resolve-button-type-49aRxFpo.js";import"./iframe-ufxlS10p.js";import"../sb-preview/runtime.js";import"./query-G1AwWss6.js";import"./ChevronDownIcon-AgxEjrtE.js";import"./listbox-3RN1mHPV.js";import"./form-TGXPuq_M.js";import"./DepartureList-w5NrqMJ9.js";import"./DepartureAssignStaffAndVehicles-8AoBdfT8.js";import"./api-B2HcjM2j.js";import"./api-cJzoLyfI.js";import"./PButton-h9_xezBg.js";import"./index-VqpYtbVe.js";import"./PInput-iZb_REtl.js";import"./POverlay-3jPNvx4x.js";import"./PSpinner-cF72MsvC.js";import"./IconBus-0QPjtZ9u.js";import"./IconPerson-i3ljUCnk.js";import"./SuggestedUser-4kWsZiWj.js";import"./PAvatar-wq6oK0Zr.js";import"./PlusCircleIcon-aSiXn_Mr.js";import"./SuggestedVehicle-r1TyKt-D.js";import"./ScheduledUser-esbe3tjU.js";import"./VehicleTitle-0pOySBND.js";import"./XMarkIcon-_tXc_TyD.js";import"./PPhoneLink-wKLYRG_F.js";import"./PAlert-quHLeqTA.js";import"./CheckCircleIcon-akbq8cGf.js";import"./XMarkIcon-t43a1P5Z.js";import"./PDialogTitle-rfxNVwSR.js";import"./description-LPuBJoU_.js";import"./DepartureListItem-I88AIHqM.js";import"./DepartureUpdateComment-2rt04tFb.js";import"./PTextarea-Wrr33MR5.js";import"./DepartureUpdateCommentPopover-euFlcGix.js";import"./DepartureUpdateStatus-zdhd3wV8.js";import"./PListboxLabel-U39qo3cm.js";import"./CheckIcon-WRJIoum8.js";import"./lib-Fy6oBlQ3.js";import"./PToggle-mLVcOzrp.js";import"./PRadio-sGATo2dT.js";import"./index-bhXQ3okY.js";import"./isNativeReflectConstruct-ubdnbphT.js";import"./mock-vjhcKIQW.js";import"./index-1aVAeLWL.js";import"./mock-UR5nntqf.js";import"./mock-CzN7Q16W.js";import"./mock-YoOI-P8k.js";import"./mock-psFphV_9.js";import"./mock-OgPWcINV.js";import"./IconTickMarkCircle-2_sKm8Jk.js";import"./IconAlert-B2oaG4cc.js";import"./leaflet-src-KPccyqlJ.js";import"./useDepartment-RZahlhen.js";import"./useAuth-8d_1_S6I.js";const A={},ke={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},Ee=e("path",{d:"M18.13 12L19.39 10.74C19.83 10.3 20.39 10.06 21 10V9L15 3H5C3.89 3 3 3.89 3 5V19C3 20.1 3.89 21 5 21H11V19.13L11.13 19H5V5H12V12H18.13M14 4.5L19.5 10H14V4.5M19.13 13.83L21.17 15.87L15.04 22H13V19.96L19.13 13.83M22.85 14.19L21.87 15.17L19.83 13.13L20.81 12.15C21 11.95 21.33 11.95 21.53 12.15L22.85 13.47C23.05 13.67 23.05 14 22.85 14.19Z"},null,-1),Oe=[Ee];function Le(h,y){return n(),u("svg",ke,Oe)}const Ie=ye(A,[["render",Le]]);A.__docgenInfo={displayName:"IconEdit",description:"",tags:{},sourceFiles:["D:/work/server/htdocs/aa-portal.is/src/shared/ui/icons/IconEdit.vue"]};const Ne={class:"isolate flex flex-col items-center justify-center border-l bg-white pb-6"},Me={class:"sticky top-0 z-[9999999] flex w-full items-center justify-end bg-white p-6"},Fe=e("div",{class:"mb-6"},[e("h3",{class:"text-base font-semibold leading-6 text-gray-900"}," View/Edit Operational Base. "),e("p",{class:"mt-1 text-sm text-gray-500"}," Use the form below to update this operational base. ")],-1),Te={class:"grid grid-cols-1 gap-x-4 gap-y-6 pt-6"},Ce=e("p",{class:"block text-sm font-medium text-gray-700"}," Department ",-1),Ve=e("label",{for:"operational_base_name",class:"block text-sm font-medium text-gray-700"}," Operational Base Name ",-1),Ae={class:"mt-1"},Se={class:"flex flex-col"},$e=e("label",{for:"operational_base_name",class:"mb-1 block text-sm font-medium text-gray-700"}," Location ",-1),Re=e("div",{id:"map",class:"h-[400px] w-full bg-gray-100"},null,-1),De={class:"text-xs italic text-gray-500"},He=e("label",{for:"experience_locations",class:"mb-2 block text-sm font-medium text-gray-700"}," Experience Locations ",-1),Pe=["onClick"],Ue={class:"flex justify-end"},je={class:"relative pt-5"},qe={class:"flex items-center justify-end"},ze={class:"flex items-center"},Ge={key:0},Je=ee({__name:"Edit",props:{operationalBaseId:{}},setup(h){const y=h,{operationalBaseId:B}=te(y),{validateForm:S,actionIsInProgress:f,actionIsInError:$,actionIsInSuccess:R}=ce(),{operationalBaseActions:d,getOperationalBaseById:w,editOperationalBase:D}=ve(),{experienceLocationActions:H,fetchAndStoreExperienceLocationsByOperationalBaseIdIndex:k,getAllExperienceLocationsFromStore:g}=xe(),{createMap:P,addLayersToMap:U,createOperationalBaseMarker:E,createExperienceLocationMarker:j,panMapToCoordinates:q,resetMapView:z,tidyUpMap:G}=Be(),{storeFilterState:O}=F(ue()),{storeRemoveOperationalBase:J,storeAddOperationalBase:Z}=V(),{storeOperationalBases:K}=F(V()),v=I(null),a=I(null),Q=async()=>{var t,o;if(v.value){const i=await S(v.value,()=>D(a.value));i&&(a.value={id:i.id,name:i.name,department:i.department,latitude:i.latitude,longitude:i.longitude},i.department.id!==((t=O.value.selectedDepartment)==null?void 0:t.id)&&J(i.id),i.department.id===((o=O.value.selectedDepartment)==null?void 0:o.id)&&(K.value.find(l=>l.id===i.id)||Z(i)))}};let s=null;const L=()=>{s=P(Number.parseFloat(a.value.latitude),Number.parseFloat(a.value.longitude)),U(s);let t=E(Number.parseFloat(a.value.latitude),Number.parseFloat(a.value.longitude));t.addTo(s),t.bindTooltip(a.value.name,{sticky:!0}),g().forEach(o=>{const i=j(Number.parseFloat(o.latitude),Number.parseFloat(o.longitude),!1);i.addTo(s),i.bindTooltip(o.name,{sticky:!0})}),s.on("click",o=>{a.value.latitude=o.latlng.lat.toString(),a.value.longitude=o.latlng.lng.toString(),t&&s.removeLayer(t),t=E(o.latlng.lat,o.latlng.lng),t.addTo(s),t.bindTooltip(a.value.name,{sticky:!0})}),z(s,Number.parseFloat(a.value.latitude),Number.parseFloat(a.value.longitude))},W=(t,o)=>{q(s,Number.parseFloat(t),Number.parseFloat(o))};return ae(()=>{G(s)}),oe(async()=>{const t=await w(B.value.toString());t&&(a.value={id:t.id,name:t.name,department:t.department,latitude:t.latitude,longitude:t.longitude}),await k(a.value.id),await ie(()=>{setTimeout(()=>L(),400)})}),re(B,async t=>{if(t){const o=await w(t.toString());o&&(a.value={id:o.id,name:o.name,department:o.department,latitude:o.latitude,longitude:o.longitude}),await k(a.value.id),s&&(s.off(),s.remove()),L()}}),(t,o)=>{const i=se("RouterLink");return n(),m(me,null,{default:c(()=>[e("div",Ne,[e("div",Me,[r(f)(r(d).getOperationalBaseById)||r(f)(r(d).editOperationalBase)?(n(),m(C,{key:0,class:"h-5 w-5 text-blue-500"})):(n(),m(i,{key:1,to:{name:t.$Routes.OperationalBases}},{default:c(()=>[p(T,{class:"h-5 w-5 fill-red-400"})]),_:1},8,["to"]))]),e("form",{id:"edit_operational_base_form",ref_key:"editOperationalBaseFormElement",ref:v,class:"w-full space-y-8 divide-y divide-gray-200 px-6 md:px-12"},[Fe,a.value?(n(),u(N,{key:0},[e("div",Te,[e("div",null,[Ce,p(we,{modelValue:a.value.department,"onUpdate:modelValue":o[0]||(o[0]=l=>a.value.department=l),"department-permissions-required":[r(fe).MANAGE_OPERATIONAL_BASES]},null,8,["modelValue","department-permissions-required"])]),e("div",null,[Ve,e("div",Ae,[ne(e("input",{id:"operational_base_name","onUpdate:modelValue":o[1]||(o[1]=l=>a.value.name=l),type:"text",class:"block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm",required:""},null,512),[[le,a.value.name]])])]),e("div",Se,[$e,Re,e("p",De,b(a.value.latitude)+", "+b(a.value.longitude),1)]),e("div",null,[He,!r(g)().length&&!r(f)(r(H).getAllExperienceLocationsByOperationalBaseId)?(n(),m(he,{key:0,message:"There are no Experience Locations for this Operational Base."})):_("",!0),(n(!0),u(N,null,pe(r(g)(),(l,X)=>(n(),u("div",{key:X,class:"mt-1 flex"},[e("button",{class:"flex-1 cursor-zoom-in rounded-l border border-gray-200 bg-gray-50 p-2 text-left text-sm font-semibold text-gray-500 hover:bg-gray-100",onClick:x(Y=>W(l.latitude,l.longitude),["prevent"])},b(l.name),9,Pe),p(i,{to:{name:t.$Routes.ExperienceLocationEdit,params:{operationalBaseId:a.value.id,experienceLocationId:l.id}},class:"group flex items-center rounded-r border border-gray-200 p-2"},{default:c(()=>[p(Ie,{class:"h-4 w-4 fill-blue-900 transition-all group-hover:scale-125"})]),_:2},1032,["to"]),e("button",{class:"group rounded-r border border-gray-200 p-2",onClick:x(Y=>null,["prevent"])},[p(T,{class:"h-4 w-4 fill-red-500 transition-all group-hover:scale-125"})])]))),128))]),e("div",Ue,[p(i,{to:{name:t.$Routes.ExperienceLocationCreate,params:{operationalBaseId:a.value.id}},class:"flex items-center text-sm font-semibold text-blue-600 hover:underline"},{default:c(()=>[p(be,{class:"mr-1 h-4 w-4 fill-blue-600"}),de(" Add new Experience Location ")]),_:1},8,["to"])])]),e("div",je,[e("div",qe,[p(M,{name:"alert"},{default:c(()=>[r(R)(r(d).editOperationalBase)?(n(),m(_e,{key:0,action:r(d).editOperationalBase},null,8,["action"])):_("",!0)]),_:1}),p(M,{name:"alert"},{default:c(()=>[r($)(r(d).editOperationalBase)?(n(),m(ge,{key:0,action:r(d).editOperationalBase},null,8,["action"])):_("",!0)]),_:1}),e("div",ze,[e("button",{class:"ml-3 inline-flex h-9 items-center justify-center rounded-md border border-transparent bg-blue-600 px-4 py-2 text-sm font-medium text-white shadow-sm focus:outline-none hover:bg-blue-700",onClick:x(Q,["prevent"])},[r(f)(r(d).editOperationalBase)?(n(),m(C,{key:1,class:"h-3 w-3 text-white"})):(n(),u("span",Ge," Apply Changes "))])])])])],64)):_("",!0)],512)])]),_:1})}}});Je.__docgenInfo={exportName:"default",displayName:"Edit",description:"",tags:{},props:[{name:"operationalBaseId",required:!0,type:{name:"number"}}],sourceFiles:["D:/work/server/htdocs/aa-portal.is/src/pages/operational-bases/Edit.vue"]};export{Je as default};
