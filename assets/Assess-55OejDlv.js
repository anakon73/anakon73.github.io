import{e as le,z as oe,j as _,q as ae,w as L,o as t,A as d,B as x,E as ie,l as e,u as l,b,x as f,G as m,J as N,P as E,S as H,k as i,H as S,F as g,C as $,D as u,T as j,N as re,$ as ne,a0 as de,a1 as ce}from"./vue.esm-bundler-CYPfFjdk.js";import{R as me}from"./RightDrawer-Lpr6admO.js";import{a as ue,e as pe}from"./preview-D0Pi-YKn.js";import{P as D}from"./ProgressSpinner-lCLkagxy.js";import{I as fe}from"./IconClose-tbzieUCA.js";import{_ as _e,a as ve,I as q}from"./ActionErrorAlert--bGVRXV4.js";import{_ as ye}from"./FeedbackWarning-iVsjxw1W.js";import{u as be}from"./useHelpers-Uc_HlRzD.js";import{r as he,I as xe,a as ge}from"./IconSchool-H8BAsls-.js";import{u as we}from"./useAssessment-iBONDyw0.js";import{I as z}from"./IconTickMarkCircle-2_sKm8Jk.js";import{i as ke}from"./PToggle-mLVcOzrp.js";import{_ as Ae}from"./_plugin-vue_export-helper-x3n3nnut.js";import"./chunk-UXHY756F-iEg6Hh0Y.js";import"./index-C1vJkiWb.js";import"./_commonjsHelpers-4gQjN7DL.js";import"./vue-router-E7v71uM3.js";import"./preview-errors-7FWlPnjy.js";import"./index-PPLHz8o0.js";import"./schemas-74JEr9Jm.js";import"./index-LmGWO5sK.js";import"./routes-WhYxSpGG.js";import"./models-qWR1FMGP.js";import"./PDays-npMhi6Nw.js";import"./index-baqd9Qr3.js";import"./index-TCXC35p5.js";import"./index-05uTbNHo.js";import"./PPopoverPanel-RNuJphX8.js";import"./headlessui-float-sqR0azf2.js";import"./transition-qpXhaAaU.js";import"./keyboard-64MH3N5t.js";import"./open-closed-nhb_Ydho.js";import"./use-root-containers-gEPBKDr2.js";import"./use-resolve-button-type-49aRxFpo.js";import"./iframe-ufxlS10p.js";import"../sb-preview/runtime.js";import"./query-G1AwWss6.js";import"./ChevronDownIcon-AgxEjrtE.js";import"./listbox-3RN1mHPV.js";import"./form-TGXPuq_M.js";import"./DepartureList-w5NrqMJ9.js";import"./DepartureAssignStaffAndVehicles-8AoBdfT8.js";import"./api-B2HcjM2j.js";import"./api-cJzoLyfI.js";import"./PButton-h9_xezBg.js";import"./index-VqpYtbVe.js";import"./PInput-iZb_REtl.js";import"./POverlay-3jPNvx4x.js";import"./PSpinner-cF72MsvC.js";import"./IconBus-0QPjtZ9u.js";import"./IconPerson-i3ljUCnk.js";import"./SuggestedUser-4kWsZiWj.js";import"./PAvatar-wq6oK0Zr.js";import"./PlusCircleIcon-aSiXn_Mr.js";import"./SuggestedVehicle-r1TyKt-D.js";import"./ScheduledUser-esbe3tjU.js";import"./VehicleTitle-0pOySBND.js";import"./XMarkIcon-_tXc_TyD.js";import"./PPhoneLink-wKLYRG_F.js";import"./PAlert-quHLeqTA.js";import"./CheckCircleIcon-akbq8cGf.js";import"./XMarkIcon-t43a1P5Z.js";import"./PDialogTitle-rfxNVwSR.js";import"./description-LPuBJoU_.js";import"./DepartureListItem-I88AIHqM.js";import"./DepartureUpdateComment-2rt04tFb.js";import"./PTextarea-Wrr33MR5.js";import"./DepartureUpdateCommentPopover-euFlcGix.js";import"./DepartureUpdateStatus-zdhd3wV8.js";import"./PListboxLabel-U39qo3cm.js";import"./CheckIcon-WRJIoum8.js";import"./lib-Fy6oBlQ3.js";import"./PRadio-sGATo2dT.js";import"./index-bhXQ3okY.js";import"./isNativeReflectConstruct-ubdnbphT.js";import"./mock-vjhcKIQW.js";import"./index-1aVAeLWL.js";import"./mock-UR5nntqf.js";import"./mock-CzN7Q16W.js";import"./mock-YoOI-P8k.js";import"./mock-psFphV_9.js";import"./mock-OgPWcINV.js";import"./IconAlert-B2oaG4cc.js";const p=w=>(de("data-v-6ce29b27"),w=w(),ce(),w),Ue={class:"isolate flex flex-col items-center justify-center border-l bg-white pb-6"},Ie={class:"sticky top-0 z-10 flex w-full items-center justify-end bg-white p-6"},Ce={class:"space-y-8 divide-y divide-gray-200"},Be=p(()=>e("h3",{class:"text-base font-semibold leading-6 text-gray-900"}," Log assessment. ",-1)),Ne={class:"mt-1 text-sm text-gray-500"},Se={class:"font-medium"},De={class:"flex flex-col space-y-6 pt-6"},Ve={class:"flex flex-wrap space-y-6 sm:space-x-3 sm:space-y-0"},$e=p(()=>e("label",{for:"date",class:"block text-sm font-medium text-gray-700"}," Date ",-1)),je={class:"w-full sm:flex-1"},Fe=p(()=>e("label",{for:"assessment",class:"block text-sm font-medium text-gray-700"}," Assessment ",-1)),Me=p(()=>e("option",{disabled:"",selected:"",value:"null"}," Select assessment... ",-1)),Te=["value"],Re={key:0,class:"flex flex-col space-y-2 sm:col-span-3"},Pe=p(()=>e("label",{for:"feedback",class:"block text-sm font-medium text-gray-700"}," Criteria ",-1)),Le={class:"text-sm text-gray-700"},Ee={class:"flex w-24 justify-end"},He={key:1,class:"sm:col-span-3"},qe={for:"feedback",class:"block text-sm font-medium text-gray-700"},ze=["innerHTML"],Oe={key:2,class:"w-full sm:flex-1"},Ge=p(()=>e("label",{for:"verdict",class:"block text-sm font-medium text-gray-700"}," Overall Verdict ",-1)),Je=p(()=>e("option",{value:!0}," Pass ",-1)),Ye=p(()=>e("option",{value:!1}," Fail ",-1)),Ke=[Je,Ye],Qe={class:"relative pt-5"},We={class:"flex items-center justify-end"},Xe={class:"flex items-center"},Ze=["disabled"],es={key:0},ss={class:"w-full space-y-8 divide-y divide-gray-200 px-6 pt-12 md:px-12"},ts={class:"space-y-8 divide-y divide-gray-200"},ls={class:"flex items-center justify-between"},os=p(()=>e("h3",{class:"text-base font-semibold leading-6 text-gray-900"}," Previous assessment logs. ",-1)),as={class:"mt-1 text-sm text-gray-500"},is={class:"font-medium"},rs={key:0,class:"flex flex-col space-y-3 pt-6"},ns={class:"flow-root"},ds={role:"list",class:"-mb-8"},cs={class:"relative pb-8"},ms={key:0,class:"absolute left-5 top-5 -ml-px h-full w-0.5 bg-gray-200","aria-hidden":"true"},us={class:"relative flex items-start space-x-3"},ps={class:"relative"},fs={class:"absolute -bottom-0.5 -right-0.5 rounded-tl bg-white px-0.5 py-px"},_s={class:"min-w-0 flex-1"},vs={class:"text-sm"},ys={class:"font-medium text-gray-900"},bs={class:"text-xs text-gray-400"},hs={class:"mt-0.5 text-sm text-gray-500"},xs={class:"text-xs"},gs={class:"mt-2 text-sm text-gray-700"},ws={class:"italic"},ks=["onClick"],As={key:1,class:"mt-2 text-sm text-gray-700"},Us={class:"space-y-2"},Is={class:"pr-2 text-sm text-gray-500"},Cs={class:"relative px-1"},Bs={class:"flex h-10 w-10 items-center justify-center rounded-full bg-gray-100 ring-8 ring-white"},Ns={class:"min-w-0 flex-1 py-1.5"},Ss={class:"text-sm text-gray-500"},Ds={key:0,class:"font-medium text-gray-900"},Vs={class:"text-xs text-gray-400"},$s={key:1,class:"font-medium text-gray-900"},js={class:"whitespace-nowrap text-xs"},Fs=["onClick"],Ms={class:"rounded-md bg-white shadow sm:rounded-lg"},Ts={class:"px-4 py-5 sm:p-6"},Rs=p(()=>e("h3",{class:"text-base font-semibold leading-6 text-gray-900"}," Are you sure? ",-1)),Ps={class:"mt-5 flex space-x-2"},O=le({__name:"Assess",props:{userId:{}},setup(w){const G=w,{userId:v}=oe(G),{validateForm:J,actionIsInProgress:c,actionIsInError:Y,actionIsInSuccess:K}=ue(),{getAllAssessmentsByUserAbility:Q,getAllAssessmentLogsByUserId:I,assessUser:W,deleteAssessmentLog:X,assessmentActions:r}=we(),{getCurrentDateInYmdFormat:Z}=be(),{user:V}=pe(),F=_(null),M=_([]),T=Z(),y=_([]),C=_([]),a=_({user:{id:null,fullName:null},date:T,assessment:null,feedback:"",assessor_id:V.value.id,pass:!1}),k=_(null),A=_(!1),R=_(0),ee=n=>{R.value=n,A.value=!0},se=async()=>{await J(F.value,async()=>{await W(a.value);const n=await I(Number.parseInt(v.value.toString()));y.value=n.assessmentLogs,a.value.user=n.user,k.value=null,C.value=[]})},te=async n=>{await X(n);const o=await I(Number.parseInt(v.value.toString()));y.value=o.assessmentLogs,a.value.user=o.user,A.value=!1};return ae(async()=>{const[n,o]=await Promise.all([Q(),I(Number.parseInt(v.value.toString()))]);n&&(M.value=n),y.value=o.assessmentLogs,a.value.user=o.user}),L(k,n=>{n?(a.value.feedback="",a.value.assessment={...n,criteria:n.criteria.map(o=>({...o,pass:!1}))}):a.value.assessment=null}),L(v,async(n,o)=>{if(v.value&&v.value!==o){const B=await I(Number.parseInt(v.value.toString()));y.value=B.assessmentLogs,a.value={user:B.user,date:T,assessment:null,feedback:"",assessor_id:V.value.id,pass:!1},k.value=null}}),(n,o)=>{const B=ie("RouterLink");return t(),d(me,null,{default:x(()=>{var P;return[e("div",Ue,[e("div",Ie,[l(c)(l(r).getAllAssessmentsByUserAbility)||l(c)(l(r).getAllAssessmentLogsByUserId)?(t(),d(D,{key:0,class:"h-5 w-5 text-blue-500"})):(t(),d(B,{key:1,to:{name:n.$Routes.Staff}},{default:x(()=>[b(fe,{class:"h-5 w-5 fill-red-400"})]),_:1},8,["to"]))]),e("form",{id:"assess_user_form",ref_key:"assessUserFormElement",ref:F,class:"w-full space-y-8 divide-y divide-gray-200 px-6 md:px-12"},[e("div",Ce,[e("div",null,[Be,e("p",Ne,[f(" Use the form below to create a new Assessment Log for "),e("span",Se,m(a.value.user.fullName),1),f(". ")])]),e("div",De,[e("div",Ve,[e("div",null,[$e,N(e("input",{id:"date","onUpdate:modelValue":o[0]||(o[0]=s=>a.value.date=s),type:"date",name:"date",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"},null,512),[[E,a.value.date]])]),e("div",je,[Fe,N(e("select",{id:"assessment","onUpdate:modelValue":o[1]||(o[1]=s=>k.value=s),name:"assessment",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"},[Me,(t(!0),i(g,null,S(M.value,s=>(t(),i("option",{key:s.id,value:s},m(s.name),9,Te))),128))],512),[[H,k.value]])])]),a.value.assessment?(t(),i("div",Re,[Pe,(t(!0),i(g,null,S(a.value.assessment.criteria,s=>(t(),i("div",{key:s.id,class:"flex w-full items-start justify-between"},[e("p",Le,m(s.criteria),1),e("div",Ee,[b(l(ke),{modelValue:s.pass,"onUpdate:modelValue":h=>s.pass=h,class:$([s.pass?"bg-green-600":"bg-gray-200","relative inline-flex h-6 w-11 items-center rounded-full"])},{default:x(()=>[e("span",{class:$([s.pass?"translate-x-6":"translate-x-1","inline-block h-4 w-4 rounded-full bg-white transition"])},null,2)]),_:2},1032,["modelValue","onUpdate:modelValue","class"])])]))),128))])):u("",!0),a.value.assessment?(t(),i("div",He,[e("label",qe,[f(" Feedback or additional comments "),e("span",{class:"text-xs font-normal text-gray-400",innerHTML:`(from ${(P=l(V))==null?void 0:P.fullName})`},null,8,ze)]),N(e("textarea",{id:"feedback","onUpdate:modelValue":o[2]||(o[2]=s=>a.value.feedback=s),name:"feedback",rows:"8",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm",required:""},null,512),[[E,a.value.feedback]])])):u("",!0),a.value.assessment?(t(),i("div",Oe,[Ge,N(e("select",{id:"verdict","onUpdate:modelValue":o[3]||(o[3]=s=>a.value.pass=s),name:"verdict",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"},Ke,512),[[H,a.value.pass]])])):u("",!0)])]),e("div",Qe,[e("div",We,[b(j,{name:"alert"},{default:x(()=>[l(K)(l(r).assessUser)?(t(),d(_e,{key:0,action:l(r).assessUser},null,8,["action"])):u("",!0)]),_:1}),b(j,{name:"alert"},{default:x(()=>[l(Y)(l(r).assessUser)?(t(),d(ve,{key:0,action:l(r).assessUser},null,8,["action"])):u("",!0)]),_:1}),e("div",Xe,[e("button",{disabled:l(c)(l(r).getAllAssessmentsByUserAbility)||l(c)(l(r).getAllAssessmentLogsByUserId)||l(c)(l(r).assessUser),class:"ml-3 inline-flex h-9 items-center justify-center rounded-md border border-transparent bg-blue-600 px-4 py-2 text-sm font-medium text-white shadow-sm focus:outline-none disabled:cursor-not-allowed hover:bg-blue-700",onClick:re(se,["prevent"])},[!l(c)(l(r).getAllAssessmentsByUserAbility)&&!l(c)(l(r).getAllAssessmentLogsByUserId)&&!l(c)(l(r).assessUser)?(t(),i("span",es," Save ")):(t(),d(D,{key:1,class:"h-3 w-3 text-white"}))],8,Ze)])])])],512),e("div",ss,[e("div",ts,[e("div",ls,[e("div",null,[os,e("p",as,[f(" Below are the previous assessment logs for "),e("span",is,m(a.value.user.fullName),1),f(". ")])]),l(c)(l(r).getAllAssessmentLogsByUserId)?(t(),d(D,{key:0,class:"h-5 w-5 text-blue-500"})):u("",!0)]),!l(c)(l(r).getAllAssessmentLogsByUserId)&&y.value.length?(t(),i("div",rs,[e("div",ns,[e("ul",ds,[(t(!0),i(g,null,S(y.value,(s,h)=>(t(),i("li",{key:s.id},[e("div",cs,[h!==y.value.length-1?(t(),i("span",ms)):u("",!0),e("div",us,[s.feedback?(t(),i(g,{key:0},[e("div",ps,[e("div",{class:$(["flex h-10 w-10 items-center justify-center rounded-full bg-gray-100 ring-8 ring-white",[{"bg-green-100":s.pass},{"bg-red-100":!s.pass}]])},[s.pass?(t(),d(z,{key:0,class:"h-5 w-5 fill-green-500"})):(t(),d(q,{key:1,class:"h-5 w-5 fill-red-500"}))],2),e("span",fs,[b(l(he),{class:"h-4 w-4 text-gray-400","aria-hidden":"true"})])]),e("div",_s,[e("div",null,[e("div",vs,[e("p",ys,[f(m(s.assessment_name)+" ",1),e("span",bs,"(with "+m(s.assessor.fullName)+")",1)])]),e("p",hs,[f(" Assessment date: "),e("span",xs,m(s.assessment_date),1)])]),e("div",gs,[e("p",ws,' - "'+m(s.feedback)+'" ',1)]),e("div",null,[!C.value.includes(h)&&s.criteria.length?(t(),i("button",{key:0,class:"text-sm",onClick:U=>C.value.push(h)}," Show criteria ",8,ks)):u("",!0),C.value.includes(h)?(t(),i("div",As,[e("ul",Us,[(t(!0),i(g,null,S(s.criteria,U=>(t(),i("li",{key:U.id,class:"flex items-start justify-between"},[e("span",Is,m(U.criteria),1),U.pass?(t(),d(z,{key:0,class:"h-5 w-5 shrink-0 fill-green-500"})):(t(),d(q,{key:1,class:"h-5 w-5 shrink-0 fill-red-500"}))]))),128))])])):u("",!0)])])],64)):s.feedback?u("",!0):(t(),i(g,{key:1},[e("div",null,[e("div",Cs,[e("div",Bs,[b(xe,{class:"h-5 w-5 fill-gray-500","aria-hidden":"true"})])])]),e("div",Ns,[e("div",Ss,[s.feedback?(t(),i("p",Ds,[f(m(s.assessment_name)+" ",1),e("span",Vs,"(with "+m(s.assessor.fullName)+")",1)])):(t(),i("p",$s,m(s.assessment_name),1)),f(" Assessment date: "),e("span",js,m(s.assessment_date),1)])])],64)),e("button",{class:"group",onClick:U=>ee(s.id)},[l(c)({id:`deleteAssessmentLog-${s.id.toString()}`,successMessage:"Assessment log deleted successfully.",errorMessage:"Failed to delete assessment log."})?(t(),d(D,{key:1,class:"h-5 w-5 text-red-400 group-hover:text-red-600"})):(t(),d(ge,{key:0,class:"h-5 w-5 fill-red-400 group-hover:fill-red-600"}))],8,Fs)])])]))),128))])])])):!l(c)(l(r).getAllAssessmentLogsByUserId)&&!l(c)(l(r).getAllAssessmentsByUserAbility)?(t(),d(ye,{key:1,title:`There are no assessment logs for ${a.value.user.fullName}`,message:"Use the form above to add a new assessment log."},null,8,["title"])):u("",!0),(t(),d(ne,{to:"#modal"},[b(j,null,{default:x(()=>[A.value?(t(),i("div",{key:0,class:"pointer-events-auto fixed inset-0 isolate flex items-center justify-center overflow-x-auto bg-black/50",onClick:o[6]||(o[6]=s=>A.value=!1)},[e("div",Ms,[e("div",Ts,[Rs,e("div",Ps,[e("button",{type:"button",class:"inline-flex items-center rounded-md bg-red-600 px-3 py-2 text-sm font-semibold text-white shadow-sm focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-red-500 hover:bg-red-500",onClick:o[4]||(o[4]=s=>A.value=!1)}," Cancel "),e("button",{type:"button",class:"inline-flex items-center rounded-md bg-blue-600 px-3 py-2 text-sm font-semibold text-white shadow-sm focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-500 hover:bg-blue-500",onClick:o[5]||(o[5]=s=>te(R.value))}," Confirm ")])])])])):u("",!0)]),_:1})]))])])])]}),_:1})}}}),_l=Ae(O,[["__scopeId","data-v-6ce29b27"]]);O.__docgenInfo={exportName:"default",displayName:"Assess",description:"",tags:{},props:[{name:"userId",required:!0,type:{name:"number"}}],sourceFiles:["D:/work/server/htdocs/aa-portal.is/src/pages/staff/Assess.vue"]};export{_l as default};
