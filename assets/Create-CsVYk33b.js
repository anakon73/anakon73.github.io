import{e as L,j as w,g as k,q as P,o as a,A as m,B as c,E as A,l as e,b as p,x as D,G as f,u as i,J as n,P as I,S as C,k as d,H as M,F as U,U as H,D as N,T,N as z}from"./vue.esm-bundler-CYPfFjdk.js";import{s as G,u as J,e as v}from"./schemas-74JEr9Jm.js";import{R as O}from"./RightDrawer-Lpr6admO.js";import{a as Y,e as K}from"./preview-D0Pi-YKn.js";import{u as Q}from"./useDeviation-ZZmaucR8.js";import{I as W}from"./IconClose-tbzieUCA.js";import{P as X}from"./ProgressSpinner-lCLkagxy.js";import{u as Z}from"./useHelpers-Uc_HlRzD.js";import{_ as ee,a as te}from"./ActionErrorAlert--bGVRXV4.js";import"./index-LmGWO5sK.js";import"./vue-router-E7v71uM3.js";import"./routes-WhYxSpGG.js";import"./models-qWR1FMGP.js";import"./_plugin-vue_export-helper-x3n3nnut.js";import"./chunk-UXHY756F-iEg6Hh0Y.js";import"./index-C1vJkiWb.js";import"./_commonjsHelpers-4gQjN7DL.js";import"./preview-errors-7FWlPnjy.js";import"./index-PPLHz8o0.js";import"./PDays-npMhi6Nw.js";import"./index-baqd9Qr3.js";import"./index-TCXC35p5.js";import"./index-05uTbNHo.js";import"./PPopoverPanel-RNuJphX8.js";import"./headlessui-float-sqR0azf2.js";import"./transition-qpXhaAaU.js";import"./keyboard-64MH3N5t.js";import"./open-closed-nhb_Ydho.js";import"./use-root-containers-gEPBKDr2.js";import"./use-resolve-button-type-49aRxFpo.js";import"./iframe-ufxlS10p.js";import"../sb-preview/runtime.js";import"./query-G1AwWss6.js";import"./ChevronDownIcon-AgxEjrtE.js";import"./listbox-3RN1mHPV.js";import"./form-TGXPuq_M.js";import"./DepartureList-w5NrqMJ9.js";import"./DepartureAssignStaffAndVehicles-8AoBdfT8.js";import"./api-B2HcjM2j.js";import"./api-cJzoLyfI.js";import"./PButton-h9_xezBg.js";import"./index-VqpYtbVe.js";import"./PInput-iZb_REtl.js";import"./POverlay-3jPNvx4x.js";import"./PSpinner-cF72MsvC.js";import"./IconBus-0QPjtZ9u.js";import"./IconPerson-i3ljUCnk.js";import"./SuggestedUser-4kWsZiWj.js";import"./PAvatar-wq6oK0Zr.js";import"./PlusCircleIcon-aSiXn_Mr.js";import"./SuggestedVehicle-r1TyKt-D.js";import"./ScheduledUser-esbe3tjU.js";import"./VehicleTitle-0pOySBND.js";import"./XMarkIcon-_tXc_TyD.js";import"./PPhoneLink-wKLYRG_F.js";import"./PAlert-quHLeqTA.js";import"./CheckCircleIcon-akbq8cGf.js";import"./XMarkIcon-t43a1P5Z.js";import"./PDialogTitle-rfxNVwSR.js";import"./description-LPuBJoU_.js";import"./DepartureListItem-I88AIHqM.js";import"./DepartureUpdateComment-2rt04tFb.js";import"./PTextarea-Wrr33MR5.js";import"./DepartureUpdateCommentPopover-euFlcGix.js";import"./DepartureUpdateStatus-zdhd3wV8.js";import"./PListboxLabel-U39qo3cm.js";import"./CheckIcon-WRJIoum8.js";import"./lib-Fy6oBlQ3.js";import"./PToggle-mLVcOzrp.js";import"./PRadio-sGATo2dT.js";import"./index-bhXQ3okY.js";import"./isNativeReflectConstruct-ubdnbphT.js";import"./mock-vjhcKIQW.js";import"./index-1aVAeLWL.js";import"./mock-UR5nntqf.js";import"./mock-CzN7Q16W.js";import"./mock-YoOI-P8k.js";import"./mock-psFphV_9.js";import"./mock-OgPWcINV.js";import"./IconTickMarkCircle-2_sKm8Jk.js";const oe={class:"isolate flex flex-col items-center justify-center border-l bg-white pb-6"},se={class:"sticky top-0 z-10 flex w-full items-center justify-end bg-white p-6"},ie={class:"mb-6"},re=e("h3",{class:"text-base font-semibold leading-6 text-gray-900"}," Log deviation. ",-1),ae={class:"mt-1 text-sm text-gray-500"},le={class:"text-xs italic"},ne={class:"grid grid-cols-1 gap-x-4 gap-y-6 pt-6 sm:grid-cols-6"},de={class:"sm:col-span-3"},me=e("label",{for:"deviation_date_input",class:"block text-sm font-medium text-gray-700"}," Date and Time ",-1),ce={class:"mt-1"},pe={class:"sm:col-span-3"},ue=e("label",{for:"staff_involved_id",class:"block text-sm font-medium text-gray-700"}," Staff Involved ",-1),fe={class:"mt-1"},ve=["value"],_e={class:"grid grid-cols-1 gap-x-4 gap-y-6 pt-6 sm:grid-cols-6"},be={class:"sm:col-span-6"},ge=e("label",{for:"category",class:"block text-sm font-medium text-gray-700"}," Category ",-1),xe={class:"mt-1"},he=["value"],ye={class:"grid grid-cols-1 gap-x-4 gap-y-6 pt-6 sm:grid-cols-6"},we={class:"sm:col-span-6"},ke=e("label",{for:"incident_description",class:"block text-sm font-medium text-gray-700 sm:mt-px sm:pt-2"}," Details of the incident ",-1),De={class:"mt-1 sm:col-span-2"},Ie={class:"col-span-6"},Ce={class:"mt-2 flex w-full items-center text-sm text-gray-500"},Me={class:"relative pt-5"},Ue={class:"flex items-center justify-end"},Ne={class:"flex items-center"},Te={key:0},Re=L({__name:"Create",setup(Se){const{validateForm:R,actionIsInProgress:S,actionIsInError:V,actionIsInSuccess:F}=Y(),{getCurrentDateInYmdFormat:_}=Z(),b=w(null),{createDeviation:$,deviationActions:l}=Q(),{fetchAndStoreUsersIndex:j,user:u}=K(),{storeUsers:g}=G(J()),q=`${_()}T08:00`,B=`${_()}T23:59`,o=w({dateInput:q,staffMemberInvolvedId:0,staffMemberReportingId:0,staffMemberNotified:!1,category:{value:v[0].value,label:v[0].label},details:""}),x=k(()=>{var r;return(r=u.value)==null?void 0:r.departments.find(s=>s.primary)}),h=k({get:()=>o.value.category,set:r=>{o.value.category.label=r.label,o.value.category.value=r.value}});return P(async()=>{var r;x.value&&await j((r=x.value)==null?void 0:r.id,!1),o.value.staffMemberInvolvedId=g.value[0].id,o.value.staffMemberReportingId=u.value.id}),(r,s)=>{const E=A("RouterLink");return a(),m(O,null,{default:c(()=>{var y;return[e("div",oe,[e("div",se,[p(E,{to:{name:r.$Routes.Deviations}},{default:c(()=>[p(W,{class:"h-5 w-5 fill-red-400"})]),_:1},8,["to"])]),e("form",{id:"create_deviation_form",ref_key:"createDeviationFormElement",ref:b,class:"space-y-8 divide-y divide-gray-200 px-6 md:px-12"},[e("div",ie,[re,e("p",ae,[D(" Use the form below to log a new deviation. "),e("span",le,f(`(Reporting as ${(y=i(u))==null?void 0:y.fullName})`),1)])]),e("div",ne,[e("div",de,[me,e("div",ce,[n(e("input",{id:"deviation_date_input","onUpdate:modelValue":s[0]||(s[0]=t=>o.value.dateInput=t),type:"datetime-local",max:B,class:"block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"},null,512),[[I,o.value.dateInput]])])]),e("div",pe,[ue,e("div",fe,[n(e("select",{id:"staff_involved_id","onUpdate:modelValue":s[1]||(s[1]=t=>o.value.staffMemberInvolvedId=t),class:"block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm",required:""},[(a(!0),d(U,null,M(i(g),t=>(a(),d("option",{key:t.id,value:t.id},f(t.fullName),9,ve))),128))],512),[[C,o.value.staffMemberInvolvedId]])])])]),e("div",_e,[e("div",be,[ge,e("div",xe,[n(e("select",{id:"category","onUpdate:modelValue":s[2]||(s[2]=t=>h.value=t),class:"block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm",required:""},[(a(!0),d(U,null,M(i(v),t=>(a(),d("option",{key:t.value,value:t},f(t.label),9,he))),128))],512),[[C,h.value]])])])]),e("div",ye,[e("div",we,[ke,e("div",De,[n(e("textarea",{id:"incident_description","onUpdate:modelValue":s[3]||(s[3]=t=>o.value.details=t),rows:"3",class:"block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm",required:""},null,512),[[I,o.value.details]])])]),e("div",Ie,[e("label",Ce,[n(e("input",{id:"staff_involved_informed","onUpdate:modelValue":s[4]||(s[4]=t=>o.value.staffMemberNotified=t),type:"checkbox",class:"mr-2 h-4 w-4 cursor-pointer rounded border-gray-300 text-blue-600 focus:ring-blue-500",required:""},null,512),[[H,o.value.staffMemberNotified]]),D(" Staff involved have been informed and the incident is a breach of a formal procedure. ")])])]),e("div",Me,[e("div",Ue,[p(T,{name:"alert"},{default:c(()=>[i(F)(i(l).createDeviation)?(a(),m(ee,{key:0,action:i(l).createDeviation},null,8,["action"])):N("",!0)]),_:1}),p(T,{name:"alert"},{default:c(()=>[i(V)(i(l).createDeviation)?(a(),m(te,{key:0,action:i(l).createDeviation},null,8,["action"])):N("",!0)]),_:1}),e("div",Ne,[e("button",{class:"ml-3 inline-flex h-9 items-center justify-center rounded-md border border-transparent bg-blue-600 px-4 py-2 text-sm font-medium text-white shadow-sm focus:outline-none hover:bg-blue-700",onClick:s[5]||(s[5]=z(t=>i(R)(b.value,()=>i($)(o.value)),["prevent"]))},[i(S)(i(l).createDeviation)?(a(),m(X,{key:1,class:"h-3 w-3 text-white"})):(a(),d("span",Te," Log Deviation "))])])])])],512)])]}),_:1})}}});Re.__docgenInfo={exportName:"default",displayName:"Create",description:"",tags:{},sourceFiles:["D:/work/server/htdocs/aa-portal.is/src/pages/deviations/Create.vue"]};export{Re as default};
