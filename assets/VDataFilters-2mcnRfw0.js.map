{"version":3,"file":"VDataFilters-2mcnRfw0.js","sources":["../../node_modules/.pnpm/@heroicons+vue@2.1.1_vue@3.4.7/node_modules/@heroicons/vue/20/solid/esm/ChevronLeftIcon.js","../../node_modules/.pnpm/@heroicons+vue@2.1.1_vue@3.4.7/node_modules/@heroicons/vue/20/solid/esm/ChevronRightIcon.js","../../src/shared/ui/inputs/VDataFilters.vue"],"sourcesContent":["import { createElementVNode as _createElementVNode, openBlock as _openBlock, createElementBlock as _createElementBlock } from \"vue\"\n\nexport default function render(_ctx, _cache) {\n  return (_openBlock(), _createElementBlock(\"svg\", {\n    xmlns: \"http://www.w3.org/2000/svg\",\n    viewBox: \"0 0 20 20\",\n    fill: \"currentColor\",\n    \"aria-hidden\": \"true\",\n    \"data-slot\": \"icon\"\n  }, [\n    _createElementVNode(\"path\", {\n      \"fill-rule\": \"evenodd\",\n      d: \"M11.78 5.22a.75.75 0 0 1 0 1.06L8.06 10l3.72 3.72a.75.75 0 1 1-1.06 1.06l-4.25-4.25a.75.75 0 0 1 0-1.06l4.25-4.25a.75.75 0 0 1 1.06 0Z\",\n      \"clip-rule\": \"evenodd\"\n    })\n  ]))\n}","import { createElementVNode as _createElementVNode, openBlock as _openBlock, createElementBlock as _createElementBlock } from \"vue\"\n\nexport default function render(_ctx, _cache) {\n  return (_openBlock(), _createElementBlock(\"svg\", {\n    xmlns: \"http://www.w3.org/2000/svg\",\n    viewBox: \"0 0 20 20\",\n    fill: \"currentColor\",\n    \"aria-hidden\": \"true\",\n    \"data-slot\": \"icon\"\n  }, [\n    _createElementVNode(\"path\", {\n      \"fill-rule\": \"evenodd\",\n      d: \"M8.22 5.22a.75.75 0 0 1 1.06 0l4.25 4.25a.75.75 0 0 1 0 1.06l-4.25 4.25a.75.75 0 0 1-1.06-1.06L11.94 10 8.22 6.28a.75.75 0 0 1 0-1.06Z\",\n      \"clip-rule\": \"evenodd\"\n    })\n  ]))\n}","<script setup lang=\"ts\">\nimport { computed, onMounted, ref, watch } from 'vue'\nimport { ChevronLeftIcon, ChevronRightIcon } from '@heroicons/vue/20/solid'\nimport type { IDepartment } from '@/shared/types/departments/IDepartments'\nimport type { IOperationalBase } from '@/shared/types/operational-bases/IOperationalBase'\nimport type { IRole } from '@/shared/types/roles/IRole'\nimport { useDepartment } from '@/shared/api/departments/useDepartment'\nimport { useOperationalBase } from '@/shared/api/operational-bases/useOperationalBase'\nimport { useRole } from '@/shared/api/roles/useRole'\nimport { useUi } from '@/shared/lib/composables/useUi'\nimport ProgressSpinner from '@/shared/ui/ProgressSpinner.vue'\nimport type { IDataFilters } from '@/shared/types/inputs/IDataFilters'\nimport type { AppPermissions } from '@/shared/types/enums/permissions/permissions'\nimport { useAuth } from '@/shared/api/useAuth'\n\nconst emits = defineEmits<{\n  filterStateUpdated: [filterState: IDataFilters]\n}>()\n\ninterface IProps {\n  filterByDate?: boolean\n  filterByMonth?: boolean\n  filterByDepartments?: boolean\n  filterByOperationalBases?: boolean\n  filterByRoles?: boolean\n  showAllOperationalBases?: boolean\n  showAllRoles?: boolean\n  allowNoDepartment?: boolean\n  departmentPermissionsRequired?: AppPermissions[]\n}\nconst {\n  filterByDate = false,\n  filterByMonth = false,\n  filterByDepartments = true,\n  filterByOperationalBases = false,\n  filterByRoles = false,\n  showAllOperationalBases = false,\n  showAllRoles = false,\n  departmentPermissionsRequired = [],\n} = defineProps<IProps>()\n\nconst { actionIsInProgress } = useUi()\nconst { apiGetDepartments, departmentActions } = useDepartment()\nconst { apiGetOperationalBasesByDepartments, operationalBaseActions } = useOperationalBase()\nconst { apiGetRolesByDepartments, roleActions } = useRole()\nconst { userHasSomePermissionsInDepartment } = useAuth()\n\nconst departments = ref<IDepartment[]>([])\nconst roles = ref<IRole[]>([])\nconst operationalBases = ref<IOperationalBase[]>([])\n\nconst selectedDepartment = ref<IDepartment | null>(null)\nconst selectedOperationalBase = ref<IOperationalBase | null>(null)\nconst selectedRole = ref<IRole | null>(null)\nconst selectedMonth = ref<string>(new Date().toISOString().split('T')[0])\nconst selectedDate = ref<string>(new Date().toISOString().split('T')[0])\n\nconst showAllOperationalBasesOption: IOperationalBase = {\n  id: 0,\n  name: 'All Operational Bases',\n  longitude: '',\n  latitude: '',\n  privateStaffSchedules: false,\n  department: {\n    id: 0,\n    name: 'All Departments',\n    organisationId: 0,\n    code: '',\n    description: '',\n  },\n}\nconst showAllRolesOption: IRole = {\n  id: 0,\n  name: 'All Roles',\n  slug: '',\n  description: '',\n  department: {\n    id: 0,\n    name: 'All Departments',\n    organisationId: 0,\n    code: '',\n    description: '',\n  },\n  roleCategories: [],\n}\n\nconst initialLoad = ref<boolean>(true)\n\nconst filterState = computed(() => {\n  return {\n    selectedDepartment: selectedDepartment.value,\n    selectedOperationalBase: selectedOperationalBase.value,\n    selectedRole: selectedRole.value,\n    selectedMonth: selectedMonth.value,\n    selectedDate: selectedDate.value,\n  } as IDataFilters\n})\n\nconst loadDepartments = async () => {\n  departments.value = await apiGetDepartments()\n\n  if (departmentPermissionsRequired.length > 0) {\n    departments.value = departments.value.filter((d) => {\n      return userHasSomePermissionsInDepartment(departmentPermissionsRequired, d)\n    })\n  }\n\n  selectedDepartment.value = departments.value[0]\n}\n\nconst loadOperationalBases = async () => {\n  if (selectedDepartment.value) {\n    const rsp = await apiGetOperationalBasesByDepartments([selectedDepartment.value])\n    if (rsp) {\n      operationalBases.value = rsp\n    }\n    if (showAllOperationalBases && operationalBases.value.length > 1) {\n      operationalBases.value.unshift(showAllOperationalBasesOption)\n    }\n    selectedOperationalBase.value = operationalBases.value[0]\n  }\n}\n\nconst loadRoles = async () => {\n  if (selectedDepartment.value) {\n    const rsp = await apiGetRolesByDepartments([selectedDepartment.value])\n    if (rsp) {\n      roles.value = rsp.data.roles\n    }\n    if (showAllRoles) {\n      roles.value.unshift(showAllRolesOption)\n    }\n    selectedRole.value = roles.value[0]\n  }\n}\n\nconst changeMonth = (increment: boolean) => {\n  const currentYear = new Date(selectedMonth.value).getFullYear()\n  const currentMonth = new Date(selectedMonth.value).getMonth()\n  let newYear = null\n  if (currentMonth === 11 && increment) newYear = currentYear + 1\n  if (currentMonth === 0 && !increment) newYear = currentYear - 1\n  if (!newYear) {\n    newYear = currentYear\n  }\n\n  let newMonth = increment ? (currentMonth + 2) % 12 : (currentMonth) % 12\n\n  if (newMonth === 0) newMonth = 12\n  const formattedMonth = newMonth < 10 ? `0${newMonth}` : newMonth\n\n  selectedMonth.value = `${newYear}-${formattedMonth}-01`\n}\n\nconst dateLabel = computed(() => {\n  const d = new Date(selectedMonth.value)\n  return `${d.toLocaleString('default', { month: 'long' })} ${d.getFullYear()}`\n})\n\nonMounted(async () => {\n  await loadDepartments()\n\n  if (filterByOperationalBases) {\n    await loadOperationalBases()\n  }\n\n  if (filterByRoles) {\n    await loadRoles()\n  }\n\n  initialLoad.value = false\n  emits('filterStateUpdated', filterState.value)\n})\n\nwatch(selectedDepartment, async () => {\n  if (initialLoad.value) return\n\n  if (filterByOperationalBases) {\n    await loadOperationalBases()\n  }\n  if (filterByRoles) {\n    await loadRoles()\n  }\n\n  emits('filterStateUpdated', filterState.value)\n})\nwatch (selectedOperationalBase, async () => {\n  if (initialLoad.value) return\n\n  if (filterByRoles) {\n    await loadRoles()\n  }\n\n  emits('filterStateUpdated', filterState.value)\n})\nwatch (selectedRole, () => {\n  if (initialLoad.value) return\n  emits('filterStateUpdated', filterState.value)\n})\nwatch(selectedMonth, () => {\n  if (initialLoad.value) return\n  emits('filterStateUpdated', filterState.value)\n})\nwatch(selectedDate, () => {\n  if (initialLoad.value) return\n  // prevent browser 'clear' button from setting date to empty string\n  if (!selectedDate.value.length) {\n    selectedDate.value = new Date().toISOString().split('T')[0]\n  }\n  emits('filterStateUpdated', filterState.value)\n})\n</script>\n\n<template>\n  <div class=\"flex w-full flex-col space-y-2 sm:flex-row sm:space-x-2 sm:space-y-0\">\n    <!-- Month Select -->\n    <div\n      v-if=\"filterByMonth\"\n      class=\"flex rounded-md bg-white\"\n    >\n      <button\n        type=\"button\"\n        class=\"rounded-l p-2 py-1.5 text-gray-900 ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-blue-300\"\n        @click=\"changeMonth(false)\"\n      >\n        <ChevronLeftIcon class=\"h-5 w-5 fill-gray-500\" />\n      </button>\n      <div\n        class=\"relative w-full min-w-[130px] flex-1 px-3 py-2 text-center text-gray-900 ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-blue-300 sm:text-sm sm:leading-6\"\n        v-html=\"dateLabel\"\n      />\n      <button\n        type=\"button\"\n        class=\"rounded-r p-2 py-1.5 text-gray-900 ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-blue-300\"\n        @click=\"changeMonth(true)\"\n      >\n        <ChevronRightIcon class=\"h-5 w-5 fill-gray-500\" />\n      </button>\n    </div>\n\n    <!-- Department Select -->\n    <div\n      v-if=\"filterByDepartments\"\n      class=\"relative\"\n      :class=\"{ 'cursor-not-allowed opacity-50': actionIsInProgress(departmentActions.getDepartments) }\"\n    >\n      <select\n        v-model=\"selectedDepartment\"\n        class=\"block h-[40px] w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:min-w-[250px] sm:text-sm\"\n      >\n        <option\n          v-if=\"allowNoDepartment\"\n          :value=\"null\"\n        >\n          All\n        </option>\n        <option\n          v-for=\"department in departments\"\n          :key=\"department.id\"\n          :value=\"department\"\n        >\n          {{ department.name }}\n        </option>\n      </select>\n      <div\n        v-if=\"actionIsInProgress(departmentActions.getDepartments)\"\n        class=\"absolute inset-0 flex items-center justify-center\"\n      >\n        <ProgressSpinner class=\"h-4 w-4 text-blue-500\" />\n      </div>\n    </div>\n\n    <!-- Operational Base Select -->\n    <div\n      v-if=\"filterByOperationalBases && operationalBases.length > 1\"\n      class=\"relative\"\n      :class=\"{\n        'cursor-not-allowed opacity-50': actionIsInProgress(departmentActions.getDepartments)\n          || actionIsInProgress(operationalBaseActions.getOperationalBasesByDepartments),\n      }\"\n    >\n      <select\n        v-model=\"selectedOperationalBase\"\n        class=\"block h-[40px] w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:min-w-[250px] sm:text-sm\"\n        :disabled=\"operationalBases.length === 1\"\n        :class=\"{ 'bg-gray-200 bg-none': operationalBases.length === 1 }\"\n      >\n        <option\n          v-for=\"base in operationalBases\"\n          :key=\"base.id\"\n          :value=\"base\"\n        >\n          {{ base.name }}\n        </option>\n      </select>\n      <div\n        v-if=\"actionIsInProgress(departmentActions.getDepartments) || actionIsInProgress(operationalBaseActions.getOperationalBasesByDepartments)\"\n        class=\"absolute inset-0 flex items-center justify-center\"\n      >\n        <ProgressSpinner class=\"h-4 w-4 text-blue-500\" />\n      </div>\n    </div>\n\n    <!-- Role Select -->\n    <div\n      v-if=\"filterByRoles\"\n      class=\"relative\"\n      :class=\"{\n        'cursor-not-allowed opacity-50': actionIsInProgress(departmentActions.getDepartments)\n          || actionIsInProgress(roleActions.getRolesByDepartments),\n      }\"\n    >\n      <select\n        v-model=\"selectedRole\"\n        class=\"block h-[40px] w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:min-w-[250px] sm:text-sm\"\n      >\n        <option\n          v-for=\"role in roles\"\n          :key=\"role.id\"\n          :value=\"role\"\n        >\n          {{ role.name }}\n        </option>\n      </select>\n      <div\n        v-if=\"actionIsInProgress(departmentActions.getDepartments) || actionIsInProgress(roleActions.getRolesByDepartments)\"\n        class=\"absolute inset-0 flex items-center justify-center\"\n      >\n        <ProgressSpinner class=\"h-4 w-4 text-blue-500\" />\n      </div>\n    </div>\n\n    <div\n      v-if=\"filterByDate\"\n      class=\"\"\n    >\n      <input\n        v-model=\"selectedDate\"\n        type=\"date\"\n        class=\"block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:min-w-[250px] sm:text-sm\"\n      >\n    </div>\n  </div>\n</template>\n"],"names":["render","_ctx","_cache","_openBlock","_createElementBlock","_createElementVNode","emits","__emit","actionIsInProgress","useUi","apiGetDepartments","departmentActions","useDepartment","apiGetOperationalBasesByDepartments","operationalBaseActions","useOperationalBase","apiGetRolesByDepartments","roleActions","useRole","userHasSomePermissionsInDepartment","useAuth","departments","ref","roles","operationalBases","selectedDepartment","selectedOperationalBase","selectedRole","selectedMonth","selectedDate","showAllOperationalBasesOption","showAllRolesOption","initialLoad","filterState","computed","loadDepartments","__props","d","loadOperationalBases","rsp","loadRoles","changeMonth","increment","currentYear","currentMonth","newYear","newMonth","formattedMonth","dateLabel","onMounted","watch"],"mappings":"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","x_google_ignoreList":[0,1]}