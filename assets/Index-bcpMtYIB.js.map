{"version":3,"file":"Index-bcpMtYIB.js","sources":["../../src/shared/api/stores/deviation.ts","../../src/pages/deviations/Index.vue"],"sourcesContent":["import { ref } from 'vue'\nimport { defineStore } from 'pinia'\nimport type { IDeviation } from '@/shared/types/deviations/IDeviation'\n\nexport const useDeviationStore = defineStore('deviations', () => {\n  const storeDeviations = ref<IDeviation[]>([])\n\n  function storeSetDeviations(i: IDeviation[]) {\n    storeDeviations.value = i\n  }\n\n  function storeAddDeviation(i: IDeviation) {\n    storeDeviations.value.push(i)\n  }\n\n  function storeUpdateDeviation(i: IDeviation) {\n    const index = storeDeviations.value.findIndex((deviations) => deviations.id === i.id)\n    storeDeviations.value[index] = i\n  }\n\n  function storeRemoveDeviation(i: IDeviation) {\n    const index = storeDeviations.value.findIndex((deviations) => deviations.id === i.id)\n    if (index !== -1) {\n      storeDeviations.value.splice(index, 1)\n    }\n  }\n\n  function storeClearDeviations() {\n    storeDeviations.value = []\n  }\n\n  return {\n    storeSetDeviations,\n    storeDeviations,\n    storeAddDeviation,\n    storeRemoveDeviation,\n    storeUpdateDeviation,\n    storeClearDeviations,\n  }\n})\n","<script setup lang=\"ts\">\nimport { onUnmounted } from 'vue'\nimport { storeToRefs } from 'pinia'\nimport MainContent from '@/shared/ui/layout/MainContent.vue'\nimport { useUi } from '@/shared/lib/composables/useUi'\nimport ProgressSpinner from '@/shared/ui/ProgressSpinner.vue'\nimport { useDeviation } from '@/shared/api/useDeviation'\nimport VDataFilters from '@/shared/ui/inputs/VDataFilters.vue'\nimport type { IDataFilters } from '@/shared/types/inputs/IDataFilters'\nimport { useUiStore } from '@/shared/lib/composables/ui'\nimport { useDeviationStore } from '@/shared/api/stores/deviation'\nimport { AppPermissions } from '@/shared/types/enums/permissions/permissions'\nimport { useUser } from '@/shared/api/useUser'\nimport { useAuth } from '@/shared/api/useAuth'\n\nconst { deviationActions } = useDeviation()\nconst { actionIsInProgress } = useUi()\n\nconst { storeFilterState } = storeToRefs(useUiStore())\nconst { storeSetFilterState } = useUiStore()\nconst { apiGetDeviationsByDepartmentId } = useDeviation()\nconst { storeSetDeviations, storeClearDeviations } = useDeviationStore()\nconst { storeDeviations } = storeToRefs(useDeviationStore())\nconst { user } = useUser()\n\nconst { userHasPermissionInDepartment } = useAuth()\n\nconst handleFilterStateUpdate = async (newFilterState: IDataFilters) => {\n  storeSetFilterState(newFilterState)\n\n  if (storeFilterState.value.selectedDepartment === null) {\n    return\n  }\n\n  const deviations = await apiGetDeviationsByDepartmentId(storeFilterState.value.selectedDepartment.id)\n\n  if (deviations) {\n    storeSetDeviations(deviations)\n  }\n}\nonUnmounted(() => {\n  storeClearDeviations()\n})\n</script>\n\n<template>\n  <MainContent main-content-title=\"Manage Deviations\">\n    <div class=\"mt-12 flex w-full justify-end\">\n      <RouterLink\n        :to=\"{ name: $Routes.CreateDeviation }\"\n        class=\"block w-1/2 rounded-md bg-blue-600 px-3 py-1.5 text-center text-sm font-semibold leading-6 text-white shadow-sm focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-600 hover:bg-blue-500 md:w-48\"\n      >\n        Log Deviation\n      </RouterLink>\n    </div>\n\n    <VDataFilters\n      :department-permissions-required=\"[\n        AppPermissions.VIEW_DEVIATIONS,\n      ]\"\n      filter-by-departments\n      @filter-state-updated=\"handleFilterStateUpdate\"\n    />\n\n    <div class=\"flex flex-col pb-4\">\n      <div class=\"flow-root md:mt-8\">\n        <div class=\"overflow-x-auto\">\n          <div class=\"inline-block min-w-full py-2 align-middle\">\n            <div\n              v-if=\"storeFilterState.selectedDepartment === null || actionIsInProgress(deviationActions.getDeviationByDepartmentId)\"\n              class=\"flex h-[50px] items-center justify-center rounded border border-gray-100 bg-gray-50 shadow\"\n            >\n              <ProgressSpinner class=\"h-5 w-5 text-blue-600\" />\n            </div>\n\n            <table\n              v-else\n              class=\"min-w-full divide-y divide-gray-300 rounded border border-gray-100 bg-white shadow\"\n            >\n              <thead>\n                <tr>\n                  <th scope=\"col\" class=\"bg-gray-50 px-3 py-3.5 text-left text-sm font-semibold text-gray-900\">\n                    Time and date\n                  </th>\n                  <th scope=\"col\" class=\"bg-gray-50 px-3 py-3.5 text-left text-sm font-semibold text-gray-900\">\n                    Category\n                  </th>\n                  <th scope=\"col\" class=\"bg-gray-50 px-3 py-3.5 text-left text-sm font-semibold text-gray-900\">\n                    Staff involved\n                  </th>\n                  <th scope=\"col\" class=\"bg-gray-50 px-3 py-3.5 text-left text-sm font-semibold text-gray-900\">\n                    Staff reporting\n                  </th>\n                  <th scope=\"col\" class=\"bg-gray-50 px-3 py-3.5\" />\n                </tr>\n              </thead>\n              <tbody class=\"divide-y divide-gray-200\">\n                <template v-if=\"storeDeviations.length === 0\">\n                  <tr>\n                    <td colspan=\"8\" class=\"px-3 py-3.5 text-center text-sm text-gray-500\">\n                      No deviations found.\n                    </td>\n                  </tr>\n                </template>\n\n                <template v-else>\n                  <tr\n                    v-for=\"deviation in storeDeviations\"\n                    :key=\"deviation.id\"\n                  >\n                    <td class=\"p-3 text-sm text-gray-900\">\n                      {{ deviation.dateLabel }}\n                    </td>\n                    <td class=\"p-3 text-sm text-gray-900\">\n                      {{ deviation.categoryLabel }}\n                    </td>\n                    <td class=\"p-3 text-sm text-gray-900\">\n                      {{ deviation.staffMemberInvolved.fullName }}\n                    </td>\n                    <td class=\"p-3 text-sm text-gray-900\">\n                      {{ deviation.staffMemberReporting.fullName }}\n                    </td>\n                    <td class=\"p-3 text-right text-sm font-medium\">\n                      <RouterLink\n                        v-if=\"storeFilterState.selectedDepartment && userHasPermissionInDepartment(\n                          AppPermissions.MANAGE_DEVIATIONS,\n                          storeFilterState.selectedDepartment,\n                        ) || deviation.staffMemberInvolved.id === user?.id\"\n                        :to=\"{\n                          name: $Routes.ViewDeviation,\n                          params: { deviationId: deviation.id },\n                        }\"\n                        class=\"text-blue-600 hover:text-blue-900\"\n                      >\n                        View\n                      </RouterLink>\n                    </td>\n                  </tr>\n                </template>\n              </tbody>\n            </table>\n          </div>\n        </div>\n      </div>\n    </div>\n  </MainContent>\n</template>\n"],"names":["useDeviationStore","defineStore","storeDeviations","ref","storeSetDeviations","i","storeAddDeviation","storeUpdateDeviation","index","deviations","storeRemoveDeviation","storeClearDeviations","deviationActions","useDeviation","actionIsInProgress","useUi","storeFilterState","storeToRefs","useUiStore","storeSetFilterState","apiGetDeviationsByDepartmentId","user","useUser","userHasPermissionInDepartment","useAuth","handleFilterStateUpdate","newFilterState","onUnmounted"],"mappings":"40FAIa,MAAAA,EAAoBC,EAAY,aAAc,IAAM,CACzD,MAAAC,EAAkBC,EAAkB,CAAA,CAAE,EAE5C,SAASC,EAAmBC,EAAiB,CAC3CH,EAAgB,MAAQG,CAC1B,CAEA,SAASC,EAAkBD,EAAe,CACxBH,EAAA,MAAM,KAAKG,CAAC,CAC9B,CAEA,SAASE,EAAqBF,EAAe,CACrC,MAAAG,EAAQN,EAAgB,MAAM,UAAWO,GAAeA,EAAW,KAAOJ,EAAE,EAAE,EACpEH,EAAA,MAAMM,CAAK,EAAIH,CACjC,CAEA,SAASK,EAAqBL,EAAe,CACrC,MAAAG,EAAQN,EAAgB,MAAM,UAAWO,GAAeA,EAAW,KAAOJ,EAAE,EAAE,EAChFG,IAAU,IACIN,EAAA,MAAM,OAAOM,EAAO,CAAC,CAEzC,CAEA,SAASG,GAAuB,CAC9BT,EAAgB,MAAQ,EAC1B,CAEO,MAAA,CACL,mBAAAE,EACA,gBAAAF,EACA,kBAAAI,EACA,qBAAAI,EACA,qBAAAH,EACA,qBAAAI,CAAA,CAEJ,CAAC,u0CCxBK,KAAA,CAAE,iBAAAC,GAAqBC,IACvB,CAAE,mBAAAC,GAAuBC,IAEzB,CAAE,iBAAAC,CAAqB,EAAAC,EAAYC,EAAY,CAAA,EAC/C,CAAE,oBAAAC,GAAwBD,IAC1B,CAAE,+BAAAE,GAAmCP,IACrC,CAAE,mBAAAT,EAAoB,qBAAAO,CAAqB,EAAIX,EAAkB,EACjE,CAAE,gBAAAE,CAAoB,EAAAe,EAAYjB,EAAmB,CAAA,EACrD,CAAE,KAAAqB,GAASC,IAEX,CAAE,8BAAAC,GAAkCC,IAEpCC,EAA0B,MAAOC,GAAiC,CAGlE,GAFJP,EAAoBO,CAAc,EAE9BV,EAAiB,MAAM,qBAAuB,KAChD,OAGF,MAAMP,EAAa,MAAMW,EAA+BJ,EAAiB,MAAM,mBAAmB,EAAE,EAEhGP,GACFL,EAAmBK,CAAU,CAC/B,EAEF,OAAAkB,EAAY,IAAM,CACKhB,GAAA,CACtB"}