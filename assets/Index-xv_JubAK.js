import{e as T,g as N,j as A,q as V,v as E,o as i,A as _,B as m,E as F,l as e,b as p,u as r,G as a,T as G,k as n,H as w,C as y,D as c,F as h,x}from"./vue.esm-bundler-CYPfFjdk.js";import{a as R,M as U,A as M}from"./preview-D0Pi-YKn.js";import{u as H}from"./useIncident-6dw9YxXc.js";import{P as q}from"./ProgressSpinner-lCLkagxy.js";import{I as z,i as B}from"./schemas-74JEr9Jm.js";import{u as J}from"./useAuth-8d_1_S6I.js";import{r as K}from"./PListboxLabel-U39qo3cm.js";import{r as O}from"./CheckIcon-WRJIoum8.js";import{j as Q,A as W,F as X,I as Y}from"./listbox-3RN1mHPV.js";import"./chunk-UXHY756F-iEg6Hh0Y.js";import"./index-C1vJkiWb.js";import"./_commonjsHelpers-4gQjN7DL.js";import"./vue-router-E7v71uM3.js";import"./preview-errors-7FWlPnjy.js";import"./index-PPLHz8o0.js";import"./PDays-npMhi6Nw.js";import"./index-baqd9Qr3.js";import"./index-TCXC35p5.js";import"./index-05uTbNHo.js";import"./PPopoverPanel-RNuJphX8.js";import"./index-LmGWO5sK.js";import"./headlessui-float-sqR0azf2.js";import"./transition-qpXhaAaU.js";import"./keyboard-64MH3N5t.js";import"./open-closed-nhb_Ydho.js";import"./use-root-containers-gEPBKDr2.js";import"./use-resolve-button-type-49aRxFpo.js";import"./iframe-ufxlS10p.js";import"../sb-preview/runtime.js";import"./query-G1AwWss6.js";import"./ChevronDownIcon-AgxEjrtE.js";import"./DepartureList-w5NrqMJ9.js";import"./DepartureAssignStaffAndVehicles-8AoBdfT8.js";import"./api-B2HcjM2j.js";import"./api-cJzoLyfI.js";import"./PButton-h9_xezBg.js";import"./index-VqpYtbVe.js";import"./PInput-iZb_REtl.js";import"./POverlay-3jPNvx4x.js";import"./PSpinner-cF72MsvC.js";import"./IconBus-0QPjtZ9u.js";import"./_plugin-vue_export-helper-x3n3nnut.js";import"./IconPerson-i3ljUCnk.js";import"./SuggestedUser-4kWsZiWj.js";import"./PAvatar-wq6oK0Zr.js";import"./PlusCircleIcon-aSiXn_Mr.js";import"./SuggestedVehicle-r1TyKt-D.js";import"./ScheduledUser-esbe3tjU.js";import"./VehicleTitle-0pOySBND.js";import"./XMarkIcon-_tXc_TyD.js";import"./PPhoneLink-wKLYRG_F.js";import"./PAlert-quHLeqTA.js";import"./CheckCircleIcon-akbq8cGf.js";import"./XMarkIcon-t43a1P5Z.js";import"./PDialogTitle-rfxNVwSR.js";import"./description-LPuBJoU_.js";import"./DepartureListItem-I88AIHqM.js";import"./DepartureUpdateComment-2rt04tFb.js";import"./PTextarea-Wrr33MR5.js";import"./DepartureUpdateCommentPopover-euFlcGix.js";import"./DepartureUpdateStatus-zdhd3wV8.js";import"./models-qWR1FMGP.js";import"./lib-Fy6oBlQ3.js";import"./routes-WhYxSpGG.js";import"./PToggle-mLVcOzrp.js";import"./form-TGXPuq_M.js";import"./PRadio-sGATo2dT.js";import"./index-bhXQ3okY.js";import"./isNativeReflectConstruct-ubdnbphT.js";import"./mock-vjhcKIQW.js";import"./index-1aVAeLWL.js";import"./mock-UR5nntqf.js";import"./mock-CzN7Q16W.js";import"./mock-YoOI-P8k.js";import"./mock-psFphV_9.js";import"./mock-OgPWcINV.js";const Z={class:"mt-12 flex w-full justify-between gap-3"},ee={class:"flex w-1/2 items-center md:w-40"},te={class:"relative w-full"},se={class:"block truncate"},oe={class:"pointer-events-none absolute inset-y-0 right-0 flex items-center pr-2"},ie={key:0,class:"mt-6 flex items-center justify-between border-y border-gray-200 bg-white py-3 sm:px-3"},re={class:"flex w-full justify-between sm:hidden"},ne={class:"hidden sm:flex sm:flex-1 sm:items-center sm:justify-between"},ae={class:"text-sm text-gray-700"},le={class:"font-medium"},ue={class:"font-medium"},de={class:"font-medium"},me={class:"isolate inline-flex -space-x-px rounded-md shadow-sm","aria-label":"Pagination"},ce=e("svg",{class:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},[e("path",{"fill-rule":"evenodd",d:"M12.79 5.23a.75.75 0 01-.02 1.06L8.832 10l3.938 3.71a.75.75 0 11-1.04 1.08l-4.5-4.25a.75.75 0 010-1.08l4.5-4.25a.75.75 0 011.06.02z","clip-rule":"evenodd"})],-1),pe=[ce],fe=["onClick"],ge={key:1,class:"relative inline-flex items-center px-4 py-2 text-sm font-semibold text-gray-700 ring-1 ring-inset ring-gray-300 focus:outline-offset-0"},ve=e("svg",{class:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},[e("path",{"fill-rule":"evenodd",d:"M7.21 14.77a.75.75 0 01.02-1.06L11.168 10 7.23 6.29a.75.75 0 111.04-1.08l4.5 4.25a.75.75 0 010 1.08l-4.5 4.25a.75.75 0 01-1.06-.02z","clip-rule":"evenodd"})],-1),xe=[ve],be={class:"flex flex-col pb-4"},_e={class:"mt-8 flow-root"},ye={class:"overflow-x-auto"},he={class:"inline-block min-w-full py-2 align-middle"},we={key:0,class:"flex h-[50px] items-center justify-center rounded border border-gray-100 bg-gray-50 shadow"},Ie={key:1},Pe={class:"min-w-full divide-y divide-gray-300 rounded border border-gray-100 bg-white shadow"},ke=e("thead",null,[e("tr",null,[e("th",{scope:"col",class:"bg-gray-50 px-3 py-3.5 text-left text-sm font-semibold text-gray-900"}," Level "),e("th",{scope:"col",class:"bg-gray-50 px-3 py-3.5 text-left text-sm font-semibold text-gray-900"}," Time & Date "),e("th",{scope:"col",class:"bg-gray-50 px-3 py-3.5 text-left text-sm font-semibold text-gray-900"}," Departure "),e("th",{scope:"col",class:"bg-gray-50 px-3 py-3.5 text-left text-sm font-semibold text-gray-900"}," Guide Involved "),e("th",{scope:"col",colspan:"2",class:"bg-gray-50 px-3 py-3.5"})])],-1),Ce={class:"divide-y divide-gray-200"},Ne={class:"flex items-center whitespace-nowrap p-3 text-sm font-medium text-gray-900"},Ae={class:"whitespace-nowrap p-3 text-sm text-gray-500"},Me={class:"whitespace-nowrap p-3 text-sm text-gray-500"},ze={class:"whitespace-nowrap p-3 text-sm text-gray-500"},Be={class:"relative whitespace-nowrap p-3 text-right text-sm font-medium"},De=T({__name:"Index",setup(Le){const{getAllIncidentsFromStore:D,fetchAndStoreIncidentsIndex:L,incidentActions:I,resetIncidentStore:$}=H(),{actionIsInProgress:P}=R(),j=N(()=>D()),f=A(B[0]),{userHasPermissionInDepartment:k,user:C}=J(),S=N(()=>{const l=[...j.value];return f.value.value==="date"?l.sort((s,u)=>{const g=new Date(s.date_of_departure_raw).getTime();return new Date(u.date_of_departure_raw).getTime()-g}):f.value.value==="incident_level"?l.sort((s,u)=>{const g=s.incident_level===z.NearMiss?0:Number.parseInt(s.incident_level);return(u.incident_level===z.NearMiss?0:Number.parseInt(u.incident_level))-g}):f.value.value==="staff_involved"?l.sort((s,u)=>s.staff_member_involved.fullName>u.staff_member_involved.fullName?-1:1):l}),o=A({lastItem:0,firstItem:0,total:0,currentPage:1,nextPage:0,previousPage:0,lastPage:0}),d=async l=>{const s=await L(l);o.value.total=s.total,o.value.currentPage=s.currentPage,o.value.nextPage=s.nextPage,o.value.previousPage=s.previousPage,o.value.lastPage=s.lastPage,o.value.lastItem=s.lastItem,o.value.firstItem=s.firstItem};return V(()=>{d(1)}),E(()=>{$()}),(l,s)=>{const u=F("RouterLink");return i(),_(U,{"main-content-title":"Manage Incidents"},{default:m(()=>{var g;return[e("div",Z,[e("div",ee,[p(r(Y),{modelValue:f.value,"onUpdate:modelValue":s[0]||(s[0]=t=>f.value=t),as:"div",class:"w-full"},{default:m(()=>[e("div",te,[p(r(Q),{class:"relative w-full cursor-default rounded-md border border-gray-300 bg-white py-2 pl-3 pr-10 text-left shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 sm:text-sm"},{default:m(()=>[e("span",se,a(f.value.label),1),e("span",oe,[p(r(K),{class:"h-5 w-5 text-gray-400","aria-hidden":"true"})])]),_:1}),p(G,{"leave-active-class":"transition ease-in duration-100","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:m(()=>[p(r(W),{class:"absolute z-10 mt-1 max-h-60 w-full overflow-auto rounded-md bg-white py-1 text-base shadow-lg ring-1 ring-black/5 focus:outline-none sm:text-sm"},{default:m(()=>[(i(!0),n(h,null,w(r(B),t=>(i(),_(r(X),{key:t.label,as:"template",value:t},{default:m(({active:v,selected:b})=>[e("li",{class:y(["relative cursor-default select-none py-2 pl-3 pr-9",[v?"bg-blue-600 text-white":"text-gray-900"]])},[e("span",{class:y(["block truncate",[b?"font-semibold":"font-normal"]])},a(t.label),3),b?(i(),n("span",{key:0,class:y(["absolute inset-y-0 right-0 flex items-center pr-4",[v?"text-white":"text-blue-600"]])},[p(r(O),{class:"h-5 w-5","aria-hidden":"true"})],2)):c("",!0)],2)]),_:2},1032,["value"]))),128))]),_:1})]),_:1})])]),_:1},8,["modelValue"])]),r(k)(r(M).MANAGE_INCIDENTS,(g=r(C))==null?void 0:g.departments.find(t=>t.primary))?(i(),_(u,{key:0,to:{name:l.$Routes.IncidentCreate},class:"flex w-1/2 items-center justify-center rounded-md bg-blue-600 px-3 py-1.5 text-center text-sm font-semibold leading-6 text-white shadow-sm focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-600 hover:bg-blue-500 md:w-48"},{default:m(()=>[x(" Add Incident ")]),_:1},8,["to"])):c("",!0)]),r(P)(r(I).getAllIncidents)?c("",!0):(i(),n("div",ie,[e("div",re,[e("button",{class:"relative inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",onClick:s[1]||(s[1]=t=>d(o.value.previousPage))}," Previous "),e("button",{class:"relative ml-3 inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",onClick:s[2]||(s[2]=t=>d(o.value.nextPage))}," Next ")]),e("div",ne,[e("div",null,[e("p",ae,[x(" Showing "),e("span",le,a(o.value.firstItem),1),x(" to "),e("span",ue,a(o.value.lastItem),1),x(" of "),e("span",de,a(o.value.total),1),x(" incidents. ")])]),e("div",null,[e("nav",me,[e("button",{class:"relative inline-flex items-center rounded-l-md p-2 text-gray-400 ring-1 ring-inset ring-gray-300 focus:z-20 focus:outline-offset-0 hover:bg-gray-50",onClick:s[3]||(s[3]=t=>d(o.value.previousPage))},pe),o.value.currentPage>3?(i(),n("button",{key:0,class:"relative z-10 inline-flex items-center px-4 py-2 text-sm text-gray-900 ring-1 ring-inset ring-gray-300 focus:z-20 focus:outline-offset-0 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 hover:bg-gray-50",onClick:s[4]||(s[4]=t=>d(1))}," 1... ")):c("",!0),(i(!0),n(h,null,w(o.value.lastPage,t=>(i(),n(h,{key:t},[t>o.value.currentPage-3&&t<=o.value.currentPage||t<=o.value.currentPage+3&&t>=o.value.currentPage?(i(),n("button",{key:0,class:y(["relative z-10 inline-flex items-center px-4 py-2 text-sm font-semibold focus:z-20 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2",t===o.value.currentPage?"text-white bg-blue-600 focus-visible:outline-blue-600":"text-gray-900 ring-1 ring-inset ring-gray-300 hover:bg-gray-50"]),onClick:v=>d(t)},a(t),11,fe)):c("",!0),t===o.value.currentPage?(i(),n("span",ge," ... ")):c("",!0)],64))),128)),o.value.currentPage<o.value.lastPage-3?(i(),n("button",{key:1,class:"relative z-10 inline-flex items-center px-4 py-2 text-sm text-gray-900 ring-1 ring-inset ring-gray-300 focus:z-20 focus:outline-offset-0 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 hover:bg-gray-50",onClick:s[5]||(s[5]=t=>d(o.value.lastPage))}," ..."+a(o.value.lastPage),1)):c("",!0),e("button",{class:"relative inline-flex items-center rounded-r-md p-2 text-gray-400 ring-1 ring-inset ring-gray-300 focus:z-20 focus:outline-offset-0 hover:bg-gray-50",onClick:s[6]||(s[6]=t=>d(o.value.nextPage))},xe)])])])])),e("div",be,[e("div",_e,[e("div",ye,[e("div",he,[r(P)(r(I).getAllIncidents)?(i(),n("div",we,[p(q,{class:"h-5 w-5 text-blue-600"})])):(i(),n("div",Ie,[e("table",Pe,[ke,e("tbody",Ce,[(i(!0),n(h,null,w(S.value,t=>{var v;return i(),n("tr",{key:t.id},[e("td",Ne,a(t.incident_level),1),e("td",Ae,a(t.date_and_time_of_departure),1),e("td",Me,a(t.name_of_departure),1),e("td",ze,a(t.staff_member_involved.fullName),1),e("td",Be,[r(k)(r(M).MANAGE_INCIDENTS,(v=r(C))==null?void 0:v.departments.find(b=>b.primary))?(i(),_(u,{key:0,to:{name:l.$Routes.IncidentEdit,params:{incidentId:t.id}},class:"text-blue-600 hover:text-blue-900"},{default:m(()=>[x(" View ")]),_:2},1032,["to"])):c("",!0)])])}),128))])])]))])])])])]}),_:1})}}});De.__docgenInfo={exportName:"default",displayName:"incidents",description:"",tags:{},sourceFiles:["D:/work/server/htdocs/aa-portal.is/src/pages/incidents/Index.vue"]};export{De as default};
