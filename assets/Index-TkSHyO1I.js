import{e as $,j as T,o as n,A as N,B as w,l as t,b as g,u as e,k as d,H as P,G as A,J as q,P as R,D as c,N as z,F as V,x as J,C as W,T as k}from"./vue.esm-bundler-CYPfFjdk.js";import{u as K,a as H,M as Q,A as D}from"./preview-D0Pi-YKn.js";import{P as S}from"./ProgressSpinner-lCLkagxy.js";import{I as F}from"./IconTickMarkCircle-2_sKm8Jk.js";import{I as X}from"./DepartureListItem-I88AIHqM.js";import{s as Y,u as Z}from"./schemas-74JEr9Jm.js";import{I as G}from"./IconClose-tbzieUCA.js";import{_ as ee}from"./FeedbackWarning-iVsjxw1W.js";import{_ as te}from"./VDataFilters-2mcnRfw0.js";import{u as ie}from"./useAuth-8d_1_S6I.js";import"./chunk-UXHY756F-iEg6Hh0Y.js";import"./index-C1vJkiWb.js";import"./_commonjsHelpers-4gQjN7DL.js";import"./vue-router-E7v71uM3.js";import"./preview-errors-7FWlPnjy.js";import"./index-PPLHz8o0.js";import"./PDays-npMhi6Nw.js";import"./index-baqd9Qr3.js";import"./index-TCXC35p5.js";import"./index-05uTbNHo.js";import"./PPopoverPanel-RNuJphX8.js";import"./index-LmGWO5sK.js";import"./headlessui-float-sqR0azf2.js";import"./transition-qpXhaAaU.js";import"./keyboard-64MH3N5t.js";import"./open-closed-nhb_Ydho.js";import"./use-root-containers-gEPBKDr2.js";import"./use-resolve-button-type-49aRxFpo.js";import"./iframe-ufxlS10p.js";import"../sb-preview/runtime.js";import"./query-G1AwWss6.js";import"./ChevronDownIcon-AgxEjrtE.js";import"./listbox-3RN1mHPV.js";import"./form-TGXPuq_M.js";import"./DepartureList-w5NrqMJ9.js";import"./DepartureAssignStaffAndVehicles-8AoBdfT8.js";import"./api-B2HcjM2j.js";import"./api-cJzoLyfI.js";import"./PButton-h9_xezBg.js";import"./index-VqpYtbVe.js";import"./PInput-iZb_REtl.js";import"./POverlay-3jPNvx4x.js";import"./PSpinner-cF72MsvC.js";import"./IconBus-0QPjtZ9u.js";import"./_plugin-vue_export-helper-x3n3nnut.js";import"./IconPerson-i3ljUCnk.js";import"./SuggestedUser-4kWsZiWj.js";import"./PAvatar-wq6oK0Zr.js";import"./PlusCircleIcon-aSiXn_Mr.js";import"./SuggestedVehicle-r1TyKt-D.js";import"./ScheduledUser-esbe3tjU.js";import"./VehicleTitle-0pOySBND.js";import"./XMarkIcon-_tXc_TyD.js";import"./PPhoneLink-wKLYRG_F.js";import"./PAlert-quHLeqTA.js";import"./CheckCircleIcon-akbq8cGf.js";import"./XMarkIcon-t43a1P5Z.js";import"./PDialogTitle-rfxNVwSR.js";import"./description-LPuBJoU_.js";import"./routes-WhYxSpGG.js";import"./PToggle-mLVcOzrp.js";import"./PRadio-sGATo2dT.js";import"./index-bhXQ3okY.js";import"./isNativeReflectConstruct-ubdnbphT.js";import"./mock-vjhcKIQW.js";import"./index-1aVAeLWL.js";import"./mock-UR5nntqf.js";import"./mock-CzN7Q16W.js";import"./models-qWR1FMGP.js";import"./mock-YoOI-P8k.js";import"./mock-psFphV_9.js";import"./mock-OgPWcINV.js";import"./DepartureUpdateComment-2rt04tFb.js";import"./PTextarea-Wrr33MR5.js";import"./DepartureUpdateCommentPopover-euFlcGix.js";import"./DepartureUpdateStatus-zdhd3wV8.js";import"./PListboxLabel-U39qo3cm.js";import"./CheckIcon-WRJIoum8.js";import"./lib-Fy6oBlQ3.js";import"./IconAlert-B2oaG4cc.js";import"./useDepartment-RZahlhen.js";import"./useOperationalBase-kvvO22e1.js";import"./useRole-JNprELZd.js";function se(){const{apiClient:b}=K(),{addToActionsInProgress:m,removeFromActionsInProgress:v,processActionError:E,processActionSuccess:I,resetActionsInError:f,resetActionsInSuccess:y}=H(),{user:M}=Y(Z()),a={saveEventNotification:{id:"saveEventNotification",successMessage:"Event notification saved successfully.",errorMessage:"There was a problem saving the event notification"},getEventNotifications:{id:"getEventNotifications",successMessage:"Event notification retrieved successfully.",errorMessage:"There was a problem retrieving the event notification"},getEventNotificationCategoriesByDepartmentId:{id:"getEventNotificationCategoriesByDepartmentId",successMessage:"Event notification categories retrieved successfully.",errorMessage:"There was a problem retrieving event notification categories."},deleteEventNotification:{id:"deleteEventNotification",successMessage:"Event notifications deleted successfully.",errorMessage:"There was a problem deleting the event notifications."}};return{user:M,eventNotificationActions:a,saveEventNotification:async r=>{f(),y(),m(a.saveEventNotification);try{const i=await b.post("/api/event-notification",{email_address:r.email,departmentId:r.department.id,eventNotificationCategoryId:r.eventNotificationCategory.id});return v(a.saveEventNotification),I(a.saveEventNotification),setTimeout(()=>{y()},3e3),i.data.eventNotification}catch(i){console.log(i),v(a.saveEventNotification),E(a.saveEventNotification,i),setTimeout(()=>{f()},3e3)}},apiGetNotificationEmails:async(r,i)=>{f(),m(a.getEventNotifications);try{const h=await b.get("/api/event-notifications",{params:{eventCategoryId:r.id,selectedDepartmentId:i.id}});return v(a.getEventNotifications),h.data.eventNotifications}catch(h){console.log(h),E(a.getEventNotifications,h)}},deleteEventNotification:async r=>{f(),y(),m(a.deleteEventNotification);try{return await b.delete(`/api/event-notifications/${r.id}`),v(a.deleteEventNotification),I(a.deleteEventNotification),setTimeout(()=>{y()},3e3),!0}catch(i){return v(a.deleteEventNotification),E(a.deleteEventNotification,i),setTimeout(()=>{f()},3e3),!1}},apiGetEventNotificationCategoriesByDepartmentId:async()=>{f(),m(a.getEventNotificationCategoriesByDepartmentId);try{const r=await b.get("/api/event-notification-categories");return v(a.getEventNotificationCategoriesByDepartmentId),r.data.eventNotificationCategories}catch(r){console.log(r),E(a.getEventNotificationCategoriesByDepartmentId,r)}}}}const oe={class:"space-y-8 divide-y divide-gray-200"},ne={class:"space-y-8 divide-y divide-gray-200 sm:space-y-5"},ae=t("p",{class:"mb-1 block text-sm font-medium text-gray-700"}," Department ",-1),re=t("p",{class:"mt-4 text-sm text-gray-500"}," Use the forms below to add or remove email addresses that should receive notifications when an event occurs. Email addresses can be from within or outside of the organisation. ",-1),ce={class:"space-y-3 pt-3 sm:space-y-5"},le={class:"max-w-[1280px] space-y-6 sm:space-y-5"},de={class:"sm:col-span-1"},me=["textContent"],pe={key:0,class:"mt-1 flex items-center"},ue=["onUpdate:modelValue","disabled"],ve=["disabled","onClick"],fe={key:0,class:"mt-3"},_e=["textContent"],ge=["disabled","onClick"],he={key:0,viewBox:"0 0 14 14",class:"h-3.5 w-3.5 stroke-blue-800/50 group-hover:stroke-blue-800/75"},xe=t("path",{d:"M4 4l6 6m0-6l-6 6"},null,-1),Ee=[xe],ye=t("span",{class:"absolute -inset-1"},null,-1),Ne={key:0,class:"fixed inset-x-0 top-0 flex justify-center p-2"},be={class:"w-[300px] rounded-md border border-green-100 bg-green-50 p-3 md:p-4"},Ie={class:"flex"},we={class:"shrink-0"},Ce={class:"ml-3"},Te=["innerHTML"],ke={key:0,class:"fixed inset-x-0 top-0 flex justify-center p-2"},De={class:"w-[300px] rounded-md border border-green-100 bg-green-50 p-3 md:p-4"},Me={class:"flex"},Ae={class:"shrink-0"},Se={class:"ml-3"},Be=["innerHTML"],Oe={key:0,class:"fixed inset-x-0 top-0 flex justify-center p-2"},Pe={class:"w-[300px] rounded-md border border-red-100 bg-red-50 p-3 md:p-4"},Ve={class:"flex"},Fe={class:"shrink-0"},Ge={class:"ml-3"},He=["innerHTML"],Le={key:0,class:"fixed inset-x-0 top-0 flex justify-center p-2"},je={class:"w-[300px] rounded-md border border-red-100 bg-red-50 p-3 md:p-4"},Ue={class:"flex"},$e={class:"shrink-0"},qe={class:"ml-3"},Re=["innerHTML"],ze=$({__name:"Index",setup(b){const{actionIsInProgress:m,getActionSuccessMessage:v,getActionErrorMessage:E,actionIsInSuccess:I,actionIsInError:f}=H(),{apiGetEventNotificationCategoriesByDepartmentId:y,apiGetNotificationEmails:M,saveEventNotification:a,deleteEventNotification:B,eventNotificationActions:l}=se(),{userHasPermissionInDepartment:C}=ie(),u=T({selectedDepartment:null,selectedOperationalBase:null,selectedRole:null,selectedMonth:"",selectedDate:""}),r=T([]),i=T([]),h=T(!1),L=async x=>{h.value=!0,u.value=x;const _=await y();if(_&&u.value.selectedDepartment){r.value=_,i.value=_.map(o=>({department:u.value.selectedDepartment,eventNotificationCategory:o,email:"",existingEmails:[]}));const p=i.value.map(async o=>{const s=await M(o.eventNotificationCategory,o.department);return s&&(o.existingEmails=s),o});i.value=await Promise.all(p)}h.value=!1},j=async x=>{var p;if(await B(x)&&((p=i.value)==null?void 0:p.length)>0){const o=i.value.findIndex(s=>s.eventNotificationCategory.id===x.eventCategoryId);if(o!==-1){const s={...i.value[o]};s.existingEmails.splice(s.existingEmails.findIndex(O=>O.id===x.id),1),s.email="",i.value[o]=s}}},U=async x=>{var p;const _=await a(x);if(_&&((p=i.value)==null?void 0:p.length)>0){const o=i.value.findIndex(s=>s.eventNotificationCategory.id===_.eventCategoryId);if(o!==-1){const s={...i.value[o]};s.existingEmails.push(_),s.email="",i.value[o]=s}}};return(x,_)=>(n(),N(Q,{"main-content-title":"Event Notifications"},{default:w(()=>[t("div",oe,[t("div",ne,[t("div",null,[ae,g(te,{"department-permissions-required":[e(D).VIEW_EVENT_NOTIFICATIONS],"filter-by-departments":"",onFilterStateUpdated:L},null,8,["department-permissions-required"]),re]),t("div",ce,[t("div",le,[(n(!0),d(V,null,P(r.value,(p,o)=>(n(),d("form",{key:p.id,class:"flex flex-col sm:items-start sm:gap-4 sm:border-t sm:border-gray-200 sm:pt-5 md:flex-row"},[t("div",de,[t("label",{class:"block text-sm font-medium text-gray-700",textContent:A(p.label)},null,8,me),i.value?(n(),d("div",pe,[u.value.selectedDepartment?q((n(),d("input",{key:0,"onUpdate:modelValue":s=>i.value[o].email=s,disabled:!e(C)(e(D).MANAGE_EVENT_NOTIFICATIONS,u.value.selectedDepartment),type:"email",required:"",placeholder:"Enter email address...",class:"peer block flex-1 rounded-md border-gray-300 shadow-sm placeholder:text-gray-300 focus:border-blue-500 focus:ring-blue-500 sm:text-sm"},null,8,ue)),[[R,i.value[o].email]]):c("",!0),u.value.selectedDepartment&&e(C)(e(D).MANAGE_EVENT_NOTIFICATIONS,u.value.selectedDepartment)?(n(),d("button",{key:1,class:"mx-3 inline-flex h-[38px] w-[38px] items-center justify-center rounded-md border border-transparent bg-blue-600 shadow-sm focus:border-blue-500 focus:ring-blue-500 disabled:cursor-not-allowed disabled:opacity-50 hover:bg-blue-700",disabled:i.value[o].email.length===0,onClick:z(s=>U(i.value[o]),["prevent"])},[e(m)(e(l).saveEventNotification)?c("",!0):(n(),N(X,{key:0,class:"h-4 w-4 fill-white"})),e(m)(e(l).saveEventNotification)?(n(),N(S,{key:1,class:"h-3 w-3 text-white"})):c("",!0)],8,ve)):c("",!0)])):c("",!0)]),i.value?(n(),d("div",fe,[t("p",{class:"mt-1 text-sm text-gray-500",textContent:A(p.description)},null,8,_e),!h.value&&i.value[o].existingEmails.length===0?(n(),N(ee,{key:0,class:"mt-2",message:"There are currently no email addresses set up to receive daily summary emails."})):c("",!0),e(m)(e(l).getEventNotifications)?(n(),N(S,{key:1,class:"mt-1 h-4 w-4 text-gray-500"})):c("",!0),t("div",null,[(n(!0),d(V,null,P(i.value[o].existingEmails,s=>(n(),d("span",{key:s.id,class:"m-1 inline-flex items-center gap-x-0.5 rounded-md bg-blue-100 px-2 py-1 text-xs font-medium text-blue-700 first:ml-0"},[J(A(s.emailAddress)+" ",1),u.value.selectedDepartment&&e(C)(e(D).MANAGE_EVENT_NOTIFICATIONS,u.value.selectedDepartment)?(n(),d("button",{key:0,disabled:e(m)({id:`deleteEventNotification-${s.id}`}),type:"button",class:W(["group relative -mr-1 flex h-3.5 w-3.5 items-center justify-center rounded-sm",{"hover:bg-blue-600/20":!e(m)({id:`deleteEventNotification-${s.id}`})}]),onClick:O=>j(s)},[e(m)(e(l).deleteEventNotification)?c("",!0):(n(),d("svg",he,Ee)),e(m)(e(l).deleteEventNotification)?(n(),N(S,{key:1,class:"h-2 w-2 text-blue-800/50"})):c("",!0),ye],10,ge)):c("",!0)]))),128))])])):c("",!0)]))),128))])])])]),g(k,{name:"save"},{default:w(()=>[e(I)(e(l).deleteEventNotification)?(n(),d("div",Ne,[t("div",be,[t("div",Ie,[t("div",we,[g(F,{class:"h-5 w-5 fill-green-400","aria-hidden":"true"})]),t("div",Ce,[t("p",{class:"text-sm text-green-700",innerHTML:e(v)(e(l).deleteEventNotification)},null,8,Te)])])])])):c("",!0)]),_:1}),g(k,{name:"save"},{default:w(()=>[e(I)(e(l).saveEventNotification)?(n(),d("div",ke,[t("div",De,[t("div",Me,[t("div",Ae,[g(F,{class:"h-5 w-5 fill-green-400","aria-hidden":"true"})]),t("div",Se,[t("p",{class:"text-sm text-green-700",innerHTML:e(v)(e(l).saveEventNotification)},null,8,Be)])])])])):c("",!0)]),_:1}),g(k,{name:"save"},{default:w(()=>[e(f)(e(l).deleteEventNotification,!0)?(n(),d("div",Oe,[t("div",Pe,[t("div",Ve,[t("div",Fe,[g(G,{class:"h-5 w-5 fill-red-400","aria-hidden":"true"})]),t("div",Ge,[t("p",{class:"text-sm text-red-700",innerHTML:e(E)(e(l).deleteEventNotification,!0)},null,8,He)])])])])):c("",!0)]),_:1}),g(k,{name:"save"},{default:w(()=>[e(f)(e(l).saveEventNotification,!0)?(n(),d("div",Le,[t("div",je,[t("div",Ue,[t("div",$e,[g(G,{class:"h-5 w-5 fill-red-400","aria-hidden":"true"})]),t("div",qe,[t("p",{class:"text-sm text-red-700",innerHTML:e(E)(e(l).saveEventNotification,!0)},null,8,Re)])])])])):c("",!0)]),_:1})]),_:1}))}});ze.__docgenInfo={exportName:"default",displayName:"event-notification-settings",description:"",tags:{},sourceFiles:["D:/work/server/htdocs/aa-portal.is/src/pages/event-notification-settings/Index.vue"]};export{ze as default};
