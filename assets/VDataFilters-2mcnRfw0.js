import{o as l,k as s,l as p,e as K,j as u,g as T,q as Q,w as S,b as k,u as t,D as d,C as R,J as A,S as U,F as I,H as P,P as W,G as V}from"./vue.esm-bundler-CYPfFjdk.js";import{u as X}from"./useDepartment-RZahlhen.js";import{u as ee}from"./useOperationalBase-kvvO22e1.js";import{u as te}from"./useRole-JNprELZd.js";import{a as ae}from"./preview-D0Pi-YKn.js";import{P as C}from"./ProgressSpinner-lCLkagxy.js";import{u as le}from"./useAuth-8d_1_S6I.js";function se(o,M){return l(),s("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[p("path",{"fill-rule":"evenodd",d:"M11.78 5.22a.75.75 0 0 1 0 1.06L8.06 10l3.72 3.72a.75.75 0 1 1-1.06 1.06l-4.25-4.25a.75.75 0 0 1 0-1.06l4.25-4.25a.75.75 0 0 1 1.06 0Z","clip-rule":"evenodd"})])}function ne(o,M){return l(),s("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[p("path",{"fill-rule":"evenodd",d:"M8.22 5.22a.75.75 0 0 1 1.06 0l4.25 4.25a.75.75 0 0 1 0 1.06l-4.25 4.25a.75.75 0 0 1-1.06-1.06L11.94 10 8.22 6.28a.75.75 0 0 1 0-1.06Z","clip-rule":"evenodd"})])}const oe={class:"flex w-full flex-col space-y-2 sm:flex-row sm:space-x-2 sm:space-y-0"},re={key:0,class:"flex rounded-md bg-white"},ie=["innerHTML"],ue={key:0,value:null},de=["value"],pe={key:0,class:"absolute inset-0 flex items-center justify-center"},me=["disabled"],fe=["value"],ce={key:0,class:"absolute inset-0 flex items-center justify-center"},ve=["value"],ye={key:0,class:"absolute inset-0 flex items-center justify-center"},ge={key:4,class:""},we=K({__name:"VDataFilters",props:{filterByDate:{type:Boolean,default:!1},filterByMonth:{type:Boolean,default:!1},filterByDepartments:{type:Boolean,default:!0},filterByOperationalBases:{type:Boolean,default:!1},filterByRoles:{type:Boolean,default:!1},showAllOperationalBases:{type:Boolean,default:!1},showAllRoles:{type:Boolean,default:!1},allowNoDepartment:{type:Boolean},departmentPermissionsRequired:{default:()=>[]}},emits:["filterStateUpdated"],setup(o,{emit:M}){const f=M,{actionIsInProgress:r}=ae(),{apiGetDepartments:j,departmentActions:c}=X(),{apiGetOperationalBasesByDepartments:G,operationalBaseActions:F}=ee(),{apiGetRolesByDepartments:H,roleActions:L}=te(),{userHasSomePermissionsInDepartment:Y}=le(),B=u([]),O=u([]),m=u([]),i=u(null),h=u(null),b=u(null),v=u(new Date().toISOString().split("T")[0]),y=u(new Date().toISOString().split("T")[0]),_={id:0,name:"All Operational Bases",longitude:"",latitude:"",privateStaffSchedules:!1,department:{id:0,name:"All Departments",organisationId:0,code:"",description:""}},Z={id:0,name:"All Roles",slug:"",description:"",department:{id:0,name:"All Departments",organisationId:0,code:"",description:""},roleCategories:[]},g=u(!0),w=T(()=>({selectedDepartment:i.value,selectedOperationalBase:h.value,selectedRole:b.value,selectedMonth:v.value,selectedDate:y.value})),z=async()=>{B.value=await j(),o.departmentPermissionsRequired.length>0&&(B.value=B.value.filter(a=>Y(o.departmentPermissionsRequired,a))),i.value=B.value[0]},N=async()=>{if(i.value){const a=await G([i.value]);a&&(m.value=a),o.showAllOperationalBases&&m.value.length>1&&m.value.unshift(_),h.value=m.value[0]}},q=async()=>{if(i.value){const a=await H([i.value]);a&&(O.value=a.data.roles),o.showAllRoles&&O.value.unshift(Z),b.value=O.value[0]}},$=a=>{const n=new Date(v.value).getFullYear(),e=new Date(v.value).getMonth();let D=null;e===11&&a&&(D=n+1),e===0&&!a&&(D=n-1),D||(D=n);let x=a?(e+2)%12:e%12;x===0&&(x=12);const J=x<10?`0${x}`:x;v.value=`${D}-${J}-01`},E=T(()=>{const a=new Date(v.value);return`${a.toLocaleString("default",{month:"long"})} ${a.getFullYear()}`});return Q(async()=>{await z(),o.filterByOperationalBases&&await N(),o.filterByRoles&&await q(),g.value=!1,f("filterStateUpdated",w.value)}),S(i,async()=>{g.value||(o.filterByOperationalBases&&await N(),o.filterByRoles&&await q(),f("filterStateUpdated",w.value))}),S(h,async()=>{g.value||(o.filterByRoles&&await q(),f("filterStateUpdated",w.value))}),S(b,()=>{g.value||f("filterStateUpdated",w.value)}),S(v,()=>{g.value||f("filterStateUpdated",w.value)}),S(y,()=>{g.value||(y.value.length||(y.value=new Date().toISOString().split("T")[0]),f("filterStateUpdated",w.value))}),(a,n)=>(l(),s("div",oe,[a.filterByMonth?(l(),s("div",re,[p("button",{type:"button",class:"rounded-l p-2 py-1.5 text-gray-900 ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-blue-300",onClick:n[0]||(n[0]=e=>$(!1))},[k(t(se),{class:"h-5 w-5 fill-gray-500"})]),p("div",{class:"relative w-full min-w-[130px] flex-1 px-3 py-2 text-center text-gray-900 ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-blue-300 sm:text-sm sm:leading-6",innerHTML:E.value},null,8,ie),p("button",{type:"button",class:"rounded-r p-2 py-1.5 text-gray-900 ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-blue-300",onClick:n[1]||(n[1]=e=>$(!0))},[k(t(ne),{class:"h-5 w-5 fill-gray-500"})])])):d("",!0),a.filterByDepartments?(l(),s("div",{key:1,class:R(["relative",{"cursor-not-allowed opacity-50":t(r)(t(c).getDepartments)}])},[A(p("select",{"onUpdate:modelValue":n[2]||(n[2]=e=>i.value=e),class:"block h-[40px] w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:min-w-[250px] sm:text-sm"},[a.allowNoDepartment?(l(),s("option",ue," All ")):d("",!0),(l(!0),s(I,null,P(B.value,e=>(l(),s("option",{key:e.id,value:e},V(e.name),9,de))),128))],512),[[U,i.value]]),t(r)(t(c).getDepartments)?(l(),s("div",pe,[k(C,{class:"h-4 w-4 text-blue-500"})])):d("",!0)],2)):d("",!0),a.filterByOperationalBases&&m.value.length>1?(l(),s("div",{key:2,class:R(["relative",{"cursor-not-allowed opacity-50":t(r)(t(c).getDepartments)||t(r)(t(F).getOperationalBasesByDepartments)}])},[A(p("select",{"onUpdate:modelValue":n[3]||(n[3]=e=>h.value=e),class:R(["block h-[40px] w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:min-w-[250px] sm:text-sm",{"bg-gray-200 bg-none":m.value.length===1}]),disabled:m.value.length===1},[(l(!0),s(I,null,P(m.value,e=>(l(),s("option",{key:e.id,value:e},V(e.name),9,fe))),128))],10,me),[[U,h.value]]),t(r)(t(c).getDepartments)||t(r)(t(F).getOperationalBasesByDepartments)?(l(),s("div",ce,[k(C,{class:"h-4 w-4 text-blue-500"})])):d("",!0)],2)):d("",!0),a.filterByRoles?(l(),s("div",{key:3,class:R(["relative",{"cursor-not-allowed opacity-50":t(r)(t(c).getDepartments)||t(r)(t(L).getRolesByDepartments)}])},[A(p("select",{"onUpdate:modelValue":n[4]||(n[4]=e=>b.value=e),class:"block h-[40px] w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:min-w-[250px] sm:text-sm"},[(l(!0),s(I,null,P(O.value,e=>(l(),s("option",{key:e.id,value:e},V(e.name),9,ve))),128))],512),[[U,b.value]]),t(r)(t(c).getDepartments)||t(r)(t(L).getRolesByDepartments)?(l(),s("div",ye,[k(C,{class:"h-4 w-4 text-blue-500"})])):d("",!0)],2)):d("",!0),a.filterByDate?(l(),s("div",ge,[A(p("input",{"onUpdate:modelValue":n[5]||(n[5]=e=>y.value=e),type:"date",class:"block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:min-w-[250px] sm:text-sm"},null,512),[[W,y.value]])])):d("",!0)]))}});we.__docgenInfo={exportName:"default",displayName:"VDataFilters",description:"",tags:{},props:[{name:"filterByDate",required:!1,type:{name:"boolean"}},{name:"filterByMonth",required:!1,type:{name:"boolean"}},{name:"filterByDepartments",required:!1,type:{name:"boolean"}},{name:"filterByOperationalBases",required:!1,type:{name:"boolean"}},{name:"filterByRoles",required:!1,type:{name:"boolean"}},{name:"showAllOperationalBases",required:!1,type:{name:"boolean"}},{name:"showAllRoles",required:!1,type:{name:"boolean"}},{name:"allowNoDepartment",required:!1,type:{name:"boolean"}},{name:"departmentPermissionsRequired",required:!1,type:{name:"Array",elements:[{name:"AppPermissions"}]}}],events:[{name:"filterStateUpdated",type:{names:["IDataFilters"]}}],sourceFiles:["D:/work/server/htdocs/aa-portal.is/src/shared/ui/inputs/VDataFilters.vue"]};export{we as _};
